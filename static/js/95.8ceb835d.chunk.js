"use strict";(self.webpackChunkgate_from_nothingproject_front_end=self.webpackChunkgate_from_nothingproject_front_end||[]).push([[95],{5988:(e,t,a)=>{a.d(t,{X:()=>i});const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{decimals:a=1,allowNegative:i=!1}=t;if("number"!==typeof e||Number.isNaN(e))return"0";const r=e<0;if(r&&!i)return"0";const n=Math.abs(e),o=[{threshold:1e9,suffix:"B"},{threshold:1e6,suffix:"M"},{threshold:1e3,suffix:"K"},{threshold:0,suffix:""}],{threshold:l,suffix:s}=o.find((e=>{let{threshold:t}=e;return n>=t}))||o[o.length-1];if(0===l)return(r?"-":"")+n.toString();const d=n/l;return(r?"-":"")+(0===a?Math.round(d).toString():d.toFixed(a).replace(/\.0+$/,""))+s}},6552:(e,t,a)=>{a.d(t,{DP:()=>o,Dq:()=>y,Km:()=>p,LE:()=>f,ar:()=>g,cy:()=>l,iH:()=>w,j$:()=>x,mE:()=>_,nT:()=>u,p5:()=>h,qJ:()=>v,wQ:()=>c,x1:()=>s,yZ:()=>b,z9:()=>m});var i=a(1546),r=a(2113);const n={...r.A,breakpoints:{...r.A.breakpoints,values:{xs:150,sm:700,md:1200,lg:1500,xl:1536}}},o="0 4px 16px rgba(0,0,0,0.12)",l="0 8px 24px rgba(0,0,0,0.18)",s={color:"text.primary",fontWeight:400,lineHeight:1.6},d={"&:hover":{transform:"translateY(-2px)",boxShadow:l},"&:focus":{outline:e=>`2px solid ${(0,i.X4)(e.palette.primary.main,.5)}`,outlineOffset:2}},c=(n.shape.borderRadiusMedium,{borderRadius:n.shape.borderRadiusLarge,textTransform:"none",transition:"all 0.2s ease",fontWeight:600,"&:hover":{transform:"scale(1.02)",backgroundColor:e=>e.palette.primary.dark},"&:active":{transform:"scale(0.98)"},"&:focus":{outline:e=>`2px solid ${(0,i.X4)(e.palette.primary.main,.5)}`,outlineOffset:2},"&:disabled":{backgroundColor:"action.disabled",color:"action.disabledOpacity"}}),u={height:{xs:"40px",sm:"50px"},minWidth:{xs:"120px",sm:"150px"},borderRadius:n.shape.borderRadiusLarge,padding:{xs:"0 15px",sm:"0 25px"},backgroundColor:"primary.main",color:"primary.contrastText",boxShadow:"none",fontSize:{xs:"0.7rem",sm:"1rem"},fontWeight:600,transition:"all 0.3s ease-in-out","&:hover":{backgroundColor:"primary.dark",boxShadow:"none"},"&:disabled":{backgroundColor:"action.disabled",color:"action.disabledOpacity"}},p={height:{xs:"40px",sm:"50px"},minWidth:{xs:"120px",sm:"150px"},borderRadius:n.shape.borderRadiusLarge,padding:{xs:"0 15px",sm:"0 25px"},backgroundColor:"background.default",color:"text.primary",boxShadow:"none",fontSize:{xs:"0.7rem",sm:"1rem"},fontWeight:600,transition:"all 0.3s ease-in-out","&:hover":{backgroundColor:"background.hover",boxShadow:"none"},"&:disabled":{backgroundColor:"action.disabled",color:"action.disabledOpacity"}},m=(n.shape.borderRadiusLarge,{mt:n.spacing(1),backgroundColor:"background.default",borderRadius:n.shape.borderRadiusSmall,"& .MuiInputLabel-root":{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"1rem"}},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"},"& .MuiOutlinedInput-root":{borderRadius:n.shape.borderRadiusSmall,"& .MuiOutlinedInput-notchedOutline":{border:"none"},"&:hover .MuiOutlinedInput-notchedOutline":{border:"none"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{border:"none"}},"& .MuiInputBase-input":{fontSize:{xs:"0.7rem",sm:"1rem"}},"& .MuiInputBase-input::placeholder":{color:"text.secondary",opacity:1}}),b={mt:n.spacing(1),backgroundColor:"background.paper",borderRadius:n.shape.borderRadiusSmall,"& .MuiInputLabel-root":{color:"text.secondary",fontSize:{xs:"0.7rem",sm:"1rem"}},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"},"& .MuiOutlinedInput-root":{borderRadius:n.shape.borderRadiusSmall,"& .MuiOutlinedInput-notchedOutline":{border:"none"},"&:hover .MuiOutlinedInput-notchedOutline":{border:"none"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{border:"none"}},"& .MuiInputBase-input":{fontSize:{xs:"0.7rem",sm:"1rem"}},"& .MuiInputBase-input::placeholder":{color:"text.secondary",opacity:1}},h={mt:n.spacing(1),backgroundColor:"background.default",borderRadius:n.shape.borderRadiusSmall,"& .MuiOutlinedInput-root":{borderRadius:n.shape.borderRadiusSmall,"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}},"& .MuiSelect-select":{fontSize:{xs:"0.7rem",sm:"1rem"}},"& .MuiSelect-icon":{color:"text.primary"},"& .MuiInputLabel-root":{fontSize:{xs:"0.7rem",sm:"1rem"}}},g={card:{borderRadius:{xs:1,sm:1.5},mb:3,backgroundColor:"background.paper",boxShadow:"none",width:{xs:"100%",sm:"auto"},boxSizing:"border-box"},content:{display:"flex",flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center",sm:"center"},justifyContent:{xs:"center",sm:"space-between"},mt:1,mb:1,mx:{xs:2,sm:3},gap:{xs:2,sm:3},textAlign:{xs:"center",sm:"left"}},leftSection:{display:"flex",flexDirection:"column",gap:1,width:{xs:"100%",sm:"auto"}},rightSection:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:{xs:"center",sm:"flex-end"},width:{xs:"100%",sm:"auto"},mt:{xs:1,sm:0}},title:{fontWeight:400,color:"text.primary"},level:{color:"text.secondary"},buttonGroup:{display:"contents",flexDirection:"row",alignItems:"center",justifyContent:{xs:"center",sm:"flex-end"},gap:{xs:1,sm:.5},width:{xs:"100%",sm:"100%"},flexWrap:"wrap"},splitButtonGroup:{display:"flex",flexDirection:{xs:"row",sm:"column"},alignItems:"center",justifyContent:"center",width:{xs:"100%",sm:"auto"},gap:{xs:1,sm:2},flexWrap:{xs:"wrap",sm:"nowrap"}},chipContainer:{display:"flex",flexDirection:"row",flexWrap:{xs:"nowrap",sm:"wrap"},gap:{xs:.5,sm:1},mt:1,width:{xs:"100%",sm:"auto"},justifyContent:{xs:"center",sm:"start"},overflowX:{xs:"auto",sm:"visible"},"&::-webkit-scrollbar":{display:"none"},msOverflowStyle:"none",scrollbarWidth:"none"},chip:{fontSize:{xs:"0.65rem",sm:"0.75rem"},padding:{xs:"0.2rem",sm:"0.3rem 0.6rem"},height:{xs:"32px",sm:"28px"},transition:n.transitions.create(["width","padding"],{duration:n.transitions.duration.short,easing:n.transitions.easing.easeInOut}),cursor:"pointer","& .MuiChip-label":{padding:{xs:0,sm:"0 6px"},display:{xs:"none",sm:"inline"}},"& .MuiChip-icon":{margin:{xs:"0",sm:"0 0 0 -4px"},fontSize:{xs:"0.7rem",sm:"1rem"}}},chipExpanded:{width:"auto",padding:{xs:"0.2rem 0.6rem",sm:"0.5rem 1rem"},"& .MuiChip-label":{display:"inline"}},chipCollapsed:{width:{xs:"32px",sm:"auto"},padding:{xs:"0.2rem",sm:"0.3rem 0.6rem"},"& .MuiChip-label":{display:{xs:"none",sm:"inline"}}}},x={container:{mb:2},label:{fontWeight:400,mb:.5},input:{"& .MuiOutlinedInput-notchedOutline":{border:"none"},backgroundColor:"background.default",borderRadius:n.shape.borderRadiusSmall},value:{color:"text.secondary"}},v={card:{borderRadius:{xs:1,sm:1.5},backgroundColor:"background.paper",boxShadow:"none",mb:3,width:{xs:"100%",sm:"auto"},boxSizing:"border-box"},content:{mx:{xs:2,sm:3},my:3},title:{fontWeight:500,mb:5}},y={formControl:{gap:2,"& .MuiFormControlLabel-label":{minWidth:"120px",fontWeight:400}},switch:{width:42,height:24,padding:0,"&:active .MuiSwitch-thumb":{width:15},"& .MuiSwitch-switchBase":{padding:.25,"&.Mui-checked":{transform:"translateX(18px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"primary.main",opacity:1}},"&.Mui-disabled":{color:"grey.400","& + .MuiSwitch-track":{backgroundColor:"action.disabledBackground",opacity:1}}},"& .MuiSwitch-thumb":{boxShadow:"0 2px 4px rgba(0,0,0,0.3)",width:20,height:20,borderRadius:10,transition:n.transitions.create(["width"],{duration:200}),backgroundColor:"background.default"},"& .MuiSwitch-track":{borderRadius:12,backgroundColor:"grey.400",opacity:1,transition:n.transitions.create(["background-color"],{duration:200}),"&.Mui-disabled":{backgroundColor:"action.disabledBackground",opacity:.7}}}},w={width:{xs:"100%",sm:"auto"},maxWidth:{xs:"100%",sm:"1500px"},margin:{xs:0,sm:"0 auto"},padding:{xs:0,sm:1},boxSizing:"border-box"},f={container:{display:"grid",gap:2,gridTemplateColumns:{xs:"1fr",sm:"repeat(auto-fill, minmax(300px, 1fr))"}}},_={container:{borderRadius:n.shape.borderRadiusMedium,bgcolor:"grey.200"},header:{height:{xs:80,sm:100},mb:2},filter:{height:{xs:40,sm:50},mb:2},card:{height:{xs:180,sm:200}}};n.shape.borderRadiusMedium},8476:(e,t,a)=>{a.r(t),a.d(t,{default:()=>qa});var i=a(5043),r=a(1675),n=a(6240),o=a(2143),l=a(7353),s=a(8185),d=a(9392),c=a(7392),u=a(3933),p=a(378),m=a(35),b=a(6600),h=a(5316),g=a(4496),x=a(7784),v=a(9347),y=a(1906),w=a(3546),f=a(6162),_=a(3637),C=a(1007),A=a(5244),j=a(7466),k=a(3817),S=a(5155),I=a(3560),T=a(1387),M=a(8558),E=a(7461),D=a(416),R=a(4401),P=a(3193),B=a(9190),q=a(2221),z=a(1637),$=a(7332),L=a(7805),F=a(570),O=a(1709),U=a(5550),W=a(8920),X=a(141),N=a(1546);const V={bgcolor:"background.paper",boxShadow:"0 8px 28px rgba(0,0,0,0.22)",borderRadius:3,outline:"none",animation:"fadeIn 0.3s ease-in-out","@keyframes fadeIn":{from:{opacity:0,transform:"translate(-50%, -48%) scale(0.98)"},to:{opacity:1,transform:"translate(-50%, -50%) scale(1)"}}},Y={borderRadius:"24px",textTransform:"none",transition:"all 0.2s ease","&:hover":{transform:"scale(1.02)"}},H={boardContainer:{display:"flex",width:"100%",height:"100%",overflow:"hidden",zIndex:10},boardMain:(e,t)=>({flex:1,position:"relative",overflow:e?"auto":"hidden",cursor:e?"default":t?"grabbing":"grab",touchAction:e?"auto":"none",bgcolor:e?e=>e.palette.grey[50]:"background.paper",zIndex:10}),boardCanvas:(e,t)=>({position:"absolute",top:0,left:0,width:1e4,height:1e4,backgroundColor:"background.paper",backgroundImage:"radial-gradient(rgba(0,0,0,0.1) 1px, transparent 1px)",backgroundSize:"20px 20px",transform:`translate(${t.x}px, ${t.y}px) scale(${e})`,transformOrigin:"top left",zIndex:10}),boardTitleContainer:e=>({position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) scale(${1/e})`,pointerEvents:"none",maxWidth:"85vw",textAlign:"center"}),boardTitle:e=>({color:e=>e.palette.grey[300],fontSize:`${Math.min(16,100/(e||1))}vw`,fontWeight:700,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis","@media (max-width: 600px)":{fontSize:`calc(${Math.min(16,100/(e||1))}vw * 0.8)`}}),boardEmptyMessage:{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",color:"text.secondary",fontSize:{xs:"0.9rem",sm:"1rem"}},boardBackButtonContainer:{position:"absolute",top:16,left:16,zIndex:99},boardBackButton:{fontSize:{xs:"1.25rem",sm:"1.5rem"},bgcolor:"background.paper",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{bgcolor:e=>e.palette.grey[100],transform:"scale(1.1)"}},boardControlsContainer:{position:"fixed",bottom:16,right:16,zIndex:99,display:"flex",alignItems:"center",gap:1.5,bgcolor:"background.paper",borderRadius:3,p:1,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{transform:"scale(1.03)"},"@media (max-width: 600px)":{transform:"scale(0.9)",gap:1}},boardViewToggleButton:{...Y,px:{xs:1.75,sm:2.25},py:.75,bgcolor:e=>e.palette.grey[100],color:"text.primary","&:hover":{bgcolor:"primary.light",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},"@media (max-width: 600px)":{fontSize:"0.8rem",px:1.25}},boardZoomButton:{bgcolor:e=>e.palette.grey[100],transition:"all 0.2s ease","&:hover":{bgcolor:e=>e.palette.grey[200],transform:"scale(1.1)"}},boardZoomText:{fontSize:{xs:"0.8rem",sm:"0.875rem"},color:"text.secondary",fontWeight:500},boardListViewContainer:{p:{xs:2.5,sm:3},maxWidth:{xs:"95vw",sm:"720px"},mx:"auto",display:"flex",flexDirection:"column",minHeight:"100%"},boardListViewTweet:e=>({width:"100%",maxWidth:{xs:"95vw",sm:"640px"},mx:"auto",mb:2.5,pl:e?4:0,borderLeft:e?e=>`2px solid ${(0,N.X4)(e.palette.primary.main,.3)}`:"none"}),boardErrorContainer:{p:3,textAlign:"center"},boardErrorText:{color:"error.main",mb:2,fontWeight:500,fontSize:{xs:"0.9rem",sm:"1rem"}},boardErrorButton:{...Y,px:3.5,py:1.25,boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)",bgcolor:"primary.light"}},boardEditDialog:{"& .MuiDialog-paper":{...V,borderRadius:3,p:2.5,zIndex:111}},boardEditDialogTitle:{color:"text.primary",fontWeight:400,lineHeight:1.6,fontWeight:500,fontSize:{xs:"1.15rem",sm:"1.25rem"},pb:1.5},boardEditDialogContent:{display:"flex",flexDirection:"column",gap:2.5,pt:1.5},boardEditTextField:{"& .MuiOutlinedInput-root":{borderRadius:3,transition:"all 0.2s ease","&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{boxShadow:e=>`0 0 0 3px ${(0,N.X4)(e.palette.primary.main,.1)}`,borderColor:"primary.main"}}},boardEditFormControl:{"& .MuiOutlinedInput-root":{borderRadius:3,transition:"all 0.2s ease","&:hover fieldset":{borderColor:"primary.main"},"&.Mui-focused fieldset":{boxShadow:e=>`0 0 0 3px ${(0,N.X4)(e.palette.primary.main,.1)}`,borderColor:"primary.main"}}},boardEditCancelButton:{...Y,px:3.5,color:"text.secondary","&:hover":{bgcolor:e=>e.palette.grey[100]}},boardEditSaveButton:{...Y,px:3.5,boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.15)",bgcolor:"primary.light"},"&:disabled":{bgcolor:e=>e.palette.grey[300],color:e=>e.palette.grey[500],boxShadow:"none"}}};var Z=a(3536),K=a(6572);const Q=1e4,G=.1;var J=a(2104),ee=a(3488);var te=a(1929),ae=a.n(te),ie=a(3950),re=a.n(ie);const ne=99,oe="0 4px 16px rgba(0,0,0,0.12)",le={color:"text.primary",fontWeight:400,lineHeight:1.6},se={"&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0,0,0,0.18)"},"&:focus":{outline:e=>`2px solid ${(0,N.X4)(e.palette.primary.main,.4)}`,outlineOffset:2}},de={tweetCard:(e,t)=>({p:{xs:2.5,sm:3},mb:1.5,bgcolor:t=>e?(0,N.X4)(t.palette.warning.light,.25):t.palette.background.paper,borderRadius:3,minWidth:{xs:"20vw",sm:"260px",md:"280px"},maxWidth:t?{xs:"90vw",sm:"480px"}:{xs:"50vw",sm:"300px"},boxShadow:oe,position:"relative",opacity:.97,border:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`,transition:"all 0.3s ease",zIndex:ne,...se,"&.dragging":{opacity:1,boxShadow:"0 12px 28px rgba(0,0,0,0.22)",transform:"scale(1.04)"}}),tweetPaper:{position:"relative",overflow:"visible"},tweetTitle:{display:"none"},tweetAuthorTypography:{color:"text.secondary",fontSize:{xs:"0.8rem",sm:"0.875rem"}},pinnedIconContainer:{position:"absolute",top:20,right:20},pinnedIcon:{fontSize:"1.1rem",color:"#FFD700",transition:"all 0.2s ease","&:hover":{color:"#FFD700",transform:"scale(1.1)"}},replyToContainer:{borderLeft:e=>`4px solid ${e.palette.primary.main}`,pl:1.5,mb:1.5,bgcolor:e=>(0,N.X4)(e.palette.grey[50],.85),p:1.25,borderRadius:3,fontStyle:"italic",color:"text.secondary",fontSize:{xs:"0.85rem",sm:"0.9rem"}},replyToCaption:{fontWeight:600,color:"primary.main",fontSize:{xs:"0.85rem",sm:"0.9rem"}},replyToText:{mt:.75,fontSize:{xs:"0.85rem",sm:"0.9rem"},lineHeight:1.5},contentText:e=>({...le,mb:e?2:0,fontSize:{xs:"0.9rem",sm:"0.95rem",md:"1rem"},wordBreak:"break-word",letterSpacing:"0.01em"}),imageContainer:e=>({position:"relative",mb:e?2:0,mt:1.5,display:"flex",flexDirection:"row",flexWrap:"wrap",gap:1.5,borderRadius:1,width:"100%"}),image:e=>({width:"100%",height:e?{xs:"140px",sm:"160px"}:{xs:"70px",sm:"80px"},objectFit:"cover",objectPosition:"center",borderRadius:"15px",border:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`,opacity:.97,transition:"all 0.2s ease","&:hover":{transform:"scale(1.03)",opacity:1,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},"&:focus":{outline:e=>`2px solid ${e.palette.primary.main}`,outlineOffset:2,opacity:1}}),imagePlaceholder:{bgcolor:e=>e.palette.grey[200],width:"100%",height:"100%",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",color:e=>e.palette.grey[500],fontSize:{xs:"0.8rem",sm:"0.85rem"}},imageViewAll:{color:"primary.main",cursor:"pointer",mt:1.5,fontSize:{xs:"0.8rem",sm:"0.8rem"},fontWeight:600,textAlign:"right",transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"},"&:focus":{outline:"none",textDecoration:"underline"}},videoContainer:e=>({mb:e?2:0,mt:1.5,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center"}),videoInner:{position:"relative",borderRadius:3,overflow:"hidden"},video:e=>({width:"100%",height:e&&e<15?"120px":"200px",borderRadius:8,objectFit:"cover",objectPosition:"center",backgroundColor:"black",opacity:.97,transition:"all 0.2s ease","&:hover":{transform:"scale(1.03)",opacity:1,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),circleVideoContainer:{position:"relative",borderRadius:"50%",overflow:"hidden"},circleVideo:e=>({width:220,height:220,borderRadius:"50%",objectFit:"cover",objectPosition:"center",backgroundColor:"black",opacity:.97,transition:"all 0.2s ease","&:hover":{transform:"scale(1.03)",opacity:1,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),videoViewAll:{color:"primary.main",cursor:"pointer",mt:1.5,fontSize:{xs:"0.8rem",sm:"0.8rem"},fontWeight:600,textAlign:"right",transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},audioContainer:e=>({mb:e?2:0,mt:1.5,display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center"}),audioPlayer:{width:"100%",height:"48px",bgcolor:e=>e.palette.grey[100],borderRadius:"12px",p:1.25,position:"relative",overflow:"hidden","& audio":{width:"100%",height:"100%","&::-webkit-media-controls-panel":{backgroundColor:"transparent"},"&:hover + .audioVisualizer, &.playing + .audioVisualizer":{opacity:1}},"& .audioVisualizer":{position:"absolute",top:0,left:"0 !important",right:"0 !important",width:"100%",height:"100%",display:"flex",alignItems:"center",gap:"2px",padding:"0 8px",opacity:0,transition:"opacity 0.2s ease",pointerEvents:"none"}},audioVisualizerBar:e=>({width:"4px",height:"100%",bgcolor:"primary.main",borderRadius:"2px",animation:`pulse${e} 0.7s ease-in-out infinite alternate`,animationDelay:.05*e+"s",[`@keyframes pulse${e}`]:{"0%":{transform:"scaleY(0.3)"},"100%":{transform:"scaleY(1)"}}}),audioViewAll:{color:"primary.main",cursor:"pointer",mt:1.5,fontSize:{xs:"0.8rem",sm:"0.8rem"},fontWeight:600,textAlign:"right",transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},otherFilesContainer:(e,t)=>({mb:e?2:0,mt:1.5,width:"100%",maxWidth:{xs:"47.5vw",sm:"260px"}}),otherFileItem:e=>({display:"flex",alignItems:"center",gap:1.5,mt:e>0?1.5:0,p:1.25,borderRadius:3,transition:"all 0.2s ease","&:hover":{bgcolor:e=>e.palette.grey[100],boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),otherFileIcon:{color:"text.secondary",fontSize:{xs:"1.25rem",sm:"1.25rem"}},otherFileLink:{color:"primary.main",textDecoration:"none",fontSize:{xs:"0.85rem",sm:"0.9rem"},transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},otherFilesViewAll:{color:"primary.main",cursor:"pointer",mt:1.5,fontSize:{xs:"0.8rem",sm:"0.8rem"},fontWeight:600,textAlign:"right",transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},readMoreButton:{color:"primary.main",textTransform:"none",fontSize:{xs:"0.8rem",sm:"0.8rem"},transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},actionsContainer:{display:"flex",alignItems:"center",mt:2,justifyContent:"space-between",gap:1.5},actionButtons:{display:"flex",alignItems:"center",gap:{xs:.75,sm:1.25}},likeButton:{p:{xs:.75,sm:1},minWidth:0,borderRadius:"50%",transition:"all 0.2s ease","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.primary.light,.2),transform:"scale(1.15)"},"&:focus":{outline:"none",bgcolor:e=>(0,N.X4)(e.palette.primary.main,.2)}},likeIcon:e=>({color:e?"primary.main":"text.secondary",fontSize:{xs:"1.15rem",sm:"1.25rem"}}),likeCount:(e,t)=>({color:e?"primary.main":"text.secondary",fontSize:{xs:"0.8rem",sm:"0.8rem"},transform:t?"scale(1.25)":"scale(1)",ml:.75,transition:"transform 0.2s ease"}),replyButton:{p:{xs:.75,sm:1},minWidth:0,borderRadius:"50%",transition:"all 0.2s ease","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.primary.light,.2),transform:"scale(1.15)"},"&:focus":{outline:"none",bgcolor:e=>(0,N.X4)(e.palette.primary.main,.2)}},replyIcon:{color:"text.secondary",fontSize:{xs:"1.15rem",sm:"1.25rem"}},replyCount:{color:"text.secondary",fontSize:{xs:"0.8rem",sm:"0.8rem"},ml:.75},statusContainer:{display:"flex",alignItems:"center",gap:1.5,mt:2},menuButton:{p:{xs:.75,sm:1},minWidth:0,borderRadius:"50%",transition:"all 0.2s ease","&:hover":{bgcolor:e=>e.palette.grey[100],transform:"scale(1.15)"},"&:focus":{outline:"none",bgcolor:e=>(0,N.X4)(e.palette.grey[500],.2)}},menuIcon:{color:"text.secondary",fontSize:{xs:"1.15rem",sm:"1.25rem"}},tweetHighlight:e=>({zIndex:e?100:ne,boxShadow:e?"0 12px 36px rgba(0,0,1,1)":oe,background:e?"linear-gradient(145deg, #FFFFFF, #F9FBFD)":e=>e.palette.background.paper,transform:e?"scale(1.1) translateY(-4px)":"none",transition:"all 0.3s ease",borderColor:e?e=>e.palette.primary.main:e=>(0,N.X4)(e.palette.grey[200],.6)}),draggableContainer:(e,t,a,i)=>({position:"absolute",transform:"translate(-50%, -50%)",cursor:e?t?"grabbing":"grab":"default",zIndex:t||a?100:i?101:ne,transition:"opacity 0.2s ease, transform 0.2s ease, z-index 0.2s ease",touchAction:e?"none":"auto","&:focus":{outline:e?e=>`2px solid ${(0,N.X4)(e.palette.primary.main,.4)}`:"none",outlineOffset:2}})},ce=de;var ue=a(579);const pe=e=>{var t,a,r,n,o,l,s,d,c,u;let{tweet:p,onStop:m,children:b,currentUser:h,userRole:g,bypassOwnership:x=!1,scale:v=1}=e;const y=(0,i.useRef)(null),w=(0,i.useRef)(!1),f=(0,i.useRef)({x:null!==(t=null===(a=p.position)||void 0===a?void 0:a.x)&&void 0!==t?t:0,y:null!==(r=null===(n=p.position)||void 0===n?void 0:n.y)&&void 0!==r?r:0}),[_,C]=(0,i.useState)({x:null!==(o=null===(l=p.position)||void 0===l?void 0:l.x)&&void 0!==o?o:0,y:null!==(s=null===(d=p.position)||void 0===d?void 0:d.y)&&void 0!==s?s:0}),[A,j]=(0,i.useState)(!1),[k,S]=(0,i.useState)(!1),I=(0,i.useCallback)(((e,t)=>({x:Math.max(0,Math.min(e,9800)),y:Math.max(0,Math.min(t,9900))})),[]);(0,i.useEffect)((()=>{if(!A&&!w.current){var e,t,a,i;const r=I(null!==(e=null===(t=p.position)||void 0===t?void 0:t.x)&&void 0!==e?e:0,null!==(a=null===(i=p.position)||void 0===i?void 0:i.y)&&void 0!==a?a:0);_.x===r.x&&_.y===r.y||(C(r),f.current=r)}}),[null===(c=p.position)||void 0===c?void 0:c.x,null===(u=p.position)||void 0===u?void 0:u.y,A,_,I]);const T=(0,i.useMemo)((()=>!(!p||p.is_pinned)&&(!(!x&&!["admin","owner"].includes(g))||"viewer"===g&&(p.anonymous_id===(null===h||void 0===h?void 0:h.anonymous_id)||p.user_id===(null===h||void 0===h?void 0:h.anonymous_id)||p.username&&(null===h||void 0===h?void 0:h.username)&&p.username===h.username))),[p,x,g,null===h||void 0===h?void 0:h.anonymous_id,null===h||void 0===h?void 0:h.username]),M=(0,i.useMemo)((()=>re()(((e,t)=>{const a=I(t.x,t.y);if(a.x!==f.current.x||a.y!==f.current.y){if(isNaN(a.x)||isNaN(a.y))return void console.error("Invalid position data:",t);f.current=a,null===m||void 0===m||m(e,{x:a.x,y:a.y,tweetId:p.tweet_id})}}),150)),[m,p.tweet_id,I]);(0,i.useEffect)((()=>()=>M.cancel()),[M]);const E=(0,i.useCallback)((()=>!!T&&(j(!0),!0)),[T]),D=(0,i.useCallback)(((e,t)=>{C({x:t.x,y:t.y})}),[]),R=(0,i.useCallback)(((e,t)=>{if(!T)return;j(!1),w.current=!0,setTimeout((()=>w.current=!1),100);const a=I(t.x,t.y);f.current=a,null===m||void 0===m||m(e,{x:a.x,y:a.y,tweetId:p.tweet_id})}),[T,I,m,p.tweet_id]);return p&&p.tweet_id?(0,ue.jsx)(ae(),{nodeRef:y,position:_,positionOffset:{x:"-50%",y:"-50%"},disabled:!T,onStart:E,onDrag:D,onStop:R,cancel:"",children:(0,ue.jsx)("div",{ref:y,onMouseEnter:()=>S(!0),onMouseLeave:()=>S(!1),style:ce.draggableContainer(T,A,k,p.is_pinned),role:"region","aria-label":`Tweet by ${p.username||"Anonymous"}`,"aria-disabled":!T,tabIndex:T?0:-1,children:b})}):(console.warn("Invalid tweet in DraggableTweet:",p),null)};pe.defaultProps={bypassOwnership:!1,onStop:()=>{},scale:1};const me=(0,i.memo)(pe);var be=a(8446),he=a(8903),ge=a(279),xe=a(5721),ve=a(8968),ye=a(8734),we=a(6258),fe=a(1596),_e=a(3845),Ce=a(8831),Ae=a(900),je=a(5797),ke=a(4571),Se=a(3438),Ie=a(5173),Te=a.n(Ie),Me=a(9634),Ee=a(7351),De=a(9415),Re=a(7257),Pe=a(4399),Be=a(8666);const qe="0 4px 16px rgba(0,0,0,0.12)",ze={color:"text.primary",fontWeight:400,lineHeight:1.6},$e={bgcolor:"background.paper",boxShadow:qe,borderRadius:3,border:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`,animation:"fadeIn 0.3s ease-in-out",...{"&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0,0,0,0.18)"},"&:focus":{outline:e=>`2px solid ${e.palette.primary.main}`,outlineOffset:2}}},Le={mediaDialogContainer:{...$e,maxWidth:{xs:"100%",sm:"90vw",md:"80vw"},margin:{xs:0,sm:"auto"},height:{xs:"100%",sm:"auto"}},mediaDialogTitle:{...ze,fontSize:{xs:"1.25rem",sm:"1.5rem"},fontWeight:600,padding:{xs:"12px 16px",sm:"16px 24px"},borderBottom:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`},mediaDialogContent:{maxHeight:{xs:"70vh",sm:"60vh"},overflowY:"auto",padding:{xs:"12px",sm:"16px"},display:"flex",flexDirection:"column",gap:{xs:1.5,sm:2}},optionsDialogContainer:{...$e,maxWidth:{xs:"80vw",sm:"400px"}},optionsDialogTitle:{...ze,fontSize:{xs:"1.1rem",sm:"1.25rem"},fontWeight:600,padding:{xs:"12px 16px",sm:"16px 24px"},borderBottom:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`},optionsDialogContent:{padding:{xs:"8px 0",sm:"12px 0"},overflowY:"auto"},dialogActions:{padding:{xs:"8px",sm:"12px"},justifyContent:"flex-end"},dialogCloseButton:{width:{xs:48,sm:40},height:{xs:48,sm:40},color:"text.secondary",borderRadius:"50%",transition:"all 0.2s ease","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.grey[100],.8),transform:"scale(1.15)"},"&:active":{transform:"scale(0.95)"},"&:focus":{outline:e=>`2px solid ${e.palette.primary.main}`,outlineOffset:2}},optionsDialogItem:{padding:{xs:"12px 16px",sm:"12px 24px"},minHeight:48,transition:"all 0.2s ease","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.grey[100],.8),transform:"scale(1.03)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},"&:active":{transform:"scale(0.98)"}},modalImage:{width:"100%",maxHeight:{xs:"280px",sm:"360px"},objectFit:"contain",borderRadius:3,border:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`,transition:"all 0.2s ease","&:hover":{transform:"scale(1.03)",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}},modalImagePlaceholder:{bgcolor:e=>e.palette.grey[200],width:"100%",height:{xs:"280px",sm:"360px"},borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",color:e=>e.palette.grey[500]},modalOtherFile:{display:"flex",alignItems:"center",gap:1.5,padding:1.5,borderRadius:3,transition:"all 0.2s ease","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.grey[100],.8),boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},"&:active":{transform:"scale(0.98)"}},modalOtherFileIcon:{color:"text.secondary",fontSize:"1.25rem"},modalOtherFileLink:{color:"primary.main",textDecoration:"none",fontSize:{xs:"0.85rem",sm:"0.9rem"},transition:"all 0.2s ease","&:hover":{textDecoration:"underline",color:"primary.dark"}},errorPaper:{padding:2.5,textAlign:"center",borderRadius:8,boxShadow:qe,bgcolor:"background.paper",border:e=>`1px solid ${(0,N.X4)(e.palette.grey[200],.6)}`},errorTypography:{color:"error.main",fontWeight:500,fontSize:{xs:"0.9rem",sm:"1rem"}}};var Fe=a(2110),Oe=a(6591),Ue=a(6494),We=a(4593),Xe=a(3564),Ne=a(6213),Ve=a(1043),Ye=a.n(Ve),He=a(3775),Ze=a.n(He);const Ke={previewCard:{display:"flex",flexDirection:"row",maxWidth:"100%",marginTop:1,borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",backgroundColor:"background.paper"},previewImage:{width:"120px",height:"80px",objectFit:"cover",flexShrink:0},previewContent:{flex:1,padding:"8px",display:"flex",flexDirection:"column",justifyContent:"center",position:"relative"},previewTitle:{fontSize:"0.875rem",fontWeight:500,color:"text.primary",textDecoration:"none","& a":{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}}},previewDescription:{fontSize:"0.75rem",color:"text.secondary",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},previewPlayButton:{position:"absolute",top:"8px",right:"8px",backgroundColor:"rgba(0,0,0,0.5)",color:"white","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},previewPlayer:{marginTop:1,borderRadius:"8px",overflow:"hidden",width:"100%"},loadingContainer:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px"}},Qe=e=>{let{content:t,onTextTransform:a,onPlayClick:r}=e;const[n,o]=(0,i.useState)([]),[s,d]=(0,i.useState)(null),[u,p]=(0,i.useState)(!1),m=(0,i.useDeferredValue)(t),b=(0,i.useMemo)((()=>new Map),[]),h=(0,i.useCallback)((e=>{var t;const a=new(Ze())(e);return a.hostname.includes("youtu.be")?a.pathname.slice(1):null===(t=a.query.split("v=")[1])||void 0===t?void 0:t.split("&")[0]}),[]),x=(0,i.useCallback)((e=>{const t=new(Ze())(e);return t.pathname.includes("/videos/")?{type:"video",id:t.pathname.split("/videos/")[1]}:t.pathname.includes("/clip/")?{type:"clip",id:t.pathname.split("/clip/")[1]}:{type:"channel",id:t.pathname.slice(1)}}),[]),v=(0,i.useCallback)((e=>e.includes("music.youtube.com")),[]);(0,i.useEffect)((()=>{const e=setTimeout((async()=>{if(!m)return o([]),void(null===a||void 0===a||a(m));p(!0);const e=m.match(/(https?:\/\/[^\s]+)/g)||[],t=[...new Set(e)],i=[];let r=m;t.forEach((e=>{const t=e.length>15?`${e.slice(0,15)}...`:e;r=r.replace(e,t)})),null===a||void 0===a||a(r);for(const a of t)if(b.has(a))i.push(b.get(a));else try{let e={url:a,type:"generic"};if(a.includes("youtube.com")||a.includes("youtu.be")){const t=h(a),i=v(a),r=await Ne.A.get(`https://www.youtube.com/oembed?url=${encodeURIComponent(a)}&format=json`,{timeout:5e3});e={url:a,type:i?"youtube_music":"youtube",title:r.data.title,description:r.data.author_name,thumbnail:`https://img.youtube.com/vi/${t}/hqdefault.jpg`,embedUrl:i?`https://www.youtube.com/embed/${t}?autoplay=0`:`https://www.youtube.com/embed/${t}`}}else if(a.includes("spotify.com")){var n;const t=await Ne.A.get(`https://open.spotify.com/oembed?url=${encodeURIComponent(a)}`,{timeout:5e3});e={url:a,type:"spotify",title:t.data.title,description:t.data.provider_name,thumbnail:t.data.thumbnail_url,embedUrl:null===(n=t.data.html.match(/src="([^"]+)"/))||void 0===n?void 0:n[1]}}else if(a.includes("soundcloud.com")){var l;const t=await Ne.A.get(`https://soundcloud.com/oembed?url=${encodeURIComponent(a)}&format=json`,{timeout:5e3});e={url:a,type:"soundcloud",title:t.data.title,description:t.data.author_name,thumbnail:t.data.thumbnail_url,embedUrl:null===(l=t.data.html.match(/src="([^"]+)"/))||void 0===l?void 0:l[1]}}else if(a.includes("twitch.tv")){var s;const t=x(a);let i;"channel"===t.type?i=`https://player.twitch.tv/?channel=${t.id}&parent=${window.location.hostname}`:"video"===t.type?i=`https://player.twitch.tv/?video=${t.id}&parent=${window.location.hostname}`:"clip"===t.type&&(i=`https://clips.twitch.tv/embed?clip=${t.id}&parent=${window.location.hostname}`);const r=await Ne.A.get(`https://api.microlink.io?url=${encodeURIComponent(a)}`,{timeout:5e3});e={url:a,type:"twitch",title:r.data.data.title,description:r.data.data.description||"Twitch Stream/Clip",thumbnail:null===(s=r.data.data.image)||void 0===s?void 0:s.url,embedUrl:i,twitchType:t.type}}else{var d;const t=await Ne.A.get(`https://api.microlink.io?url=${encodeURIComponent(a)}`,{timeout:5e3});e={url:a,type:"generic",title:t.data.data.title,description:t.data.data.description,thumbnail:null===(d=t.data.data.image)||void 0===d?void 0:d.url}}(e.title||e.thumbnail)&&(b.set(a,e),i.push(e))}catch(c){console.error(`Failed to fetch preview for ${a}:`,c)}o(i),p(!1)}),500);return()=>clearTimeout(e)}),[m,h,x,v,b,a]);const y=(0,i.useCallback)((e=>{!["spotify","soundcloud"].includes(e.type)||e.embedUrl?d(s===e.url?null:e.url):null===r||void 0===r||r(e,e.type)}),[s,r]),w=(0,i.useCallback)((e=>{const t=["youtube","youtube_music","spotify","soundcloud","twitch"].includes(e.type)&&e.embedUrl,a=["youtube_music","spotify","soundcloud"].includes(e.type)?"100px":"200px";return(0,ue.jsxs)(f.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,ue.jsxs)(Fe.A,{sx:Ke.previewCard,children:[e.thumbnail&&(0,ue.jsx)(Oe.A,{component:"img",image:e.thumbnail,alt:e.title||"Preview",sx:Ke.previewImage}),(0,ue.jsxs)(Ue.A,{sx:Ke.previewContent,children:[(0,ue.jsx)(g.A,{variant:"subtitle2",sx:Ke.previewTitle,children:(0,ue.jsx)(be.A,{href:e.url,target:"_blank",rel:"noopener",children:e.title||e.url})}),e.description&&(0,ue.jsx)(g.A,{variant:"caption",sx:Ke.previewDescription,children:e.description}),["youtube","youtube_music","spotify","soundcloud","twitch"].includes(e.type)&&(0,ue.jsx)(c.A,{onClick:()=>y(e),sx:Ke.previewPlayButton,"aria-label":s===e.url?`Pause ${e.type} content`:`Play ${e.type} content`,children:s===e.url&&e.embedUrl?(0,ue.jsx)(Xe.A,{}):(0,ue.jsx)(We.A,{})})]})]}),s===e.url&&t&&e.embedUrl&&(0,ue.jsx)(l.A,{sx:Ke.previewPlayer,children:(0,ue.jsx)(Me.LazyLoadComponent,{children:(0,ue.jsx)(Ye(),{url:e.embedUrl,width:"100%",height:a,controls:!0,playing:s===e.url,config:{youtube:{playerVars:{modestbranding:1,..."youtube_music"===e.type?{playsinline:1}:{}}},soundcloud:{options:{visual:!0}},twitch:{options:{autoplay:"clip"!==e.twitchType}}},onError:()=>d(null)})})})]},e.url)}),[s,y]);return u?(0,ue.jsx)(l.A,{sx:Ke.loadingContainer,children:(0,ue.jsx)(z.A,{size:24})}):n.length?(0,ue.jsx)(l.A,{children:n.map(w)}):null};Qe.defaultProps={content:"",onTextTransform:null,onPlayClick:null};const Ge=Qe,Je={pending:"default",approved:"success",rejected:"error",announcement:"info",reminder:"warning",pinned:"primary",archived:"default"},et={initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.2}}},tt=e=>{let{label:t,onClick:a,sx:i}=e;return(0,ue.jsx)(f.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,ue.jsx)(g.A,{variant:"caption",sx:{...i,cursor:"pointer"},onClick:a,role:"button",tabIndex:0,onKeyPress:e=>"Enter"===e.key&&a(e),"aria-label":t,children:t})})},at=(0,i.memo)((e=>{let{src:t,duration:a,ariaLabel:i}=e;return(0,ue.jsx)(f.P.div,{variants:et,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(l.A,{sx:ce.mediaWrapper,role:"region","aria-label":i,children:(0,ue.jsx)(l.A,{sx:{...ce.circleVideoContainer,display:"flex",justifyContent:"center"},children:(0,ue.jsx)("video",{src:t,controls:!0,style:ce.circleVideo(a),preload:"metadata","aria-label":i})})})})}));at.propTypes={src:Te().string.isRequired,duration:Te().number,ariaLabel:Te().string.isRequired};const it=(0,i.memo)((e=>{let{src:t,duration:a,ariaLabel:i}=e;return(0,ue.jsx)(f.P.div,{variants:et,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(l.A,{sx:ce.mediaWrapper,role:"region","aria-label":i,children:(0,ue.jsx)(l.A,{sx:{...ce.videoInner,display:"flex",justifyContent:"center"},children:(0,ue.jsx)("video",{src:t,controls:!0,style:ce.video(a),preload:"metadata","aria-label":i})})})})}));it.propTypes={src:Te().string.isRequired,duration:Te().number,ariaLabel:Te().string.isRequired};const rt=(0,i.memo)((e=>{let{src:t}=e;return(0,ue.jsx)(l.A,{sx:{...ce.audioPlayer,maxWidth:"100%"},children:(0,ue.jsx)("audio",{src:t,controls:!0,sx:{width:"100%"},preload:"metadata"})})}));rt.propTypes={src:Te().string.isRequired};const nt=(0,i.memo)((e=>{let{file:t,index:a}=e;return(0,ue.jsx)(f.P.div,{variants:et,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsxs)(l.A,{sx:ce.otherFileItem(a),role:"region","aria-label":`File ${a+1}`,children:[(0,ue.jsx)(ke.A,{sx:ce.otherFileIcon}),(0,ue.jsx)(be.A,{href:t.url,target:"_blank",rel:"noopener noreferrer",sx:ce.otherFileLink,"aria-label":`Download file ${t.fileKey||`File ${a+1}`}`,children:t.fileKey||`File ${a+1}`})]})},t.fileKey||`other-${a}`)}));nt.propTypes={file:Te().shape({fileKey:Te().string,url:Te().string.isRequired}).isRequired,index:Te().number.isRequired};const ot=e=>{var t,a,r,n,o,s,d,u,p,x,y,w,_,C,A,j,k,S,I;let{tweet:T,currentUser:E,userRole:D,onLike:R,onDelete:P,onReply:B,onReplyHover:q,onEdit:$,onPinToggle:L,isParentHighlighted:F=!1,replyCount:O=0,parentTweetText:U=null,bypassOwnership:W=!1,relatedTweetIds:X=[],availableBoards:N=[],boardId:V,isListView:Y=!1,error:H=null,getParentTweetText:Z,onModalStateChange:K}=e;const[Q,G]=(0,i.useState)(!1),[J,ee]=(0,i.useState)(!1),[te,ae]=(0,i.useState)(!1),[ie,re]=(0,i.useState)(!1),[ne,oe]=(0,i.useState)(null),[le,se]=(0,i.useState)(!1),[de,pe]=(0,i.useState)(""),[me,ke]=(0,i.useState)((null===(t=T.content)||void 0===t?void 0:t.value)||""),Ie=(0,i.useDeferredValue)((null===(a=T.content)||void 0===a?void 0:a.value)||"");(0,i.useEffect)((()=>(null===K||void 0===K||K(T.tweet_id,te||ie||!!ne),()=>null===K||void 0===K?void 0:K(T.tweet_id,!1))),[te,ie,ne,T.tweet_id,K]),(0,i.useEffect)((()=>{if(!T.created_at)return;const e=(0,De.H)(T.created_at);if(!(0,Re.f)(e))return;const t=()=>{const t=new Date;pe((t-e)/1e3<604800?(0,Pe.m)(e,{addSuffix:!0}):(0,Be.GP)(e,"MMM d"))};if(t(),(new Date-e)/1e3<3600){const e=setInterval(t,6e4);return()=>clearInterval(e)}}),[T.created_at]);const Te=T.username||(null===(r=T.user)||void 0===r?void 0:r.username)||"Anonymous",qe=null!==(n=null===(o=T.liked_by)||void 0===o?void 0:o.some((e=>e.anonymous_id===(null===E||void 0===E?void 0:E.anonymous_id))))&&void 0!==n&&n,ze=W||["moderator","admin"].includes(D)||T.anonymous_id===(null===E||void 0===E?void 0:E.anonymous_id)||T.user_id===(null===E||void 0===E?void 0:E.anonymous_id)||T.username&&(null===E||void 0===E?void 0:E.username)&&T.username.toLowerCase()===E.username.toLowerCase(),$e=X.includes(T.tweet_id),Fe=O>0||(null===(s=T.child_tweet_ids)||void 0===s?void 0:s.length)>0,Oe=Fe?`${O||(null===(d=T.child_tweet_ids)||void 0===d?void 0:d.length)} ${1===O?"Reply":"Replies"}`:"",Ue=T.status||"approved",We=Je[Ue]||"default",Xe=Ue.charAt(0).toUpperCase()+Ue.slice(1),Ne=T.parent_tweet_id?U||(null===Z||void 0===Z?void 0:Z(T.parent_tweet_id))||"Parent tweet not found":null,Ve=Ne?Ne.split(/\s+/).slice(0,10).join(" ")+"...":null;(0,i.useEffect)((()=>{var e;if(void 0!==(null===(e=T.stats)||void 0===e?void 0:e.like_count)){G(!0);const e=setTimeout((()=>G(!1)),300);return()=>clearTimeout(e)}}),[null===(u=T.stats)||void 0===u?void 0:u.like_count]);const Ye=(0,i.useCallback)((()=>{var e;te||ie||ne||(ee(!0),(T.parent_tweet_id||(null===(e=T.child_tweet_ids)||void 0===e?void 0:e.length)>0)&&q&&q(T.tweet_id))}),[q,T.tweet_id,T.parent_tweet_id,T.child_tweet_ids,te,ie,ne]),He=(0,i.useCallback)((()=>{var e;te||ie||ne||(ee(!1),(T.parent_tweet_id||(null===(e=T.child_tweet_ids)||void 0===e?void 0:e.length)>0)&&q&&q(null))}),[q,T.parent_tweet_id,T.child_tweet_ids,te,ie,ne]),Ze=(0,i.useCallback)((()=>{ae(!0)}),[]),Ke=(0,i.useCallback)((()=>{ae(!1)}),[]),Qe=(0,i.useCallback)((()=>{re(!0)}),[]),ot=(0,i.useCallback)((()=>{re(!1)}),[]),lt=(0,i.useCallback)(((e,t)=>{oe({url:e.url,type:t})}),[]),st=(0,i.useCallback)((()=>{oe(null)}),[]),dt=(0,i.useCallback)((()=>{$(T),Ke()}),[$,T,Ke]),ct=(0,i.useCallback)((()=>{L(T),Ke()}),[L,T,Ke]),ut=(0,i.useCallback)((()=>{P(T.tweet_id),Ke()}),[P,T.tweet_id,Ke]),pt=(0,i.useCallback)((()=>{se((e=>!e))}),[]),{previewText:mt,remainderText:bt}=(0,i.useMemo)((()=>{const e=me||"";if(e.length<=200)return{previewText:e,remainderText:""};const t=e.slice(0,200),a=t.lastIndexOf(" ")>-1?t.lastIndexOf(" "):200;return{previewText:t.slice(0,a),remainderText:e.slice(a)}}),[me]),ht=(0,i.useMemo)((()=>{if(!T.created_at)return"";const e=(0,De.H)(T.created_at);return(0,Re.f)(e)?(0,Be.GP)(e,"PPPPpp"):""}),[T.created_at]),gt=(0,i.useMemo)((()=>{var e,t,a;const i=(null===(e=T.content)||void 0===e||null===(t=e.metadata)||void 0===t||null===(a=t.files)||void 0===a?void 0:a.filter((e=>{var t;return null===(t=e.contentType)||void 0===t?void 0:t.startsWith("image")})))||[];return i.length?(0,ue.jsxs)(l.A,{sx:{...ce.imageContainer(!!me),display:"flex",justifyContent:"center"},role:"region","aria-label":"Images",children:[(0,ue.jsx)(he.Ay,{container:!0,spacing:1,sx:{maxWidth:"100%"},children:i.slice(0,4).map(((e,t)=>(0,ue.jsx)(he.Ay,{item:!0,xs:1===i.length?12:6,sm:1===i.length?12:3,children:(0,ue.jsx)(f.P.div,{variants:et,initial:"initial",animate:"animate",exit:"exit",whileHover:{scale:1.02},children:(0,ue.jsx)(Me.LazyLoadImage,{src:e.url,alt:`Image ${t+1}`,effect:"blur",style:ce.image(1===i.length),placeholder:(0,ue.jsx)(l.A,{sx:{...ce.imagePlaceholder,borderRadius:"10px"},children:(0,ue.jsx)(z.A,{size:24})}),role:"img"})})},e.fileKey||`img-${t}`)))}),i.length>4&&(0,ue.jsx)(tt,{label:`View all images (${i.length})`,onClick:Qe,sx:ce.imageViewAll})]}):null}),[null===(p=T.content)||void 0===p||null===(x=p.metadata)||void 0===x?void 0:x.files,Qe]),xt=(0,i.useMemo)((()=>{var e,t,a;const i=(null===(e=T.content)||void 0===e||null===(t=e.metadata)||void 0===t||null===(a=t.files)||void 0===a?void 0:a.filter((e=>{var t;return null===(t=e.contentType)||void 0===t?void 0:t.startsWith("video")})))||[];return i.length?(0,ue.jsxs)(l.A,{sx:{...ce.videoContainer(!!me||gt),display:"flex",justifyContent:"center"},role:"region","aria-label":"Videos",children:["video/webm"===i[0].contentType?(0,ue.jsx)(at,{src:i[0].url,duration:i[0].duration,ariaLabel:"Recorded tweet video"}):(0,ue.jsx)(it,{src:i[0].url,duration:i[0].duration,ariaLabel:"Tweet video"}),i.length>1&&(0,ue.jsx)(tt,{label:`View all videos (${i.length})`,onClick:Qe,sx:ce.videoViewAll})]}):null}),[null===(y=T.content)||void 0===y||null===(w=y.metadata)||void 0===w?void 0:w.files,Qe,gt]),vt=(0,i.useMemo)((()=>{var e,t,a;const i=(null===(e=T.content)||void 0===e||null===(t=e.metadata)||void 0===t||null===(a=t.files)||void 0===a?void 0:a.filter((e=>{var t;return null===(t=e.contentType)||void 0===t?void 0:t.startsWith("audio")})))||[];return i.length?(0,ue.jsxs)(l.A,{sx:{...ce.audioContainer(!!me||gt||xt),display:"flex",justifyContent:"center"},role:"region","aria-label":"Audio",children:[(0,ue.jsx)(rt,{src:i[0].url}),i.length>1&&(0,ue.jsx)(tt,{label:`View all audio (${i.length})`,onClick:Qe,sx:ce.audioViewAll})]}):null}),[null===(_=T.content)||void 0===_||null===(C=_.metadata)||void 0===C?void 0:C.files,Qe,gt,xt]),yt=(0,i.useMemo)((()=>{var e,t,a;const i=(null===(e=T.content)||void 0===e||null===(t=e.metadata)||void 0===t||null===(a=t.files)||void 0===a?void 0:a.filter((e=>{var t,a,i;return!(null!==(t=e.contentType)&&void 0!==t&&t.startsWith("image"))&&!(null!==(a=e.contentType)&&void 0!==a&&a.startsWith("video"))&&!(null!==(i=e.contentType)&&void 0!==i&&i.startsWith("audio"))})))||[];return i.length?(0,ue.jsxs)(l.A,{sx:{...ce.otherFilesContainer(!!me),maxWidth:"100%"},role:"region","aria-label":"Files",children:[i.slice(0,2).map(((e,t)=>(0,ue.jsx)(nt,{file:e,index:t},e.fileKey||`other-${t}`))),i.length>2&&(0,ue.jsx)(tt,{label:`View all files (${i.length})`,onClick:Qe,sx:ce.otherFilesViewAll})]}):null}),[null===(A=T.content)||void 0===A||null===(j=A.metadata)||void 0===j?void 0:j.files,Qe]),wt=(0,i.useMemo)((()=>{const e=!!me;return(0,ue.jsxs)(f.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e&&(0,ue.jsxs)(l.A,{children:[(0,ue.jsx)(g.A,{sx:ce.contentText(!!gt||!!xt||!!vt||!!yt),children:(0,ue.jsx)(Ee.Ay,{text:mt+(!le&&bt?"...":"")})}),bt&&(0,ue.jsx)(ge.A,{in:le,timeout:"auto",unmountOnExit:!0,children:(0,ue.jsx)(g.A,{sx:ce.contentText(!!gt||!!xt||!!vt||!!yt),children:(0,ue.jsx)(Ee.Ay,{text:bt})})}),bt&&(0,ue.jsx)(tt,{label:le?"Show less":"Read more",onClick:pt,sx:ce.readMoreButton})]}),gt,xt,vt,yt,(0,ue.jsx)(Ge,{content:Ie,onTextTransform:ke,onPlayClick:lt})]})}),[me,mt,bt,le,gt,xt,vt,yt,pt,Ie,lt]),ft=(0,i.useMemo)((()=>{var e,t;const a=(null===(e=T.content)||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.files)||[];return(0,ue.jsxs)(h.A,{sx:Le.mediaDialogContent,children:[0===a.length&&(0,ue.jsx)(g.A,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:"No media available"}),a.map(((e,t)=>{var a,i,r;return(0,ue.jsx)(f.P.div,{variants:et,initial:"initial",animate:"animate",exit:"exit",children:null!==(a=e.contentType)&&void 0!==a&&a.startsWith("image")?(0,ue.jsx)(Me.LazyLoadImage,{src:e.url,alt:`Media ${t+1}`,effect:"blur",style:{...Le.modalImage,maxWidth:"100%"},placeholder:(0,ue.jsx)(l.A,{sx:{...Le.modalImagePlaceholder,borderRadius:"10px"},children:(0,ue.jsx)(z.A,{size:24})}),role:"img"}):"video/webm"===e.contentType?(0,ue.jsx)(at,{src:e.url,duration:e.duration,ariaLabel:`Recorded video ${t+1}`}):null!==(i=e.contentType)&&void 0!==i&&i.startsWith("video")?(0,ue.jsx)(it,{src:e.url,duration:e.duration,ariaLabel:`Video ${t+1}`}):null!==(r=e.contentType)&&void 0!==r&&r.startsWith("audio")?(0,ue.jsx)(rt,{src:e.url}):(0,ue.jsx)(nt,{file:e,index:t})},e.fileKey||`media-${t}`)}))]})}),[null===(k=T.content)||void 0===k||null===(S=k.metadata)||void 0===S?void 0:S.files]),_t=(0,i.useMemo)((()=>(0,ue.jsx)(h.A,{sx:Le.optionsDialogContent,children:(0,ue.jsxs)(xe.A,{children:[(0,ue.jsx)(ve.A,{onClick:dt,sx:Le.optionsDialogItem,"aria-label":"Edit tweet",children:(0,ue.jsx)(ye.A,{primary:"Edit Tweet"})}),(0,ue.jsx)(ve.A,{onClick:ct,sx:Le.optionsDialogItem,"aria-label":T.is_pinned?"Unpin tweet":"Pin tweet",children:(0,ue.jsx)(ye.A,{primary:T.is_pinned?"Unpin Tweet":"Pin Tweet"})}),(0,ue.jsx)(ve.A,{onClick:ut,sx:{...Le.optionsDialogItem,color:"error.main"},"aria-label":"Delete tweet",children:(0,ue.jsx)(ye.A,{primary:"Delete"})})]})})),[dt,ct,ut,T.is_pinned]),Ct=(0,i.useMemo)((()=>ne?(0,ue.jsxs)(m.A,{open:!!ne,onClose:st,maxWidth:"sm",fullWidth:!0,TransitionComponent:we.A,transitionDuration:500,"aria-labelledby":"link-modal-title","aria-describedby":"link-modal-description",PaperProps:{sx:{...Le.optionsDialogContainer,zIndex:110},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()},children:[(0,ue.jsx)(b.A,{id:"link-modal-title",sx:Le.optionsDialogTitle,children:"View Content"}),(0,ue.jsxs)(h.A,{sx:Le.optionsDialogContent,children:[(0,ue.jsx)(g.A,{id:"link-modal-description",variant:"body1",gutterBottom:!0,children:"This content cannot be embedded directly. Visit the link below to view it:"}),(0,ue.jsx)(be.A,{href:ne.url,target:"_blank",rel:"noopener",sx:{wordBreak:"break-all"},"aria-label":`Open ${ne.type} content in a new tab`,children:ne.url})]}),(0,ue.jsx)(v.A,{sx:Le.dialogActions,children:(0,ue.jsx)(c.A,{onClick:st,sx:Le.dialogCloseButton,"aria-label":"Close link modal",children:(0,ue.jsx)(Se.A,{})})})]}):null),[ne,st]);return H?(0,ue.jsxs)(fe.A,{sx:ce.tweetCard(!1,Y),role:"article",children:[(0,ue.jsx)(g.A,{sx:ce.tweetTitle,children:"Error"}),(0,ue.jsx)(l.A,{sx:{p:2,textAlign:"center"},children:(0,ue.jsx)(g.A,{variant:"body2",color:"error",sx:{fontWeight:500},children:H})})]}):T.tweet_id&&T.content?(0,ue.jsxs)(f.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut"},children:[(0,ue.jsxs)(fe.A,{id:`tweet-${T.tweet_id}`,className:"tweet-card",elevation:4,onMouseEnter:Ye,onMouseLeave:He,sx:{...ce.tweetCard(T.is_pinned,Y),...ce.tweetHighlight(J||$e||F),pointerEvents:te||ie||ne?"none":"auto"},role:"article","aria-labelledby":`tweet-title-${T.tweet_id}`,children:[(0,ue.jsxs)(g.A,{sx:ce.tweetTitle,id:`tweet-title-${T.tweet_id}`,children:["Tweet by ",Te]}),T.is_pinned&&(0,ue.jsx)(l.A,{sx:ce.pinnedIconContainer,children:(0,ue.jsx)(f.P.div,{whileHover:{scale:1.15},whileTap:{scale:.95},children:(0,ue.jsx)(je.A,{sx:ce.pinnedIcon})})}),Ve&&(0,ue.jsx)(f.P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.2},children:(0,ue.jsxs)(l.A,{component:"blockquote",sx:{borderLeft:"4px solid",borderColor:"primary.main",pl:2,m:0,mb:1},children:[(0,ue.jsx)(g.A,{variant:"caption",sx:ce.replyToCaption,children:"Replying to:"}),(0,ue.jsx)(g.A,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic",m:0},children:Ve})]})}),wt,(0,ue.jsxs)(l.A,{sx:{...ce.statusContainer,justifyContent:"space-between",alignItems:"center"},children:[(0,ue.jsx)(f.P.div,{whileHover:{scale:1.05},children:(0,ue.jsx)(_e.A,{label:Xe,color:We,size:"small","aria-label":`Tweet status: ${Xe}`})}),(0,ue.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[de&&(0,ue.jsx)(g.A,{variant:"caption",component:"time",dateTime:T.created_at,sx:{color:"text.secondary"},"aria-label":`Posted on ${ht}`,children:de}),(0,ue.jsxs)(g.A,{variant:"caption",sx:ce.tweetAuthorTypography,children:["Author: ",Te]})]})]}),(0,ue.jsxs)(l.A,{sx:{...ce.actionsContainer,justifyContent:"space-between"},children:[(0,ue.jsxs)(l.A,{sx:ce.actionButtons,children:[(0,ue.jsx)(f.P.div,{whileHover:{scale:1.15},whileTap:{scale:.95},children:(0,ue.jsx)(c.A,{size:"medium",onClick:()=>R(T.tweet_id,qe),"aria-label":qe?"Unlike tweet":"Like tweet",sx:ce.likeButton,disabled:te||ie||ne,children:(0,ue.jsx)(Ce.A,{sx:ce.likeIcon(qe)})})}),(0,ue.jsx)(g.A,{variant:"caption",sx:ce.likeCount(qe,Q),children:(null===(I=T.stats)||void 0===I?void 0:I.like_count)||0}),(0,ue.jsx)(f.P.div,{whileHover:{scale:1.15},whileTap:{scale:.95},children:(0,ue.jsx)(c.A,{size:"medium",onClick:()=>B(T),"aria-label":"Reply to tweet",sx:ce.replyButton,disabled:te||ie||ne,children:(0,ue.jsx)(Ae.A,{sx:ce.replyIcon})})}),Fe&&(0,ue.jsx)(g.A,{variant:"caption",sx:ce.replyCount,children:Oe})]}),ze&&(0,ue.jsx)(f.P.div,{whileHover:{scale:1.15},whileTap:{scale:.95},children:(0,ue.jsx)(c.A,{size:"medium",onClick:Ze,className:"tweet-menu","aria-label":"Tweet options",sx:ce.menuButton,disabled:te||ie||ne,children:(0,ue.jsx)(M.A,{sx:ce.menuIcon})})})]})]}),(0,ue.jsxs)(m.A,{open:ie,onClose:ot,maxWidth:"md",fullWidth:!0,fullScreen:window.innerWidth<600,TransitionComponent:we.A,transitionDuration:500,"aria-labelledby":"media-dialog-title","aria-describedby":"media-dialog-description",PaperProps:{sx:{...Le.mediaDialogContainer,zIndex:110},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()},children:[(0,ue.jsx)(b.A,{id:"media-dialog-title",sx:Le.mediaDialogTitle,children:"All Media"}),(0,ue.jsxs)(h.A,{sx:Le.mediaDialogContent,dividers:!0,children:[(0,ue.jsx)(g.A,{id:"media-dialog-description",sx:{display:"none"},children:"View all media files attached to the tweet."}),ft]}),(0,ue.jsx)(v.A,{sx:Le.dialogActions,children:(0,ue.jsx)(c.A,{onClick:ot,sx:Le.dialogCloseButton,"aria-label":"Close media dialog",children:(0,ue.jsx)(Se.A,{})})})]}),(0,ue.jsxs)(m.A,{open:te,onClose:Ke,maxWidth:"xs",fullWidth:!0,TransitionComponent:we.A,transitionDuration:500,"aria-labelledby":"options-dialog-title","aria-describedby":"options-dialog-description",PaperProps:{sx:{...Le.optionsDialogContainer,zIndex:110},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation()},children:[(0,ue.jsx)(b.A,{id:"options-dialog-title",sx:Le.optionsDialogTitle,children:"Tweet Options"}),(0,ue.jsxs)(h.A,{sx:Le.optionsDialogContent,dividers:!0,children:[(0,ue.jsx)(g.A,{id:"options-dialog-description",sx:{display:"none"},children:"Select an option to edit, pin, or delete the tweet."}),_t]}),(0,ue.jsx)(v.A,{sx:Le.dialogActions,children:(0,ue.jsx)(c.A,{onClick:Ke,sx:Le.dialogCloseButton,"aria-label":"Close options dialog",children:(0,ue.jsx)(Se.A,{})})})]}),Ct]}):(0,ue.jsxs)(fe.A,{sx:ce.tweetCard(!1,Y),role:"article",children:[(0,ue.jsx)(g.A,{sx:ce.tweetTitle,children:"Invalid Tweet"}),(0,ue.jsx)(l.A,{sx:{p:2,textAlign:"center"},children:(0,ue.jsx)(g.A,{variant:"body2",color:"error",sx:{fontWeight:500},children:"This tweet is missing required data."})})]})},lt=(e,t)=>{var a,i,r,n,o,l,s,d,c,u,p,m;return e.tweet.tweet_id===t.tweet.tweet_id&&(null===(a=e.tweet.content)||void 0===a?void 0:a.value)===(null===(i=t.tweet.content)||void 0===i?void 0:i.value)&&(null===(r=e.tweet.stats)||void 0===r?void 0:r.like_count)===(null===(n=t.tweet.stats)||void 0===n?void 0:n.like_count)&&e.tweet.is_pinned===t.tweet.is_pinned&&e.tweet.status===t.tweet.status&&(null===(o=e.tweet.liked_by)||void 0===o?void 0:o.length)===(null===(l=t.tweet.liked_by)||void 0===l?void 0:l.length)&&(null===(s=e.tweet.content)||void 0===s||null===(d=s.metadata)||void 0===d||null===(c=d.files)||void 0===c?void 0:c.length)===(null===(u=t.tweet.content)||void 0===u||null===(p=u.metadata)||void 0===p||null===(m=p.files)||void 0===m?void 0:m.length)&&e.tweet.created_at===t.tweet.created_at&&e.currentUser.anonymous_id===t.currentUser.anonymous_id&&e.currentUser.username===t.currentUser.username&&e.userRole===t.userRole&&e.isParentHighlighted===t.isParentHighlighted&&e.replyCount===t.replyCount&&e.parentTweetText===t.parentTweetText&&e.bypassOwnership===t.bypassOwnership&&e.relatedTweetIds.length===t.relatedTweetIds.length&&e.relatedTweetIds.every(((e,a)=>e===t.relatedTweetIds[a]))&&e.availableBoards.length===t.availableBoards.length&&e.boardId===t.boardId&&e.isListView===t.isListView&&e.error===t.error};ot.defaultProps={isParentHighlighted:!1,replyCount:0,parentTweetText:null,bypassOwnership:!1,relatedTweetIds:[],availableBoards:[],boardId:"",isListView:!1,error:null,getParentTweetText:null,onModalStateChange:null};const st=(0,i.memo)(ot,lt);var dt=a(5442),ct=a(7254),ut=a(611),pt=a(4156),mt=a(3875),bt=a(5237),ht=a(9354),gt=a(5404);const xt=250,vt={borderRadius:"24px",textTransform:"none",transition:"all 0.2s ease","&:hover":{transform:"scale(1.02)"},"&:active":{transform:"scale(0.98)"}},yt=e=>({color:e?"error.main":"text.secondary"}),wt=e=>({color:e?"primary.main":"text.secondary",bgcolor:e?e=>(0,N.X4)(e.palette.primary.main,.1):"transparent","&:hover":{bgcolor:e=>(0,N.X4)(e.palette.primary.main,.2),transform:"scale(1.1)"},"&:active":{transform:"scale(0.95)"}}),ft={popupModal:{"& .MuiDialog-paper":{...{bgcolor:"background.paper",boxShadow:"0 8px 28px rgba(0,0,0,0.22)",borderRadius:3,outline:"none",animation:"fadeIn 0.3s ease-in-out","@keyframes fadeIn":{from:{opacity:0,transform:"translate(-50%, -48%) scale(0.98)"},to:{opacity:1,transform:"translate(-50%, -50%) scale(1)"}}},position:"absolute",minWidth:"300px",maxWidth:"95vw",bgcolor:e=>(0,N.X4)(e.palette.background.paper,.98),backdropFilter:"blur(12px)",p:2,zIndex:100,...{"&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 24px rgba(0,0,0,0.18)"},"&:focus":{outline:e=>`2px solid ${(0,N.X4)(e.palette.primary.main,.4)}`,outlineOffset:2}}},"&.MuiBackdropRoot":{backgroundColor:e=>(0,N.X4)(e.palette.grey[900],.5)}},popupTitle:{display:"none"},popupTextField:{"& .MuiInputBase-root":{borderRadius:"16px",padding:"10px 14px",bgcolor:e=>e.palette.grey[50],transition:"all 0.2s ease",minHeight:"48px"},"& .MuiOutlinedInput-notchedOutline":{borderColor:e=>e.palette.grey[200]},"&:hover .MuiOutlinedInputNotchedOutline":{borderColor:"primary.main",boxShadow:e=>`0 0 0 2px ${(0,N.X4)(e.palette.primary.main,.1)}`},"&.Mui-focused .MuiOutlinedInputNotchedOutline":{borderColor:"primary.main",boxShadow:e=>`0 0 0 3px ${(0,N.X4)(e.palette.primary.main,.15)}`}},popupCharCount:e=>({alignSelf:"flex-end",fontSize:{xs:"0.75rem",sm:"0.8rem"},...yt(e)}),popupFilePreviewContainer:{mt:1,bgcolor:"transparent",borderRadius:8,p:.5,transition:"all 0.2s ease"},popupPreviewMedia:{width:"100%",height:xt,objectFit:"cover",borderRadius:4,border:"1px solid",borderColor:e=>e.palette.grey[200],transition:"transform 0.2s ease","&:hover":{transform:"scale(1.01)"}},popupCirclePreviewMedia:{width:xt,height:xt,objectFit:"cover",borderRadius:"50%",border:"1px solid",borderColor:e=>e.palette.grey[200],backgroundColor:"black",transition:"transform 0.2s ease","&:hover":{transform:"scale(1.01)"}},popupPreviewPlaceholder:{width:"100%",height:xt,bgcolor:e=>e.palette.grey[100],borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.8rem",color:"text.secondary"},popupDeleteFileButton:{position:"absolute",top:8,right:8,bgcolor:e=>(0,N.X4)(e.palette.error.main,.8),color:"white",p:.5,transition:"all 0.2s ease","&:hover":{bgcolor:e=>e.palette.error.dark}},popupActionButton:{...vt,px:3,py:1,fontWeight:600,borderRadius:"16px","&:hover":{bgcolor:"primary.dark"}},popupCancelButton:{...vt,px:3,py:1,bgcolor:e=>e.palette.grey[200],color:"text.primary",borderRadius:"16px","&:hover":{bgcolor:e=>e.palette.grey[300]}},popupInputBar:{display:"flex",alignItems:"center",bgcolor:e=>e.palette.grey[50],borderRadius:"16px",p:.75,mt:1,position:"sticky",bottom:0,zIndex:11,boxShadow:"0 1px 4px rgba(0,0,0,0.1)",transition:"all 0.2s ease","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},popupMediaButton:e=>({p:1,borderRadius:"50%",...wt(e)}),popupRecordingContainer:{mt:1,display:"flex",flexDirection:"column",alignItems:"center",gap:1},popupRecordingChip:{bgcolor:e=>e.palette.error.main,color:"white",fontWeight:500,borderRadius:"12px",px:2,py:.5,animation:"pulse 2s infinite","@keyframes pulse":{"0%":{transform:"scale(0.95)"},"50%":{transform:"scale(1.05)"},"100%":{transform:"scale(0.95)"}}},popupRecordingControls:{display:"flex",gap:1,mt:.5,justifyContent:"center"},popupVideoPreviewContainer:{justifyContent:"center",alignItems:"center",border:"50%",mt:1.5,animation:"fadeIn 0.3s ease-in","@keyframes fadeIn":{from:{opacity:0,transform:"scale(0.9)"},to:{opacity:1,transform:"scale(1)"}}},popupLivePreview:{width:xt,height:xt,borderRadius:"50%",border:"2px solid",borderColor:e=>e.palette.grey[300],bgcolor:"black",objectFit:"cover",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",transition:"all 0.3s ease"},popupAudioVisualizer:function(){return{position:"absolute",width:"30%",height:"30%",display:"flex",alignItems:"center",gap:"2px",opacity:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:0,transition:"opacity 0.2s ease",pointerEvents:"none"}},popupVisualizerBar:e=>({width:"40px",height:"30%",bgcolor:"primary.main",borderRadius:"1px",animation:`pulse${e} ${.5+e%5*.15}s ease-in-out infinite alternate`,animationDelay:.03*e+"s",[`@keyframes pulse${e}`]:{"0%":{transform:`scaleY(${.2+e%4*.1})`},"100%":{transform:`scaleY(${.8+e%4*.1})`}}}),popupAudioPlayer:{width:"100%",height:"40px",bgcolor:e=>e.palette.grey[50],borderRadius:"16px",p:.75,position:"relative",overflow:"hidden",transition:"all 0.2s ease",boxShadow:"0 1px 4px rgba(0,0,0,0.1)","&:hover":{boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},"& audio":{width:"100%",height:"100%","&::-webkit-media-controls-panel":{backgroundColor:"transparent"},"&:hover + .audioVisualizer, &.playing + .audioVisualizer":{opacity:1}}},popupProgressContainer:{mt:1,display:"flex",flexDirection:"column",gap:.5},popupDialogPaper:{position:"absolute",m:1,padding:"5px",width:{xs:"95vw",sm:"600px"},maxWidth:{sm:"90vw"},maxHeight:"90vh",overflowY:"auto",backgroundColor:e=>(0,N.X4)(e.palette.background.paper,.98),backdropFilter:"blur(12px)",borderRadius:3,boxShadow:"0 4px 12px rgba(0,0,0,0.2)",zIndex:100},popupDialogBackdrop:{backgroundColor:e=>(0,N.X4)(e.palette.grey[900],.5)},popupContentBox:{display:"flex",flexDirection:"column",gap:1.5,p:{xs:2,sm:2.5}},popupErrorAlert:{borderRadius:3},popupParentTweetCaption:{color:"text.secondary",fontStyle:"italic",fontSize:{xs:"0.8rem",sm:"0.85rem"}},popupScheduleButton:{alignSelf:"flex-start",textTransform:"none",color:"primary.main",fontSize:{xs:"0.8rem",sm:"0.85rem"}},popupButtonContainer:{display:"flex",justifyContent:"flex-end",mt:1.5,gap:1}};var _t=a(1694),Ct=a.n(_t);const At=["image/jpeg","image/png","image/gif","video/mp4","video/webm","audio/mpeg","audio/wav","application/pdf","image/svg+xml","audio/webm"],jt=52428800,kt=10,St={string:"{{#label}} must be a string",required:"{{#label}} is required",uuid:"{{#label}} must be a valid UUID v4",max:"{{#label}} cannot exceed {{#limit}} characters",pattern:"{{#label}} has an invalid format",array:"{{#label}} must be an array",min:"{{#label}} must have at least {{#limit}} items",enum:"{{#label}} must be one of {{#enum}}",uri:"{{#label}} must be a valid HTTP/HTTPS URL",number:"{{#label}} must be a number",integer:"{{#label}} must be an integer",boolean:"{{#label}} must be a boolean",date:"{{#label}} must be a valid ISO date"},It=Ct().string().uuid({version:["uuidv4"]}).required().messages({"string.uuid":St.uuid.replace("{{#label}}","ID"),"any.required":St.required.replace("{{#label}}","ID")}),Tt=Ct().object({status:Ct().string().valid("pending","approved","rejected","announcement","reminder","pinned","archived").optional(),page:Ct().number().integer().min(1).default(1),limit:Ct().number().integer().min(1).max(100).default(20),sort:Ct().string().valid("created_at:asc","created_at:desc","like_count:desc","comment_count:desc").default("created_at:desc"),pinned_only:Ct().boolean().default(!1),hashtag:Ct().string().pattern(/^#[a-zA-Z0-9_]{1,50}$/).optional(),mention:Ct().string().pattern(/^@[a-zA-Z0-9_]{1,50}$/).optional()}).label("QuerySchema"),Mt=(Ct().object({page:Ct().number().integer().min(1).default(1),limit:Ct().number().integer().min(1).max(100).default(20),sort:Ct().string().valid("created_at:asc","created_at:desc","like_count:desc").default("created_at:desc")}).label("CommentQuerySchema"),Ct().object({type:Ct().string().valid("text","image","video","audio","file","drawing","poll","event","link","quote","embed","voice","video_message").default("text").messages({"any.only":"Invalid content type"}),value:Ct().string().max(1e3).when("type",{is:"text",then:Ct().string().trim().min(1).required().messages({"string.min":"Text content must be at least 1 character","any.required":'Text content is required for type "text"'}),otherwise:Ct().string().allow("").optional()}),metadata:Ct().object({files:Ct().array().items().max(10).default([]).optional(),hashtags:Ct().array().items(Ct().string().pattern(/^#[a-zA-Z0-9_]{1,50}$/)).max(10).default([]).optional(),mentions:Ct().array().items(Ct().string().pattern(/^@[a-zA-Z0-9_]{1,50}$/)).max(10).default([]).optional()}).default({})}).label("Content")),Et=Ct().object({x:Ct().number().min(0).required().messages({"number.min":"X coordinate must be non-negative","any.required":"X coordinate is required"}),y:Ct().number().min(0).required().messages({"number.min":"Y coordinate must be non-negative","any.required":"Y coordinate is required"})}).label("Position"),Dt=Ct().object({schedule:Ct().date().iso().min("now").required().messages({"date.min":"Reminder schedule must be in the future","any.required":"Reminder schedule is required"}),recurrence:Ct().string().valid("none","daily","weekly","monthly").default("none").messages({"any.only":"Recurrence must be one of: none, daily, weekly, monthly"}),enabled:Ct().boolean().default(!0)}).label("Reminder"),Rt={string:"{{#label}} must be a string",required:"{{#label}} is required",uuid:"{{#label}} must be a valid UUID v4",max:"{{#label}} cannot exceed {{#limit}} characters",pattern:"{{#label}} has an invalid format",array:"{{#label}} must be an array",min:"{{#label}} must have at least {{#limit}} items",enum:"{{#label}} must be one of {{#enum}}",uri:"{{#label}} must be a valid HTTP/HTTPS URL",hexColor:"{{#label}} must be a valid hexadecimal color code (e.g., #FFFFFF)",number:"{{#label}} must be a number",integer:"{{#label}} must be an integer",boolean:"{{#label}} must be a boolean",date:"{{#label}} must be a valid ISO date"},Pt=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,Bt=(Ct().object({conversationId:Ct().string().pattern(Pt).required().messages({"string.base":Rt.string.replace("{{#label}}","Conversation ID"),"string.pattern.base":Rt.uuid.replace("{{#label}}","Conversation ID"),"any.required":Rt.required.replace("{{#label}}","Conversation ID")})}).label("ConversationIdParam"),Ct().object({page:Ct().number().integer().min(1).default(1).messages({"number.base":Rt.number.replace("{{#label}}","Page"),"number.integer":Rt.integer.replace("{{#label}}","Page"),"number.min":"Page must be at least 1"}),limit:Ct().number().integer().min(1).max(100).default(20).messages({"number.base":Rt.number.replace("{{#label}}","Limit"),"number.integer":Rt.integer.replace("{{#label}}","Limit"),"number.min":"Limit must be at least 1","number.max":"Limit cannot exceed 100"}),cursor:Ct().date().iso().optional().messages({"date.base":Rt.date.replace("{{#label}}","Cursor")}),type:Ct().string().valid("direct","group","channel").optional().messages({"string.base":Rt.string.replace("{{#label}}","Type"),"any.only":Rt.enum.replace("{{#label}}","Type").replace("{{#enum}}","direct, group, channel")}),visibility:Ct().string().valid("public","private","hidden").optional().messages({"string.base":Rt.string.replace("{{#label}}","Visibility"),"any.only":Rt.enum.replace("{{#label}}","Visibility").replace("{{#enum}}","public, private, hidden")}),archived:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Archived")}),pinned:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Pinned")}),muted:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Muted")}),sort:Ct().string().valid("updatedAt:desc","updatedAt:asc","name:asc","name:desc").default("updatedAt:desc").messages({"string.base":Rt.string.replace("{{#label}}","Sort"),"any.only":Rt.enum.replace("{{#label}}","Sort").replace("{{#enum}}","updatedAt:desc, updatedAt:asc, name:asc, name:desc")})}).label("GetConversationsQuery"),Ct().object({friendId:Ct().string().pattern(Pt).optional().messages({"string.base":Rt.string.replace("{{#label}}","Friend ID"),"string.pattern.base":Rt.uuid.replace("{{#label}}","Friend ID")}),type:Ct().string().valid("direct","group","channel").default("direct").messages({"string.base":Rt.string.replace("{{#label}}","Type"),"any.only":Rt.enum.replace("{{#label}}","Type").replace("{{#enum}}","direct, group, channel")}),name:Ct().string().trim().max(100).min(3).optional().when("type",{is:"group",then:Ct().string().required().messages({"any.required":Rt.required.replace("{{#label}}","Name")})}).messages({"string.base":Rt.string.replace("{{#label}}","Name"),"string.max":Rt.max.replace("{{#label}}","Name").replace("{{#limit}}","100"),"string.min":"Name must be at least 3 characters"}),members:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":Rt.uuid.replace("{{#label}}","Each member ID")})).optional().when("type",{is:"group",then:Ct().array().min(1).max(1e3).required().messages({"array.min":Rt.min.replace("{{#label}}","Members").replace("{{#limit}}","1"),"array.max":"Members cannot exceed 1000 users","any.required":Rt.required.replace("{{#label}}","Members")})}).when("type",{is:"channel",then:Ct().array().min(1).max(1e4).required().messages({"array.min":Rt.min.replace("{{#label}}","Members").replace("{{#limit}}","1"),"array.max":"Members cannot exceed 10000 users","any.required":Rt.required.replace("{{#label}}","Members")})}).messages({"array.base":Rt.array.replace("{{#label}}","Members")}),visibility:Ct().string().valid("public","private","hidden").default("public").messages({"string.base":Rt.string.replace("{{#label}}","Visibility"),"any.only":Rt.enum.replace("{{#label}}","Visibility").replace("{{#enum}}","public, private, hidden")}),tags:Ct().array().items(Ct().string().trim().max(50).pattern(/^[a-zA-Z0-9_]+$/).messages({"string.base":Rt.string.replace("{{#label}}","Each tag"),"string.max":Rt.max.replace("{{#label}}","Each tag").replace("{{#limit}}","50"),"string.pattern.base":"Each tag can only contain letters, numbers, and underscores"})).max(10).optional().messages({"array.base":Rt.array.replace("{{#label}}","Tags"),"array.max":"Tags cannot exceed 10 items"}),initialMessage:Ct().object({type:Ct().string().valid("text","image","video","audio","file").default("text").messages({"any.only":Rt.enum.replace("{{#label}}","Initial message type").replace("{{#enum}}","text, image, video, audio, file")}),content:Ct().string().max(2e3).when("type",{is:"text",then:Ct().string().trim().min(1).required().messages({"string.min":"Initial message content must be at least 1 character","any.required":'Initial message content is required for type "text"'}),otherwise:Ct().string().uri().optional().messages({"string.uri":Rt.uri.replace("{{#label}}","Initial message content")})}).messages({"string.base":Rt.string.replace("{{#label}}","Initial message content"),"string.max":Rt.max.replace("{{#label}}","Initial message content").replace("{{#limit}}","2000")}),files:Ct().array().items(Ct().object({url:Ct().string().uri().required().messages({"string.uri":Rt.uri.replace("{{#label}}","File URL"),"any.required":Rt.required.replace("{{#label}}","File URL")}),fileKey:Ct().string().required().messages({"string.base":Rt.string.replace("{{#label}}","File key"),"any.required":Rt.required.replace("{{#label}}","File key")}),contentType:Ct().string().valid(...At).required().messages({"any.only":"File content type must be one of supported MIME types","any.required":Rt.required.replace("{{#label}}","File content type")}),size:Ct().number().max(jt).required().messages({"number.max":"File size cannot exceed 50MB","any.required":Rt.required.replace("{{#label}}","File size")})})).max(kt).optional().messages({"array.max":"Files cannot exceed 10 items"})}).optional()}).or("friendId","members").messages({"object.missing":"Either friendId (for direct) or members (for group/channel) is required"}).label("CreateConversation"),Ct().object({name:Ct().string().trim().max(100).min(3).optional().messages({"string.base":Rt.string.replace("{{#label}}","Name"),"string.max":Rt.max.replace("{{#label}}","Name").replace("{{#limit}}","100"),"string.min":"Name must be at least 3 characters"}),description:Ct().string().trim().max(500).allow("").optional().messages({"string.base":Rt.string.replace("{{#label}}","Description"),"string.max":Rt.max.replace("{{#label}}","Description").replace("{{#limit}}","500")}),visibility:Ct().string().valid("public","private","hidden").optional().messages({"string.base":Rt.string.replace("{{#label}}","Visibility"),"any.only":Rt.enum.replace("{{#label}}","Visibility").replace("{{#enum}}","public, private, hidden")}),permissions:Ct().object({sendMessages:Ct().string().valid("all","admins","moderators").optional().messages({"string.base":Rt.string.replace("{{#label}}","Send messages permission"),"any.only":Rt.enum.replace("{{#label}}","Send messages permission").replace("{{#enum}}","all, admins, moderators")}),addMembers:Ct().string().valid("all","admins","moderators").optional().messages({"string.base":Rt.string.replace("{{#label}}","Add members permission"),"any.only":Rt.enum.replace("{{#label}}","Add members permission").replace("{{#enum}}","all, admins, moderators")}),pinMessages:Ct().string().valid("all","admins","moderators").optional().messages({"string.base":Rt.string.replace("{{#label}}","Pin messages permission"),"any.only":Rt.enum.replace("{{#label}}","Pin messages permission").replace("{{#enum}}","all, admins, moderators")})}).optional(),tags:Ct().array().items(Ct().string().trim().max(50).pattern(/^[a-zA-Z0-9_]+$/).messages({"string.base":Rt.string.replace("{{#label}}","Each tag"),"string.max":Rt.max.replace("{{#label}}","Each tag").replace("{{#limit}}","50"),"string.pattern.base":"Each tag can only contain letters, numbers, and underscores"})).max(10).optional().messages({"array.base":Rt.array.replace("{{#label}}","Tags"),"array.max":"Tags cannot exceed 10 items"}),admins:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":Rt.uuid.replace("{{#label}}","Each admin ID")})).optional().messages({"array.base":Rt.array.replace("{{#label}}","Admins")}),moderators:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":Rt.uuid.replace("{{#label}}","Each moderator ID")})).optional().messages({"array.base":Rt.array.replace("{{#label}}","Moderators")})}).min(1).messages({"object.min":"At least one field must be provided for update"}).label("UpdateConversation"),Ct().object({members:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":Rt.uuid.replace("{{#label}}","Each member ID")})).min(1).max(1e3).required().messages({"array.base":Rt.array.replace("{{#label}}","Members"),"array.min":Rt.min.replace("{{#label}}","Members").replace("{{#limit}}","1"),"array.max":"Cannot add more than 1000 members at once","any.required":Rt.required.replace("{{#label}}","Members")})}).label("AddMembers"),Ct().object({members:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":Rt.uuid.replace("{{#label}}","Each member ID")})).min(1).max(1e3).required().messages({"array.base":Rt.array.replace("{{#label}}","Members"),"array.min":Rt.min.replace("{{#label}}","Members").replace("{{#limit}}","1"),"array.max":"Cannot remove more than 1000 members at once","any.required":Rt.required.replace("{{#label}}","Members")})}).label("RemoveMembers"),Ct().object({theme:Ct().string().valid("light","dark","custom").optional().messages({"string.base":Rt.string.replace("{{#label}}","Theme"),"any.only":Rt.enum.replace("{{#label}}","Theme").replace("{{#enum}}","light, dark, custom")}),background:Ct().string().uri({scheme:["http","https"]}).allow(null).optional().messages({"string.base":Rt.string.replace("{{#label}}","Background"),"string.uri":Rt.uri.replace("{{#label}}","Background")}),font:Ct().string().pattern(/^[a-zA-Z\s-]+$/).max(50).optional().messages({"string.base":Rt.string.replace("{{#label}}","Font"),"string.pattern.base":Rt.pattern.replace("{{#label}}","Font"),"string.max":Rt.max.replace("{{#label}}","Font").replace("{{#limit}}","50")}),bubbleStyle:Ct().object({senderColor:Ct().string().pattern(/^#[0-9A-Fa-f]{6}$/).optional().messages({"string.base":Rt.string.replace("{{#label}}","Sender color"),"string.pattern.base":Rt.hexColor.replace("{{#label}}","Sender color")}),receiverColor:Ct().string().pattern(/^#[0-9A-Fa-f]{6}$/).optional().messages({"string.base":Rt.string.replace("{{#label}}","Receiver color"),"string.pattern.base":Rt.hexColor.replace("{{#label}}","Receiver color")}),textColor:Ct().string().pattern(/^#[0-9A-Fa-f]{6}$/).optional().messages({"string.base":Rt.string.replace("{{#label}}","Text color"),"string.pattern.base":Rt.hexColor.replace("{{#label}}","Text color")})}).optional(),accessibility:Ct().object({highContrast:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","High contrast")}),largeText:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Large text")}),screenReader:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Screen reader")})}).optional(),notificationSound:Ct().string().valid("default","silent","custom1","custom2").optional().messages({"string.base":Rt.string.replace("{{#label}}","Notification sound"),"any.only":Rt.enum.replace("{{#label}}","Notification sound").replace("{{#enum}}","default, silent, custom1, custom2")})}).min(1).messages({"object.min":"At least one field must be provided for settings update"}).label("UpdateChatSettings"),Ct().object({inviteLink:Ct().string().uri({scheme:["http","https"]}).required().pattern(/\/conversations\/join\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i).messages({"string.base":Rt.string.replace("{{#label}}","Invite link"),"string.uri":Rt.uri.replace("{{#label}}","Invite link"),"string.pattern.base":"Invite link must contain a valid conversation ID","any.required":Rt.required.replace("{{#label}}","Invite link")})}).label("JoinViaInvite"),Ct().object({ephemeral:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Ephemeral")}),ephemeralTTL:Ct().number().integer().min(60).max(604800).optional().when("ephemeral",{is:!0,then:Ct().required().messages({"any.required":Rt.required.replace("{{#label}}","Ephemeral TTL")})}).messages({"number.base":Rt.number.replace("{{#label}}","Ephemeral TTL"),"number.integer":Rt.integer.replace("{{#label}}","Ephemeral TTL"),"number.min":"Ephemeral TTL must be at least 60 seconds","number.max":"Ephemeral TTL cannot exceed 604800 seconds (7 days)"})}).min(1).messages({"object.min":"At least one field must be provided for ephemeral settings update"}).label("UpdateEphemeralSettings"),Ct().object({muteUntil:Ct().date().iso().min("now").optional().messages({"date.base":Rt.date.replace("{{#label}}","Mute until"),"date.min":"Mute until must be in the future"}),pushEnabled:Ct().boolean().optional().messages({"boolean.base":Rt.boolean.replace("{{#label}}","Push enabled")}),notificationSound:Ct().string().valid("default","silent","custom1","custom2").optional().messages({"string.base":Rt.string.replace("{{#label}}","Notification sound"),"any.only":Rt.enum.replace("{{#label}}","Notification sound").replace("{{#enum}}","default, silent, custom1, custom2")})}).min(1).messages({"object.min":"At least one field must be provided for mute settings"}).label("MuteConversation"),Ct().object({conversationId:Ct().string().pattern(Pt).required().messages({"string.base":"Conversation ID must be a string (e.g)","string.pattern.base":"Conversation ID must be a valid UUID format","any.required":"Conversation ID is required to send a message"}),content:Ct().string().allow("").max(1e4).optional().messages({"string.base":St.string.replace("{{#label}}","Content"),"string.max":St.max.replace("{{#label}}","Content").replace("{{#limit}}","10000")}),media:Ct().array().items(Ct().object({type:Ct().string().valid("file","image","video","voice","sticker","gif").required().messages({"string.base":St.string.replace("{{#label}}","Media type"),"any.only":St.enum.replace("{{#label}}","Media type").replace("{{#enum}}","file, image, video, voice, sticker, gif")}),content:Ct().string().required().messages({"string.base":St.string.replace("{{#label}}","Media content"),"any.required":St.required.replace("{{#label}}","Media content")}),contentType:Ct().string().valid(...At).required().messages({"string.base":St.string.replace("{{#label}}","Content type"),"any.only":"Content type must be one of supported MIME types","any.required":St.required.replace("{{#label}}","Content type")}),thumbnail:Ct().string().uri({scheme:["http","https"]}).optional().messages({"string.base":St.string.replace("{{#label}}","Thumbnail"),"string.uri":St.uri.replace("{{#label}}","Thumbnail")}),shape:Ct().string().valid("square","circle","rectangle").default("square").messages({"string.base":St.string.replace("{{#label}}","Shape"),"any.only":St.enum.replace("{{#label}}","Shape").replace("{{#enum}}","square, circle, rectangle")}),metadata:Ct().object({size:Ct().number().integer().min(0).max(jt).optional().messages({"number.max":"File size cannot exceed 50MB"}),duration:Ct().number().min(0).optional(),width:Ct().number().integer().min(0).optional(),height:Ct().number().integer().min(0).optional()}).optional()})).max(kt).optional().messages({"array.base":St.array.replace("{{#label}}","Media"),"array.max":"Media cannot exceed 10 items"}),replyTo:Ct().string().pattern(Pt).optional().messages({"string.base":St.string.replace("{{#label}}","ReplyTo"),"string.pattern.base":St.uuid.replace("{{#label}}","ReplyTo")}),scheduledAt:Ct().date().iso().min("now").optional().messages({"date.base":"ScheduledAt must be a valid ISO date","date.min":"ScheduledAt must be a future date"}),forwardedFrom:Ct().string().pattern(Pt).optional().allow(null).messages({"string.base":St.string.replace("{{#label}}","ForwardedFrom"),"string.pattern.base":St.uuid.replace("{{#label}}","ForwardedFrom")}),threadId:Ct().string().pattern(Pt).optional().allow(null).messages({"string.base":St.string.replace("{{#label}}","Thread ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Thread ID")}),hashtags:Ct().array().items(Ct().string().pattern(/^#[a-zA-Z0-9_]{1,50}$/).messages({"string.pattern.base":"Each hashtag must start with # and contain only letters, numbers, or underscores"})).max(10).optional().messages({"array.base":St.array.replace("{{#label}}","Hashtags"),"array.max":"Hashtags cannot exceed 10 items"}),mentions:Ct().array().items(Ct().string().pattern(/^@[a-zA-Z0-9_]{1,50}$/).messages({"string.pattern.base":"Each mention must start with @ and contain only letters, numbers, or underscores"})).max(10).optional().messages({"array.base":St.array.replace("{{#label}}","Mentions"),"array.max":"Mentions cannot exceed 10 items"})}).or("content","media").messages({"object.missing":"Either message content or media is required"}).label("SendMessageBody"),Ct().object({page:Ct().number().integer().min(1).default(1).messages({"number.base":St.number.replace("{{#label}}","Page"),"number.min":"Page must be at least 1"}),limit:Ct().number().integer().min(1).max(100).default(20).messages({"number.base":St.number.replace("{{#label}}","Limit"),"number.min":"Limit must be at least 1","number.max":"Limit cannot exceed 100"}),cursor:Ct().date().iso().optional().messages({"date.base":St.date.replace("{{#label}}","Cursor")}),threadId:Ct().string().pattern(Pt).optional().messages({"string.base":St.string.replace("{{#label}}","Thread ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Thread ID")}),sort:Ct().string().valid("createdAt:asc","createdAt:desc").default("createdAt:desc").messages({"string.base":St.string.replace("{{#label}}","Sort"),"any.only":St.enum.replace("{{#label}}","Sort").replace("{{#enum}}","createdAt:asc, createdAt:desc")})}).label("GetMessagesQuery"),Ct().object({messageId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Message ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Message ID"),"any.required":St.required.replace("{{#label}}","Message ID")})}).label("MessageIdParam"),Ct().object({messageId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Message ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Message ID"),"any.required":St.required.replace("{{#label}}","Message ID")}),newContent:Ct().string().max(1e4).required().messages({"string.base":St.string.replace("{{#label}}","New content"),"string.max":St.max.replace("{{#label}}","New content").replace("{{#limit}}","10000"),"any.required":St.required.replace("{{#label}}","New content")})}).label("EditMessage"),Ct().object({query:Ct().string().trim().min(1).max(500).required().messages({"string.base":St.string.replace("{{#label}}","Query"),"string.min":"Query must be at least 1 character","string.max":St.max.replace("{{#label}}","Query").replace("{{#limit}}","500"),"any.required":St.required.replace("{{#label}}","Query")}),limit:Ct().number().integer().min(1).max(100).default(50).messages({"number.base":St.number.replace("{{#label}}","Limit"),"number.min":"Limit must be at least 1","number.max":"Limit cannot exceed 100"}),fromUserId:Ct().string().pattern(Pt).optional().messages({"string.base":St.string.replace("{{#label}}","From user ID"),"string.pattern.base":St.uuid.replace("{{#label}}","From user ID")}),mediaType:Ct().string().valid("image","video","audio","file","sticker","gif").optional().messages({"string.base":St.string.replace("{{#label}}","Media type"),"any.only":St.enum.replace("{{#label}}","Media type").replace("{{#enum}}","image, video, audio, file, sticker, gif")})}).label("SearchMessages"),Ct().object({conversationId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Conversation ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Conversation ID"),"any.required":St.required.replace("{{#label}}","Conversation ID")}),question:Ct().string().trim().max(500).required().messages({"string.base":St.string.replace("{{#label}}","Question"),"string.max":St.max.replace("{{#label}}","Question").replace("{{#limit}}","500"),"any.required":St.required.replace("{{#label}}","Question")}),options:Ct().array().items(Ct().string().trim().max(100)).min(2).max(10).required().messages({"array.base":St.array.replace("{{#label}}","Options"),"array.min":St.min.replace("{{#label}}","Options").replace("{{#limit}}","2"),"array.max":"Options cannot exceed 10 items","string.base":St.string.replace("{{#label}}","Each option"),"string.max":St.max.replace("{{#label}}","Each option").replace("{{#limit}}","100"),"any.required":St.required.replace("{{#label}}","Options")}),allowMultipleVotes:Ct().boolean().optional().messages({"boolean.base":St.boolean.replace("{{#label}}","Allow multiple votes")}),pollExpiresAt:Ct().date().iso().min("now").optional().messages({"date.base":St.date.replace("{{#label}}","Poll expiration"),"date.min":"Poll expiration must be in the future"})}).label("CreatePoll"),Ct().object({optionIndex:Ct().number().integer().min(0).required().messages({"number.base":St.number.replace("{{#label}}","Option index"),"number.min":"Option index must be at least 0","any.required":St.required.replace("{{#label}}","Option index")})}).label("VotePoll"),Ct().object({reaction:Ct().string().trim().max(10).required().messages({"string.base":St.string.replace("{{#label}}","Reaction"),"string.max":St.max.replace("{{#label}}","Reaction").replace("{{#limit}}","10"),"any.required":St.required.replace("{{#label}}","Reaction")})}).label("AddReaction"),Ct().object({fileType:Ct().string().valid(...At).required().messages({"string.base":St.string.replace("{{#label}}","File type"),"any.only":"File type must be one of supported MIME types","any.required":St.required.replace("{{#label}}","File type")}),contentType:Ct().string().valid("file","image","video","voice","sticker","gif").required().messages({"string.base":St.string.replace("{{#label}}","Content type"),"any.only":St.enum.replace("{{#label}}","Content type").replace("{{#enum}}","file, image, video, voice, sticker, gif"),"any.required":St.required.replace("{{#label}}","Content type")}),fileSize:Ct().number().integer().min(1).max(jt).optional().messages({"number.base":St.number.replace("{{#label}}","File size"),"number.min":"File size must be at least 1 byte","number.max":"File size cannot exceed 50MB"})}).label("GeneratePresignedUrl"),Ct().object({messageId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Message ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Message ID"),"any.required":St.required.replace("{{#label}}","Message ID")}),targetConversationIds:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":St.uuid.replace("{{#label}}","Each target conversation ID")})).min(1).max(50).required().messages({"array.base":St.array.replace("{{#label}}","Target conversation IDs"),"array.min":St.min.replace("{{#label}}","Target conversation IDs").replace("{{#limit}}","1"),"array.max":"Cannot forward to more than 50 conversations","any.required":St.required.replace("{{#label}}","Target conversation IDs")}),comment:Ct().string().max(500).optional().messages({"string.base":St.string.replace("{{#label}}","Comment"),"string.max":St.max.replace("{{#label}}","Comment").replace("{{#limit}}","500")})}).label("ForwardMessage"),Ct().object({conversationId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Conversation ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Conversation ID"),"any.required":St.required.replace("{{#label}}","Conversation ID")}),content:Ct().string().allow("").max(1e4).optional().messages({"string.base":St.string.replace("{{#label}}","Content"),"string.max":St.max.replace("{{#label}}","Content").replace("{{#limit}}","10000")}),media:Ct().array().items(Ct().object({type:Ct().string().valid("file","image","video","voice","sticker","gif").required().messages({"string.base":St.string.replace("{{#label}}","Media type"),"any.only":St.enum.replace("{{#label}}","Media type").replace("{{#enum}}","file, image, video, voice, sticker, gif")}),content:Ct().string().required().messages({"string.base":St.string.replace("{{#label}}","Media content"),"any.required":St.required.replace("{{#label}}","Media content")}),contentType:Ct().string().valid(...At).required().messages({"string.base":St.string.replace("{{#label}}","Content type"),"any.only":"Content type must be one of supported MIME types","any.required":St.required.replace("{{#label}}","Content type")}),thumbnail:Ct().string().uri({scheme:["http","https"]}).optional().messages({"string.base":St.string.replace("{{#label}}","Thumbnail"),"string.uri":St.uri.replace("{{#label}}","Thumbnail")}),metadata:Ct().object({size:Ct().number().integer().min(0).max(jt).optional().messages({"number.max":"File size cannot exceed 50MB"}),duration:Ct().number().min(0).optional(),width:Ct().number().integer().min(0).optional(),height:Ct().number().integer().min(0).optional()}).optional()})).max(kt).optional().messages({"array.base":St.array.replace("{{#label}}","Media"),"array.max":"Media cannot exceed 10 items"}),replyTo:Ct().string().pattern(Pt).optional().messages({"string.base":St.string.replace("{{#label}}","ReplyTo"),"string.pattern.base":St.uuid.replace("{{#label}}","ReplyTo")}),threadId:Ct().string().pattern(Pt).optional().messages({"string.base":St.string.replace("{{#label}}","Thread ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Thread ID")})}).label("CreateMessageDraft"),Ct().object({messageIds:Ct().array().items(Ct().string().pattern(Pt).messages({"string.pattern.base":St.uuid.replace("{{#label}}","Each message ID")})).min(1).max(100).required().messages({"array.base":St.array.replace("{{#label}}","Message IDs"),"array.min":St.min.replace("{{#label}}","Message IDs").replace("{{#limit}}","1"),"array.max":"Cannot process more than 100 messages at once","any.required":St.required.replace("{{#label}}","Message IDs")})}).label("BulkMessageAction"),Ct().object({conversationId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Conversation ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Conversation ID"),"any.required":St.required.replace("{{#label}}","Conversation ID")}),parentMessageId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Parent message ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Parent message ID"),"any.required":St.required.replace("{{#label}}","Parent message ID")}),content:Ct().string().allow("").max(1e4).optional().messages({"string.base":St.string.replace("{{#label}}","Content"),"string.max":St.max.replace("{{#label}}","Content").replace("{{#limit}}","10000")}),media:Ct().array().items(Ct().object({type:Ct().string().valid("file","image","video","voice","sticker","gif").required().messages({"string.base":St.string.replace("{{#label}}","Media type"),"any.only":St.enum.replace("{{#label}}","Media type").replace("{{#enum}}","file, image, video, voice, sticker, gif")}),content:Ct().string().required().messages({"string.base":St.string.replace("{{#label}}","Media content"),"any.required":St.required.replace("{{#label}}","Media content")}),contentType:Ct().string().valid(...At).required().messages({"string.base":St.string.replace("{{#label}}","Content type"),"any.only":"Content type must be one of supported MIME types","any.required":St.required.replace("{{#label}}","Content type")}),thumbnail:Ct().string().uri({scheme:["http","https"]}).optional().messages({"string.base":St.string.replace("{{#label}}","Thumbnail"),"string.uri":St.uri.replace("{{#label}}","Thumbnail")}),metadata:Ct().object({size:Ct().number().integer().min(0).max(jt).optional().messages({"number.max":"File size cannot exceed 50MB"}),duration:Ct().number().min(0).optional(),width:Ct().number().integer().min(0).optional(),height:Ct().number().integer().min(0).optional()}).optional()})).max(kt).optional().messages({"array.base":St.array.replace("{{#label}}","Media"),"array.max":"Media cannot exceed 10 items"})}).or("content","media").messages({"object.missing":"Either content or media is required"}).label("CreateThread"),Ct().object({messageId:Ct().string().pattern(Pt).required().messages({"string.base":St.string.replace("{{#label}}","Message ID"),"string.pattern.base":St.uuid.replace("{{#label}}","Message ID"),"any.required":St.required.replace("{{#label}}","Message ID")}),notify:Ct().boolean().required().messages({"boolean.base":St.boolean.replace("{{#label}}","Notify"),"any.required":St.required.replace("{{#label}}","Notify")})}).label("MessageNotification"),function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Validation error";const{error:i}=e.validate(t,{abortEarly:!1,stripUnknown:!0});if(i){const e=i.details.map((e=>e.message)).join("; ");throw new Error(`${a}: ${e}`)}}),qt=1e3,zt=52428800,$t=e=>{var t;let{x:a,y:r,onSubmit:n,onClose:o,parentTweet:s,onBoardUpdate:u}=e;const[p,w]=(0,i.useState)({draft:"",scheduledAt:""}),[_,C]=(0,i.useState)(""),[A,j]=(0,i.useState)(null),[k,S]=(0,i.useState)(null),[I,M]=(0,i.useState)(0),[E,D]=(0,i.useState)("voice"),[R,P]=(0,i.useState)(!1),[B,q]=(0,i.useState)(!1),[$,L]=(0,i.useState)(null),[F,O]=(0,i.useState)(0),[U,W]=(0,i.useState)(!1),[X,N]=(0,i.useState)(!1),[V,Y]=(0,i.useState)(null),[H,Z]=(0,i.useState)(null),K=(0,i.useRef)(null),Q=(0,i.useRef)(null),G=(0,i.useRef)(null),J=(0,i.useRef)(null),ee=(0,i.useRef)(null),te=(0,i.useRef)(null),{files:ae,handleFileChange:ie,removeFile:re,cleanup:ne,fileUrlsRef:oe}=(()=>{const[e,t]=(0,i.useState)([]),[a,r]=(0,i.useState)(null),[n,o]=(0,i.useState)(0),l=(0,i.useRef)(new Map),s=(0,i.useCallback)((e=>e?At.includes(e.type)?!(e.size>jt)||(r("File size exceeds 50MB limit"),!1):(r(`Unsupported file type: ${e.type}. Supported types: images, videos, audio.`),!1):(r("No file selected"),!1)),[]),d=(0,i.useCallback)((a=>{const i=Array.from(a.target.files).filter(s);i.length+e.length>kt?r("Maximum 10 files allowed"):(t((e=>[...e,...i])),r(null))}),[e,s]),c=(0,i.useCallback)((e=>{t((t=>{const a=t[e],i=l.current.get(a);return i&&(URL.revokeObjectURL(i),l.current.delete(a)),t.filter(((t,a)=>a!==e))}))}),[]),u=(0,i.useCallback)((async(e,t)=>{try{for(let e=0;e<=100;e+=10)await new Promise((e=>setTimeout(e,200))),t(e);return e.map((e=>({fileKey:e.name,url:URL.createObjectURL(e),contentType:e.type})))}catch(a){throw r("Failed to upload files"),a}}),[]),p=(0,i.useCallback)((()=>{l.current.forEach((e=>URL.revokeObjectURL(e))),l.current.clear(),t([]),o(0),r(null)}),[]);return{files:e,setFiles:t,error:a,setError:r,uploadProgress:n,setUploadProgress:o,handleFileChange:d,removeFile:c,uploadFiles:u,cleanup:p,fileUrlsRef:l}})(),le=(0,dt.A)((e=>e.breakpoints.down("sm"))),se=(0,gt.useDrag)((e=>{let{movement:[t],event:a}=e;Math.abs(t)>50&&(D("voice"===E?"video_message":"voice"),a.preventDefault())}),{enabled:le&&!k});(0,i.useEffect)((()=>{var e;return null===(e=G.current)||void 0===e||e.focus(),C(p.draft),()=>{ne(),me()}}),[ne]),(0,i.useEffect)((()=>(A&&!R&&(ee.current=setInterval((()=>{M((e=>{const t=e+1;return 1e3*t>=3e5&&(me(),L("Recording stopped: Maximum duration reached (5 minutes).")),t}))}),1e3)),()=>clearInterval(ee.current))),[A,R]),(0,i.useEffect)((()=>(A&&"video_message"===k&&J.current&&(J.current.srcObject=A,J.current.play().catch((e=>{console.error("Video preview error:",e),L("Failed to display video preview.")}))),()=>{J.current&&(J.current.srcObject=null)})),[A,k]);const de=(0,i.useCallback)((async e=>{try{const t="voice"===e?{audio:!0}:{audio:!0,video:{width:1280,height:720}},a=await navigator.mediaDevices.getUserMedia(t),i=new MediaRecorder(a,{mimeType:"voice"===e?"audio/webm":"video/webm;codecs=vp8,opus"}),r=[];i.ondataavailable=e=>r.push(e.data),i.onstop=()=>{const t="voice"===e?"audio/webm":"video/webm",i=new Blob(r,{type:t}),n=`${e}_${Date.now()}.webm`,o=new File([i],n,{type:t});i.size>zt?L("Recorded file exceeds 50MB limit."):(ie({target:{files:[o]}}),a.getTracks().forEach((e=>e.stop())))},i.start(1e3),Q.current=i,j(a),S(e),M(0),P(!1),L(null)}catch(t){L("Failed to start recording. Please check microphone/camera permissions."),console.error("Recording error:",t)}}),[ie]),ce=(0,i.useCallback)((()=>{Q.current&&A&&!R&&(Q.current.pause(),P(!0))}),[A,R]),pe=(0,i.useCallback)((()=>{Q.current&&A&&R&&(Q.current.resume(),P(!1))}),[A,R]),me=(0,i.useCallback)((()=>{Q.current&&(Q.current.stop(),Q.current=null),A&&A.getTracks().forEach((e=>e.stop())),J.current&&(J.current.srcObject=null),j(null),S(null),M(0),P(!1),clearInterval(ee.current)}),[A]),xe=((0,i.useCallback)((()=>{me(),L(null)}),[me]),(0,i.useCallback)((e=>{const t=Array.from(e.target.files).filter((e=>At.includes(e.type)?!(e.size>zt)||(L(`File too large: ${e.name} exceeds 50MB limit`),!1):(L(`Unsupported file type: ${e.name}`),!1)));t.length&&(ie({target:{files:t}}),L(null)),K.current.value=null}),[ie])),ve=(0,i.useCallback)((async()=>{if(p.draft.trim()||ae.length)if(p.draft.length>qt)L("Tweet exceeds 1000 character limit.");else if(p.scheduledAt&&new Date(p.scheduledAt)<new Date)L("Scheduled time must be in the future.");else{q(!0),L(null);try{const e={type:ae.length?ae[0].type.split("/")[0]:"text",value:p.draft.trim()||"",metadata:{files:ae.map(((e,t)=>({fileKey:e.name,url:oe.current.get(e)||URL.createObjectURL(e),contentType:e.type,duration:e.type.startsWith("video")?0:void 0}))),style:{},hashtags:[],mentions:[],poll_options:[],event_details:{},quote_ref:null,embed_data:null}},t=s?{x:s.position.x,y:s.position.y+180}:{x:a,y:r+180},i=await n(e,t.x,t.y,p.scheduledAt||null,ae,(e=>O(e)),(null===s||void 0===s?void 0:s.tweet_id)||null);u&&i&&u(i),N(!0),setTimeout((()=>{w({draft:"",scheduledAt:""}),ne(),o(),N(!1)}),500)}catch(e){L(e.message||"Failed to submit tweet."),console.error("Submit error:",e)}finally{q(!1),O(0)}}else L("Please add text or media to submit.")}),[p,ae,n,ne,o,oe,s,a,r,u]),ye=(0,i.useCallback)((e=>{"Enter"!==e.key||e.shiftKey||A||(e.preventDefault(),ve())}),[ve,A]),we=(0,i.useMemo)((()=>B||!p.draft.trim()&&!ae.length||p.draft.length>qt||!!A),[B,p.draft,ae,A]),fe=(0,i.useCallback)(((e,t)=>{const a=oe.current.get(e)||URL.createObjectURL(e);return oe.current.set(e,a),(0,ue.jsx)(he.Ay,{item:!0,xs:12,children:(0,ue.jsx)(l.A,{sx:ft.popupFilePreviewContainer,children:e.type.startsWith("image")?(0,ue.jsx)(Me.LazyLoadImage,{src:a,alt:`Preview ${t+1}`,style:ft.popupPreviewMedia,effect:"blur",placeholder:(0,ue.jsx)(l.A,{sx:ft.popupPreviewPlaceholder,children:"Loading Image..."})}):e.type.startsWith("video")?(0,ue.jsxs)(l.A,{sx:{position:"relative"},children:[(0,ue.jsx)("video",{src:a,style:ft.popupCirclePreviewMedia,controls:!0,preload:"metadata",poster:a+"#t=0.1","aria-label":`Video preview ${t+1}`}),(0,ue.jsx)(l.A,{sx:ft.popupPreviewOverlay,children:(0,ue.jsx)(c.A,{size:"small",onClick:()=>re(t),sx:ft.popupDeleteFileButton,"aria-label":`Remove file ${t+1}`,children:(0,ue.jsx)(T.A,{fontSize:"small"})})})]}):e.type.startsWith("audio")?(0,ue.jsxs)(l.A,{sx:ft.popupAudioPlayer,children:[(0,ue.jsx)("audio",{src:a,controls:!0,style:{width:"100%"},preload:"metadata","aria-label":`Audio preview ${t+1}`}),(0,ue.jsx)(l.A,{sx:ft.popupAudioVisualizer(!1),children:[...Array(24)].map(((e,t)=>(0,ue.jsx)(l.A,{sx:ft.popupVisualizerBar(t)},t)))}),(0,ue.jsx)(l.A,{sx:ft.popupPreviewOverlay,children:(0,ue.jsx)(c.A,{size:"small",onClick:()=>re(t),sx:ft.popupDeleteFileButton,"aria-label":`Remove file ${t+1}`,children:(0,ue.jsx)(T.A,{fontSize:"small"})})})]}):(0,ue.jsx)(l.A,{sx:ft.popupPreviewPlaceholder,children:(0,ue.jsxs)(g.A,{variant:"caption",children:["File: ",e.name]})})})},`file-${t}`)}),[re,oe]),Ce=(0,i.useMemo)((()=>{if(!A)return null;const e=Math.floor(I/60),t=`Recording ${"voice"===k?"Audio":"Video"}: ${e}:${(I%60).toString().padStart(2,"0")}`;return(0,ue.jsxs)(l.A,{sx:ft.popupRecordingContainer,children:[(0,ue.jsx)(_e.A,{label:t,sx:ft.popupRecordingChip,"aria-label":`Recording ${k} duration`}),"video_message"===k?(0,ue.jsx)(l.A,{sx:ft.popupVideoPreviewContainer,children:(0,ue.jsx)("video",{ref:J,style:ft.popupLivePreview,muted:!0,autoPlay:!0,"aria-label":"Live video recording preview"})}):(0,ue.jsx)(l.A,{sx:ft.popupAudioVisualizer(!0),children:[...Array(24)].map(((e,t)=>(0,ue.jsx)(l.A,{sx:ft.popupVisualizerBar(t)},t)))}),(0,ue.jsxs)(l.A,{sx:ft.popupRecordingControls,children:[(0,ue.jsx)(d.A,{title:R?"Resume":"Pause",placement:"top",children:(0,ue.jsx)(c.A,{onClick:R?pe:ce,sx:ft.popupMediaButton(R),"aria-label":R?"Resume recording":"Pause recording",children:R?(0,ue.jsx)(We.A,{fontSize:"small"}):(0,ue.jsx)(Xe.A,{fontSize:"small"})})}),(0,ue.jsx)(d.A,{title:"Stop",placement:"top",children:(0,ue.jsx)(c.A,{onClick:me,sx:ft.popupMediaButton(!1),"aria-label":"Stop recording",children:(0,ue.jsx)(pt.A,{fontSize:"small"})})})]})]})}),[A,k,I,R,ce,pe,me]),Ae=(0,i.useCallback)((e=>()=>k===e?me():de(e)),[k,de,me]),je=(0,i.useMemo)((()=>(0,ue.jsxs)(l.A,{sx:{...ft.popupInputBar,position:"static",zIndex:"auto",gap:1,flexDirection:"column"},children:[(0,ue.jsxs)(l.A,{sx:{display:"flex",gap:1,width:"100%"},children:[(0,ue.jsx)("input",{type:"file",accept:At.join(","),multiple:!0,onChange:xe,style:{display:"none"},ref:K,disabled:B||A}),(0,ue.jsx)(d.A,{title:"Upload Media",placement:"top",children:(0,ue.jsx)(c.A,{onClick:()=>K.current.click(),sx:ft.popupMediaButton(!1),"aria-label":"Upload media",disabled:B||A,children:(0,ue.jsx)(mt.A,{fontSize:"small"})})}),(0,ue.jsxs)(l.A,{sx:{position:"relative",flex:1},children:[(0,ue.jsx)(x.A,{placeholder:s?"Write your reply...":"What's on your mind?",value:p.draft,onChange:e=>w((t=>({...t,draft:e.target.value}))),onKeyPress:ye,autoFocus:!0,fullWidth:!0,multiline:!0,maxRows:4,variant:"outlined",sx:{...ft.popupTextField,"& .MuiOutlinedInput-root":{borderRadius:"12px",padding:"6px 12px",minHeight:"32px",fontSize:"0.875rem"}},inputProps:{maxLength:qt},"aria-label":s?"Reply content":"Tweet content",disabled:B}),(0,ue.jsxs)(g.A,{variant:"caption",sx:{...ft.popupCharCount(p.draft.length>qt),position:"absolute",right:"8px",bottom:"4px",fontSize:"0.75rem"},"aria-live":"polite",children:[p.draft.length,"/",qt]})]}),(0,ue.jsx)(f.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.2},children:"voice"===k?(0,ue.jsx)(d.A,{title:"Stop Audio Recording (save to add another)",placement:"top",children:(0,ue.jsx)(c.A,{onClick:Ae("voice"),sx:ft.popupMediaButton(!0),"aria-label":"Stop audio recording",disabled:B,children:(0,ue.jsx)(pt.A,{fontSize:"small"})})}):"video_message"===k?(0,ue.jsx)(d.A,{title:"Stop Video Recording (save to add another)",placement:"top",children:(0,ue.jsx)(c.A,{onClick:Ae("video_message"),sx:ft.popupMediaButton(!0),"aria-label":"Stop video recording",disabled:B,children:(0,ue.jsx)(pt.A,{fontSize:"small"})})}):(0,ue.jsx)(d.A,{title:le?`Start ${"voice"===E?"Audio":"Video"} Recording (swipe or hold to switch)`:`Start ${"voice"===E?"Audio":"Video"} Recording (right-click to switch)`,placement:"top",children:(0,ue.jsx)(c.A,{...se(),onClick:()=>Ae(E)(),onTouchStart:()=>{le&&(te.current=setTimeout((()=>{D("voice"===E?"video_message":"voice")}),500))},onTouchEnd:()=>{le&&te.current&&(clearTimeout(te.current),te.current=null)},onContextMenu:e=>{le||(e.preventDefault(),D("voice"===E?"video_message":"voice"))},sx:ft.popupMediaButton(!1),"aria-label":le?`Start ${"voice"===E?"audio":"video"} recording, hold to switch mode`:`Start ${"voice"===E?"audio":"video"} recording, right-click to switch mode`,"aria-haspopup":"true",disabled:B,children:"voice"===E?(0,ue.jsx)(bt.A,{fontSize:"small"}):(0,ue.jsx)(ht.A,{fontSize:"small"})})})},k||E),(0,ue.jsx)(d.A,{title:le?"Submit tweet (long-press for schedule)":"Submit tweet (right-click for schedule)",placement:"top",children:(0,ue.jsx)(y.A,{onClick:e=>{V||ve(),e.preventDefault()},onContextMenu:e=>{le||(e.preventDefault(),Y(e.currentTarget))},onTouchStart:()=>{le&&(te.current=setTimeout((()=>{Y(K.current)}),500))},onTouchEnd:()=>{le&&te.current&&(clearTimeout(te.current),te.current=null)},variant:"contained",color:"primary",sx:{...ft.popupActionButton,minWidth:"90px"},disabled:we,"aria-label":"Submit tweet or open schedule menu","aria-controls":V?"schedule-menu":void 0,"aria-haspopup":"true",children:B?(0,ue.jsx)(z.A,{size:24,color:"inherit"}):s?"Reply":"Add Post"})})]}),(0,ue.jsx)(Ge,{content:p.draft,onTextTransform:C,onPlayClick:(e,t)=>{["spotify","soundcloud"].includes(t)&&!e.embedUrl&&Z({url:e.url,type:t})}})]})),[k,A,B,xe,de,me,p.draft,s,ye,ve,we,ae,E,le,se,Ae]),ke=(0,i.useMemo)((()=>H?(0,ue.jsxs)(m.A,{open:!!H,onClose:()=>Z(null),maxWidth:"sm",fullWidth:!0,children:[(0,ue.jsx)(b.A,{children:"View Content"}),(0,ue.jsxs)(h.A,{children:[(0,ue.jsx)(g.A,{variant:"body1",gutterBottom:!0,children:"This content cannot be embedded directly. Visit the link below to view it:"}),(0,ue.jsx)(be.A,{href:H.url,target:"_blank",rel:"noopener",sx:{wordBreak:"break-all"},children:H.url})]}),(0,ue.jsx)(v.A,{children:(0,ue.jsx)(y.A,{onClick:()=>Z(null),color:"primary",children:"Close"})})]}):null),[H]);return(0,ue.jsxs)(f.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:X?1.05:1},transition:{duration:.3},children:[(0,ue.jsxs)(m.A,{open:!0,onClose:o,PaperProps:{sx:{...ft.popupDialogPaper,position:"relative"}},sx:{"& .MuiBackdrop-root":ft.popupDialogBackdrop},"aria-labelledby":"tweet-popup-title",ref:G,children:[(0,ue.jsx)(c.A,{onClick:o,sx:{position:"absolute",top:10,right:25,zIndex:1,color:"grey.600",padding:"4px","&:hover":{bgcolor:"grey.200"}},"aria-label":"Close tweet popup",disabled:B||F>0,children:(0,ue.jsx)(Se.A,{fontSize:"small"})}),(0,ue.jsx)(g.A,{id:"tweet-popup-title",sx:{...ft.popupTitle,pr:5},children:s?"Reply to Tweet":"Create a new tweet"}),(0,ue.jsxs)(l.A,{sx:ft.popupContentBox,children:[$&&(0,ue.jsx)(ct.A,{severity:"error",onClose:()=>L(null),sx:ft.popupErrorAlert,children:$}),s&&(0,ue.jsxs)(l.A,{sx:{mb:2},children:[(0,ue.jsx)(g.A,{variant:"subtitle2",sx:{mb:.5,fontWeight:"medium"},children:"Replying to:"}),(0,ue.jsx)(l.A,{component:"blockquote",sx:{borderLeft:"4px solid",borderColor:"primary.main",pl:2,color:"text.secondary",fontStyle:"italic",m:0},children:(0,ue.jsxs)(g.A,{variant:"body2",children:[null===(t=s.content)||void 0===t?void 0:t.value.split(/\s+/).slice(0,10).join(" "),"..."]})})]}),ae.length>0&&(0,ue.jsxs)(l.A,{sx:ft.popupFilePreviewContainer,children:[(0,ue.jsx)(he.Ay,{container:!0,spacing:1,children:ae.slice(0,4).map(((e,t)=>fe(e,t)))}),ae.length>4&&(0,ue.jsxs)(g.A,{variant:"caption",sx:{mt:1,color:"text.secondary"},children:["+",ae.length-4," more file(s)"]})]}),Ce,B&&F>0&&(0,ue.jsxs)(l.A,{sx:ft.popupProgressContainer,children:[(0,ue.jsx)(ut.A,{variant:"determinate",value:F}),(0,ue.jsxs)(g.A,{variant:"caption",sx:{color:"text.secondary"},children:["Uploading: ",F,"%"]})]}),(0,ue.jsx)(ge.A,{in:U,timeout:"auto",children:(0,ue.jsx)(x.A,{label:"Schedule (optional)",type:"datetime-local",value:p.scheduledAt,onChange:e=>w((t=>({...t,scheduledAt:e.target.value}))),fullWidth:!0,InputLabelProps:{shrink:!0},sx:{...ft.popupTextField,mb:1},inputProps:{min:(new Date).toISOString().slice(0,16)},"aria-label":"Schedule tweet",disabled:B||A})}),je]})]}),ke]})};$t.defaultProps={parentTweet:null,onBoardUpdate:null};const Lt=(e,t)=>e.x===t.x&&e.y===t.y&&e.onSubmit===t.onSubmit&&e.onClose===t.onClose&&(0,Z.isEqual)(e.parentTweet,t.parentTweet)&&e.onBoardUpdate===t.onBoardUpdate,Ft=(0,i.memo)($t,Lt);var Ot=a(9472);const Ut="/api/v1/tweets",Wt=(e,t)=>{var a,i,r,n,o,l,s,d,c,u,p,m,b,h,g,x,v,y,w;if(!e||"object"!==typeof e)return console.warn("Invalid tweet input:",e),{tweet_id:"",content:{type:"text",value:"",metadata:{files:[],hashtags:[],mentions:[]}},anonymous_id:(null===t||void 0===t?void 0:t.anonymous_id)||"",username:(null===t||void 0===t?void 0:t.username)||"",position:{x:0,y:0},parent_tweet_id:null,child_tweet_ids:[],is_anonymous:!1,liked_by:[],is_liked:!1,stats:{likes:0,like_count:0,view_count:0},created_at:(new Date).toISOString(),status:"approved",scheduled_at:null,reminder:null,is_pinned:!1,analytics:{views:[],shares:[]}};const f=e.content||{type:"text",value:"",metadata:{}},_={files:(null===(a=f.metadata)||void 0===a?void 0:a.files)||[],hashtags:(null===(i=f.metadata)||void 0===i?void 0:i.hashtags)||[],mentions:(null===(r=f.metadata)||void 0===r?void 0:r.mentions)||[],style:(null===(n=f.metadata)||void 0===n?void 0:n.style)||{},poll_options:(null===(o=f.metadata)||void 0===o?void 0:o.poll_options)||[],event_details:(null===(l=f.metadata)||void 0===l?void 0:l.event_details)||{},quote_ref:(null===(s=f.metadata)||void 0===s?void 0:s.quote_ref)||null,embed_data:(null===(d=f.metadata)||void 0===d?void 0:d.embed_data)||null};return{tweet_id:e.tweet_id||"",content:{type:f.type||"text",value:f.value||"",metadata:_},anonymous_id:e.anonymous_id||(null===t||void 0===t?void 0:t.anonymous_id)||"",username:e.is_anonymous?"Anonymous":e.username||(null===t||void 0===t?void 0:t.username)||"",position:{x:Number(null===(c=e.position)||void 0===c?void 0:c.x)||0,y:Number(null===(u=e.position)||void 0===u?void 0:u.y)||0},parent_tweet_id:e.parent_tweet_id||null,child_tweet_ids:e.child_tweet_ids||[],children:(null===(p=e.children)||void 0===p?void 0:p.map((e=>Wt(e,t))))||[],is_anonymous:!!e.is_anonymous,liked_by:e.liked_by||[],is_liked:e.is_liked||(e.liked_by||[]).some((e=>e.anonymous_id===(null===t||void 0===t?void 0:t.anonymous_id)))||!1,stats:{likes:null!==(m=null===(b=e.stats)||void 0===b?void 0:b.like_count)&&void 0!==m?m:(e.liked_by||[]).length,like_count:null!==(h=null===(g=e.stats)||void 0===g?void 0:g.like_count)&&void 0!==h?h:(e.liked_by||[]).length,view_count:null!==(x=null===(v=e.stats)||void 0===v?void 0:v.view_count)&&void 0!==x?x:0},created_at:e.created_at||(new Date).toISOString(),updated_at:e.updated_at||e.created_at||(new Date).toISOString(),status:e.status||"approved",scheduled_at:e.scheduled_at||null,reminder:e.reminder||null,is_pinned:!!e.is_pinned,analytics:{views:(null===(y=e.analytics)||void 0===y?void 0:y.views)||[],shares:(null===(w=e.analytics)||void 0===w?void 0:w.shares)||[]}}},Xt="Authentication required.",Nt="Board ID is missing.",Vt="Tweet ID is missing.",Yt="Tweet must have text or files.",Ht="Valid position (x, y) is required.",Zt="Target board ID is missing.",Kt="Invalid reminder data.",Qt="Share platform is missing.",Gt="Failed to upload file.",Jt="An error occurred.",ea={MAX_CACHE_SIZE:10,CACHE_EXPIRY_MS:18e5,DEBOUNCE_MS:300,DEFAULT_LIMIT:20,CACHE_VERSION:"v1"};const ta=new class{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return null;const{value:t,timestamp:a}=this.cache.get(e);return Date.now()-a>ea.CACHE_EXPIRY_MS?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,{value:t,timestamp:a}),t)}set(e,t){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{value:t,timestamp:Date.now()})}clear(){this.cache.clear()}}(ea.MAX_CACHE_SIZE),aa=function(e,t,a,r,n){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const[l,s]=(0,i.useState)([]),[d,c]=(0,i.useState)(null),[u,p]=(0,i.useState)({page:1,limit:ea.DEFAULT_LIMIT,total:0,hasMore:!0}),[m,b]=(0,i.useState)(null),[h,g]=(0,i.useState)(null),x=(0,i.useRef)(null),v=(0,i.useCallback)(((e,t)=>{if("AbortError"===e.name)return Promise.resolve(null);const a=e.status||500;401!==a&&403!==a||(r("Session expired. Please log in again."),n("/login"));const i=t||e.message||Jt;return g(i),Promise.reject(new Error(i))}),[r,n]),y=(0,i.useCallback)((async(e,t,a)=>{try{const i=e.type.split("/")[0],{presignedUrl:r,fileKey:n,contentType:o}=await(async(e,t,a)=>{Bt(Ct().string().required(),e,"Invalid fileType"),Bt(Ct().string().required(),t,"Invalid contentType");try{return(await(0,Ot.bE)(`${Ut}/presigned-url`,{fileType:e,contentType:t},{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(h){throw(0,Ot.hS)(h)}})(e.type,i,t),l=new XMLHttpRequest;return l.open("PUT",r,!0),l.setRequestHeader("Content-Type",e.type),l.upload.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);null===a||void 0===a||a(t)}},new Promise(((t,a)=>{l.onload=()=>{200===l.status?t({fileKey:n,contentType:o,size:e.size,url:r.split("?")[0]}):a(new Error(`Upload failed with status ${l.status}`))},l.onerror=()=>a(new Error("Upload failed")),l.send(e)}))}catch(i){return v(i,Gt)}}),[v]),w=(0,i.useCallback)((async function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);const{page:o=1,limit:l=ea.DEFAULT_LIMIT}=i,d=`${ea.CACHE_VERSION}:tweets:${t}:${JSON.stringify({...i,page:o,limit:l})}`,c=ta.get(d);if(c&&!n)return s(c.tweets||[]),p(c.pagination||{page:o,limit:l,total:0,hasMore:!0}),b(c.board||null),Promise.resolve(c);g(null);try{var u,m,y,w;null===(u=x.current)||void 0===u||u.abort(),x.current=new AbortController;const c=r||x.current.signal,g=await async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;Bt(It,e,"Invalid boardId"),Bt(Tt,a,"Invalid query options");try{return(await(0,Ot.Jt)(`${Ut}/${e}`,{headers:{Authorization:`Bearer ${t}`},params:a,signal:i instanceof AbortSignal?i:void 0})).data.content||{tweets:[]}}catch(h){throw(0,Ot.hS)(h)}}(t,e,{...i,page:o,limit:l},c);if(!g)throw new Error("No data received");const v=g.tweets.map((e=>{var t;return{...Wt(e,a),children:(null===(t=e.children)||void 0===t?void 0:t.map((e=>Wt(e,a))))||[]}}));s((e=>n?[...e,...v]:v)),p({page:(null===(m=g.pagination)||void 0===m?void 0:m.page)||o,limit:(null===(y=g.pagination)||void 0===y?void 0:y.limit)||l,total:(null===(w=g.pagination)||void 0===w?void 0:w.total)||0,hasMore:v.length===l}),b(g.board||null);const f={tweets:v,pagination:g.pagination,board:g.board};return ta.set(d,f),Promise.resolve(f)}catch(f){return"AbortError"===f.name?Promise.resolve(null):v(f,Jt)}}),[e,t,a,v]),f=(0,i.useMemo)((()=>re()(((e,t,a,i)=>{w(e,t,a).then((e=>i(null,e))).catch((e=>i(e,null)))}),ea.DEBOUNCE_MS)),[w]),_=(0,i.useCallback)((async function(i,r,n){var o,l,d,c,u,m,b,x,w;let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,_=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"approved",A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],S=arguments.length>9?arguments[9]:void 0;if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(isNaN(r)||isNaN(n))return v(new Error,Ht);if((null===i||void 0===i||null===(o=i.value)||void 0===o||!o.trim())&&!k.length)return v(new Error,Yt);g(null);const I={type:k.length?(null===(l=k[0].type)||void 0===l?void 0:l.split("/")[0])||"image":i.type||"text",value:i.value||"",metadata:{files:[],hashtags:(null===(d=i.metadata)||void 0===d?void 0:d.hashtags)||[],mentions:(null===(c=i.metadata)||void 0===c?void 0:c.mentions)||[],style:(null===(u=i.metadata)||void 0===u?void 0:u.style)||{},poll_options:(null===(m=i.metadata)||void 0===m?void 0:m.poll_options)||[],event_details:(null===(b=i.metadata)||void 0===b?void 0:b.event_details)||{},quote_ref:(null===(x=i.metadata)||void 0===x?void 0:x.quote_ref)||null,embed_data:(null===(w=i.metadata)||void 0===w?void 0:w.embed_data)||null}},T={tweet_id:`temp-${Date.now()}`,content:I,position:{x:r,y:n},parent_tweet_id:f,child_tweet_ids:[],is_anonymous:_,anonymous_id:a.anonymous_id,username:_?"Anonymous":a.username,created_at:(new Date).toISOString(),liked_by:[],stats:{like_count:0,view_count:0,comment_count:0,share_count:0},status:C,scheduled_at:A,reminder:null!==j&&void 0!==j&&j.schedule?j:null,is_pinned:!1,children:[]};s((e=>[...e,T]));try{const i=await Promise.all(k.map((t=>y(t,e,(e=>null===S||void 0===S?void 0:S(e/k.length)))))),o={...I,type:i.length?i[0].contentType.split("/")[0]:I.type,metadata:{...I.metadata,files:i}},l=await(async(e,t,a,i,r,n,o,l,s,d,c,u)=>{Bt(It,e,"Invalid boardId"),Bt(Mt,t,"Invalid content"),Bt(Et,{x:a,y:i},"Invalid position"),Bt(It,o,"Invalid anonymousId"),r&&Bt(It,r,"Invalid parentTweetId"),d&&Bt(Dt,d,"Invalid reminder"),null!==c&&void 0!==c&&c.length&&Bt(Ct().array().items(Ct().object({url:Ct().string().uri().optional(),fileKey:Ct().string().required(),contentType:Ct().string().required(),size:Ct().number().max(52428800).required()})).max(10),c,"Invalid files");try{var p,m;const b={content:{...t,metadata:{...t.metadata,files:c||[]}},position:{x:a,y:i},is_anonymous:n,anonymous_id:o,status:l,scheduled_at:s||null};r&&(b.parent_tweet_id=r),d&&(b.reminder=d);const h=null===(p=(await(0,Ot.bE)(`${Ut}/${e}`,b,{headers:{Authorization:`Bearer ${u}`}})).data.content)||void 0===p||null===(m=p.tweets)||void 0===m?void 0:m[0];if(!h||!h.tweet_id)throw new Error("Invalid tweet response from server");return h}catch(h){throw(0,Ot.hS)(h)}})(t,o,r,n,f,_,a.anonymous_id,C,A,null!==j&&void 0!==j&&j.schedule?j:null,i,e),d=Wt({...l,position:l.position||{x:r,y:n}},a);return s((e=>e.map((e=>e.tweet_id===T.tweet_id?d:e)))),p((e=>({...e,total:e.total+1}))),f&&s((e=>e.map((e=>e.tweet_id===f?{...e,child_tweet_ids:[...e.child_tweet_ids||[],d.tweet_id],children:[...e.children||[],d],stats:{...e.stats,comment_count:(e.stats.comment_count||0)+1}}:e)))),ta.clear(),Promise.resolve(d)}catch(M){return s((e=>e.filter((e=>e.tweet_id!==T.tweet_id)))),p((e=>({...e,total:e.total-1}))),v(M,Jt)}}),[e,t,a,v,y]),C=(0,i.useCallback)((async function(i,r){var n,o,d,c,u,p,m,b,x;let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],f=arguments.length>3?arguments[3]:void 0;if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(!r||!Object.keys(r).length)return v(new Error,"At least one update field is required");const _=l.find((e=>e.tweet_id===i));if(!_)return v(new Error,"Tweet not found");if(r.content&&(null===(n=r.content.value)||void 0===n||!n.trim())&&!w.length&&!_.content.metadata.files.length)return v(new Error,Yt);if(r.position&&(isNaN(r.position.x)||isNaN(r.position.y)))return v(new Error,Ht);g(null);const C=r.content?{type:w.length?(null===(o=w[0].type)||void 0===o?void 0:o.split("/")[0])||"image":r.content.type||_.content.type||"text",value:r.content.value||"",metadata:{files:_.content.metadata.files||[],hashtags:(null===(d=r.content.metadata)||void 0===d?void 0:d.hashtags)||_.content.metadata.hashtags||[],mentions:(null===(c=r.content.metadata)||void 0===c?void 0:c.mentions)||_.content.metadata.mentions||[],style:(null===(u=r.content.metadata)||void 0===u?void 0:u.style)||_.content.metadata.style||[],poll_options:(null===(p=r.content.metadata)||void 0===p?void 0:p.poll_options)||_.content.metadata.poll_options||[],event_details:(null===(m=r.content.metadata)||void 0===m?void 0:m.event_details)||_.content.metadata.event_details||{},quote_ref:(null===(b=r.content.metadata)||void 0===b?void 0:b.quote_ref)||_.content.metadata.quote_ref||null,embed_data:(null===(x=r.content.metadata)||void 0===x?void 0:x.embed_data)||_.content.metadata.embed_data||null}}:_.content,A={..._,...r,content:C,position:r.position||_.position,status:r.status||_.status,scheduled_at:void 0!==r.scheduled_at?r.scheduled_at:_.scheduled_at,reminder:r.reminder||_.reminder,updated_at:(new Date).toISOString()};s((e=>e.map((e=>e.tweet_id===i?A:e))));try{const n=await Promise.all(w.map((t=>y(t,e,(e=>null===f||void 0===f?void 0:f(e/w.length)))))),o={...r,content:r.content?{...C,type:n.length?n[0].contentType.split("/")[0]:C.type,metadata:{...C.metadata,files:[...C.metadata.files,...n]}}:void 0,position:r.position?{x:r.position.x,y:r.position.y}:void 0,status:r.status,scheduled_at:void 0!==r.scheduled_at?r.scheduled_at:void 0,reminder:r.reminder?{...r.reminder,enabled:!!r.reminder.schedule}:void 0};Object.keys(o).forEach((e=>void 0===o[e]&&delete o[e]));const l=await(async(e,t,a,i)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId"),Bt(Ct().object({content:Mt.optional(),position:Et.optional(),status:Ct().string().valid("pending","approved","rejected","announcement","reminder","pinned","archived").optional(),scheduled_at:Ct().date().iso().allow(null).optional(),reminder:Dt.optional()}).min(1),a,"Invalid updates");try{var r,n;return(null===(r=(await(0,Ot.yJ)(`${Ut}/${e}/${t}`,a,{headers:{Authorization:`Bearer ${i}`}})).data.content)||void 0===r||null===(n=r.tweets)||void 0===n?void 0:n[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,o,e),d=Wt({...l,position:l.position||_.position},a);return s((e=>e.map((e=>e.tweet_id===i?d:e)))),ta.clear(),Promise.resolve(d)}catch(j){return s((e=>e.map((e=>e.tweet_id===i?_:e)))),v(j,Jt)}}),[e,t,a,v,l,y]),A=(0,i.useCallback)((async(t,i)=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Vt);const r=l.find((e=>e.tweet_id===t));if(!r)return v(new Error,"Tweet not found");g(null);const n={...r,liked_by:i?r.liked_by.filter((e=>e.anonymous_id!==a.anonymous_id)):[...r.liked_by,{anonymous_id:a.anonymous_id,username:a.username}],stats:{...r.stats,like_count:i?r.stats.like_count-1:r.stats.like_count+1},is_liked:!i};s((e=>e.map((e=>e.tweet_id===t?n:e))));try{const r=await(async(e,t,a)=>{Bt(It,e,"Invalid tweetId");try{var i,r;const n=t?"dislike":"like";return(null===(i=(await(0,Ot.bE)(`${Ut}/${e}/${n}`,{},{headers:{Authorization:`Bearer ${a}`}})).data.content)||void 0===i||null===(r=i.tweets)||void 0===r?void 0:r[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,e),n=Wt(r,a);return s((e=>e.map((e=>e.tweet_id===t?n:e)))),ta.clear(),Promise.resolve(n)}catch(o){return s((e=>e.map((e=>e.tweet_id===t?r:e)))),v(o,Jt)}}),[e,a,v,l]),j=(0,i.useCallback)((async a=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===a||void 0===a||!a.trim())return v(new Error,Vt);const i=l.find((e=>e.tweet_id===a));if(!i)return v(new Error,"Tweet not found");g(null);const r=i.child_tweet_ids||[],n=i.parent_tweet_id;s((e=>e.filter((e=>e.tweet_id!==a&&!r.includes(e.tweet_id))).map((e=>e.tweet_id===n?{...e,child_tweet_ids:e.child_tweet_ids.filter((e=>e!==a)),children:e.children.filter((e=>e.tweet_id!==a)),stats:{...e.stats,comment_count:(e.stats.comment_count||0)-1}}:e)))),p((e=>({...e,total:e.total-(1+r.length)}))),c((e=>(null===e||void 0===e?void 0:e.tweet_id)===a?null:e));try{return await(async(e,t,a)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId");try{var i,r;return(null===(i=(await(0,Ot.yH)(`${Ut}/${e}/${t}`,{headers:{Authorization:`Bearer ${a}`}})).data.content)||void 0===i||null===(r=i.tweets)||void 0===r?void 0:r[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,a,e),ta.clear(),Promise.resolve(!0)}catch(o){return s((e=>[...e,i,...r.map((e=>l.find((t=>t.tweet_id===e)))).filter(Boolean)].map((e=>e.tweet_id===n?{...e,child_tweet_ids:[...e.child_tweet_ids,a],children:[...e.children,i],stats:{...e.stats,comment_count:(e.stats.comment_count||0)+1}}:e)))),p((e=>({...e,total:e.total+(1+r.length)}))),v(o,Jt)}}),[e,t,v,l]),k=(0,i.useCallback)((async(i,r)=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(null===r||void 0===r||!r.trim())return v(new Error,Zt);const n=l.find((e=>e.tweet_id===i));if(!n)return v(new Error,"Tweet not found");g(null);const o=n.parent_tweet_id;s((e=>e.filter((e=>e.tweet_id!==i)).map((e=>e.tweet_id===o?{...e,child_tweet_ids:e.child_tweet_ids.filter((e=>e!==i)),children:e.children.filter((e=>e.tweet_id!==i)),stats:{...e.stats,comment_count:(e.stats.comment_count||0)-1}}:e)))),p((e=>({...e,total:e.total-1})));try{const t=await(async(e,t,a)=>{Bt(It,e,"Invalid tweetId"),Bt(It,t,"Invalid targetBoardId");try{var i,r;return(null===(i=(await(0,Ot.bE)(`${Ut}/${e}/move`,{targetBoardId:t},{headers:{Authorization:`Bearer ${a}`}})).data.content)||void 0===i||null===(r=i.tweets)||void 0===r?void 0:r[0])||null}catch(h){throw(0,Ot.hS)(h)}})(i,r,e),n=Wt(t,a);return c(n),ta.clear(),Promise.resolve(n)}catch(d){return s((e=>[...e,n].map((e=>e.tweet_id===o?{...e,child_tweet_ids:[...e.child_tweet_ids,i],children:[...e.children,n],stats:{...e.stats,comment_count:(e.stats.comment_count||0)+1}}:e)))),p((e=>({...e,total:e.total+1}))),v(d,Jt)}}),[e,t,a,v,l]),S=(0,i.useCallback)((async i=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(!l.find((e=>e.tweet_id===i)))return v(new Error,"Tweet not found");g(null),s((e=>e.map((e=>e.tweet_id===i?{...e,is_pinned:!0}:e))));try{const r=await(async(e,t,a)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId");try{var i,r;return(null===(i=(await(0,Ot.bE)(`${Ut}/${e}/${t}/pin`,{},{headers:{Authorization:`Bearer ${a}`}})).data.content)||void 0===i||null===(r=i.tweets)||void 0===r?void 0:r[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,e),n=Wt(r,a);return s((e=>e.map((e=>e.tweet_id===i?n:e)))),ta.clear(),Promise.resolve(n)}catch(r){return s((e=>e.map((e=>e.tweet_id===i?{...e,is_pinned:!1}:e)))),v(r,Jt)}}),[e,t,a,v,l]),I=(0,i.useCallback)((async i=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(!l.find((e=>e.tweet_id===i)))return v(new Error,"Tweet not found");g(null),s((e=>e.map((e=>e.tweet_id===i?{...e,is_pinned:!1}:e))));try{const r=await(async(e,t,a)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId");try{var i,r;return(null===(i=(await(0,Ot.bE)(`${Ut}/${e}/${t}/unpin`,{},{headers:{Authorization:`Bearer ${a}`}})).data.content)||void 0===i||null===(r=i.tweets)||void 0===r?void 0:r[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,e),n=Wt(r,a);return s((e=>e.map((e=>e.tweet_id===i?n:e)))),ta.clear(),Promise.resolve(n)}catch(r){return s((e=>e.map((e=>e.tweet_id===i?{...e,is_pinned:!0}:e)))),v(r,Jt)}}),[e,t,a,v,l]),T=(0,i.useCallback)((async(i,r)=>{if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(null===r||void 0===r||!r.schedule)return v(new Error,Kt);const n=l.find((e=>e.tweet_id===i));if(!n)return v(new Error,"Tweet not found");g(null),s((e=>e.map((e=>e.tweet_id===i?{...e,reminder:{...r,enabled:!0}}:e))));try{const n=await(async(e,t,a,i)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId"),Bt(Dt,a,"Invalid reminder");try{var r,n;return(null===(r=(await(0,Ot.yJ)(`${Ut}/${e}/${t}/reminder`,a,{headers:{Authorization:`Bearer ${i}`}})).data.content)||void 0===r||null===(n=r.tweets)||void 0===n?void 0:n[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,r,e),o=Wt(n,a);return s((e=>e.map((e=>e.tweet_id===i?o:e)))),ta.clear(),Promise.resolve(o)}catch(o){return s((e=>e.map((e=>e.tweet_id===i?{...e,reminder:n.reminder}:e)))),v(o,Jt)}}),[e,t,a,v,l]),M=(0,i.useCallback)((async(i,r)=>{var n;if(!e)return v(new Error,Xt);if(null===t||void 0===t||!t.trim())return v(new Error,Nt);if(null===i||void 0===i||!i.trim())return v(new Error,Vt);if(null===r||void 0===r||!r.trim())return v(new Error,Qt);const o=l.find((e=>e.tweet_id===i));if(!o)return v(new Error,"Tweet not found");g(null);const d={...o,analytics:{...o.analytics,shares:[...(null===(n=o.analytics)||void 0===n?void 0:n.shares)||[],{platform:r,timestamp:(new Date).toISOString(),user_id:a.anonymous_id}]},stats:{...o.stats,share_count:(o.stats.share_count||0)+1}};s((e=>e.map((e=>e.tweet_id===i?d:e))));try{const n=await(async(e,t,a,i)=>{Bt(It,e,"Invalid boardId"),Bt(It,t,"Invalid tweetId"),Bt(Ct().string().required(),a,"Invalid sharedTo");try{var r,n;return(null===(r=(await(0,Ot.bE)(`${Ut}/${e}/${t}/share`,{shared_to:a},{headers:{Authorization:`Bearer ${i}`}})).data.content)||void 0===r||null===(n=r.tweets)||void 0===n?void 0:n[0])||null}catch(h){throw(0,Ot.hS)(h)}})(t,i,r,e),o=Wt(n,a);return s((e=>e.map((e=>e.tweet_id===i?o:e)))),ta.clear(),Promise.resolve(o)}catch(c){return s((e=>e.map((e=>e.tweet_id===i?o:e)))),v(c,Jt)}}),[e,t,a,v,l]),E=(0,i.useCallback)((()=>{s([]),c(null),p({page:1,limit:ea.DEFAULT_LIMIT,total:0,hasMore:!0}),b(null),g(null),ta.clear()}),[]);return(0,i.useEffect)((()=>{if(!e||!t||o)return void E();const a=new AbortController;return f({},a.signal,!1,((e,t)=>{e&&"AbortError"!==e.name&&g(e.message||Jt)})),()=>{a.abort(),f.cancel()}}),[e,t,o,E,f]),(0,i.useMemo)((()=>({tweets:l,tweet:d,setTweet:c,setTweets:s,pagination:u,boardInfo:m,error:h,fetchTweetsList:f,createNewTweet:_,updateExistingTweet:C,toggleLikeTweet:A,deleteExistingTweet:j,moveTweet:k,pinTweet:S,unpinTweet:I,setReminder:T,shareTweet:M,resetState:E})),[l,d,u,m,h,f,_,C,A,j,k,S,I,T,M,E])};var ia=a(3801),ra=a(1654),na=a(9889),oa=a.n(na);const la=1e3,sa=10,da=100,ca=110,ua=109,pa=(e,t)=>{switch(t.type){case"OPEN_POPUP":return{visible:!0,x:t.x,y:t.y,clientX:t.clientX,clientY:t.clientY,replyTweet:t.replyTweet||null};case"CLOSE_POPUP":return{visible:!1,x:0,y:0,clientX:0,clientY:0,replyTweet:null};default:return e}},ma=(e,t)=>{var a,i;switch(t.type){case"SET_EDIT_MODAL":return{tweet:t.payload,newStatus:(null===(a=t.payload)||void 0===a?void 0:a.status)||"approved",selectedBoardId:(null===(i=t.payload)||void 0===i?void 0:i.board_id)||""};case"CLEAR_EDIT_MODAL":return{tweet:null,newStatus:"",selectedBoardId:""};case"UPDATE_EDIT_CONTENT":return{...e,tweet:{...e.tweet,content:{...e.tweet.content,value:t.value}}};case"SET_NEW_STATUS":return{...e,newStatus:t.status};case"SET_SELECTED_BOARD":return{...e,selectedBoardId:t.boardId};default:return e}},ba=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,i.useMemo)((()=>{const i=["owner","admin"].includes(e),o="moderator"===e,l="viewer"===e,s=e=>{const a=e&&(e.anonymous_id===(null===t||void 0===t?void 0:t.anonymous_id)||e.user_id===(null===t||void 0===t?void 0:t.anonymous_id)||e.username&&(null===t||void 0===t?void 0:t.username)&&e.username.toLowerCase()===t.username.toLowerCase());return{canEdit:n||i||o||l&&a,canPin:i,canChangeStatus:i,canMoveBoard:i,canCreate:i||o||l,canLike:i||o||l,canReply:i||o||l,canDrag:e&&!e.is_pinned&&(n||i||o||a)}};if(r&&Array.isArray(r)){const e=new Map;return r.forEach((t=>{t.tweet_id&&e.set(t.tweet_id,s(t))})),e}return s(a)}),[e,null===t||void 0===t?void 0:t.anonymous_id,null===t||void 0===t?void 0:t.username,null===a||void 0===a?void 0:a.tweet_id,null===r||void 0===r?void 0:r.length,n])},ha=e=>{var t,a,n,s,u,p,_,C,A,j,k;let{boardId:S,boardTitle:I,token:T,currentUser:M,userRole:E,onLogout:D,availableBoards:N=[]}=e;const V=(0,r.Zp)(),{showNotification:Y}=(0,ra.h)(),te=(0,i.useRef)(null),ae=(0,i.useRef)(!1),[ie,ne]=(0,i.useState)(!1),[oe,le]=(0,i.useState)(1),[se,de]=(0,i.useState)(N),[ce,pe]=(0,i.useState)(!1),[be,he]=(0,i.useState)(null),[ge,xe]=(0,i.useState)(0),ve=(0,i.useRef)(new Set),[ye,we]=(0,i.useReducer)(pa,{visible:!1,x:0,y:0,clientX:0,clientY:0,replyTweet:null}),[fe,_e]=(0,i.useReducer)(ma,{tweet:null,newStatus:"",selectedBoardId:""}),Ce=(0,i.useMemo)((()=>ye.visible||!!fe.tweet||ve.current.size>0),[ye.visible,fe.tweet]),Ae=(0,i.useCallback)(((e,t)=>{t?ve.current.add(e):ve.current.delete(e)}),[]),{tweets:je,tweet:ke,setTweet:Se,setTweets:Ie,pagination:Te,boardInfo:Me,loading:Ee,error:De,fetchTweetsList:Re,createNewTweet:Pe,updateExistingTweet:Be,toggleLikeTweet:qe,deleteExistingTweet:ze,moveTweet:$e,pinTweet:Le,unpinTweet:Fe,setReminder:Oe,shareTweet:Ue,resetState:We}=aa(T,S,M,D,V),{fetchBoardsList:Xe}=(0,ia.b)(T,D,V),{scale:Ne,offset:Ve,dragging:Ye,centerBoard:He,handleZoomButton:Ze,handleMouseDown:Ke,handleMouseMove:Qe,handleMouseUp:Ge,handleTouchStart:Je,handleTouchMove:et,handleTouchEnd:tt}=(e=>{const[t,a]=(0,i.useState)(1),[r,n]=(0,i.useState)({x:0,y:0}),o=(0,i.useRef)(!1),l=(0,i.useRef)(null),s=(0,i.useRef)(null),d=(0,i.useRef)(null),c=(0,i.useRef)(t),u=(0,i.useRef)(r),p=(0,i.useRef)({width:window.innerWidth,height:window.innerHeight}),m=(0,i.useRef)([]),b=(0,i.useRef)(-1);(0,i.useEffect)((()=>{c.current=t,u.current=r}),[t,r]),(0,i.useEffect)((()=>{const e=()=>{p.current={width:window.innerWidth,height:window.innerHeight}};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]);const h=(0,i.useCallback)((e=>{const t=Q*c.current,{width:a,height:i}=p.current,r=a-t,n=i-t;return{x:Math.max(r,Math.min(0,e.x)),y:Math.max(n,Math.min(0,e.y))}}),[]),g=(0,i.useCallback)((()=>{const{width:e,height:t}=p.current,a={x:e/2-Q*c.current/2,y:t/2-Q*c.current/2};n(h(a))}),[h]),x=(0,i.useCallback)((e=>{e&&(a(Math.min(2,Math.max(.3,e.scale||1))),n(h(e.offset||{x:0,y:0})))}),[h]),v=(0,i.useCallback)((()=>({scale:t,offset:r,timestamp:(new Date).toISOString()})),[t,r]),y=(0,i.useCallback)((()=>{const e=c.current,t=u.current,{width:i,height:r}=p.current,o=i/2-5e3,l=r/2-5e3;(0,K.i)(0,1,{duration:.4,ease:"easeInOut",onUpdate:i=>{const r=1-Math.pow(1-i,3);a(e+(1-e)*r),n(h({x:t.x+(o-t.x)*r,y:t.y+(l-t.y)*r}))}})}),[h]),w=(0,i.useCallback)(((e,t,i)=>{a((a=>{const r=Math.min(2,Math.max(.3,a+e)),o=u.current;let l;if(void 0!==t&&void 0!==i){const e=(t-o.x)/a,n=(i-o.y)/a;l=h({x:t-e*r,y:i-n*r})}else l=h({x:window.innerWidth/2-Q*r/2,y:window.innerHeight/2-Q*r/2});return n(l),r}))}),[h]),f=(0,i.useCallback)((e=>{"reset"===e?y():w("in"===e?G:-.1,p.current.width/2,p.current.height/2)}),[w,y]),_=(0,i.useCallback)((0,Z.throttle)((e=>{e.preventDefault();const t=5e-4*-e.deltaY;w(t,e.clientX,e.clientY)}),16),[w]),C=(0,i.useCallback)((e=>{e.target.closest(".tweet-card, .tweet-popup, .return-button, .user_points, .zoom-controls, .board-top-controls, .MuiIconButton-root, .MuiButton-root")||(l.current={x:e.clientX,y:e.clientY,offsetX:r.x,offsetY:r.y},o.current=!1)}),[r]),A=(0,i.useCallback)((0,Z.throttle)((e=>{if(!l.current)return;const t=e.clientX-l.current.x,a=e.clientY-l.current.y;!o.current&&(Math.abs(t)>5||Math.abs(a)>5)&&(o.current=!0),o.current&&n(h({x:l.current.offsetX+t,y:l.current.offsetY+a}))}),16),[h]),j=(0,i.useCallback)(((a,i)=>{if(!o.current&&l.current&&i&&e.current){const n=e.current.getBoundingClientRect(),o=a.clientX-n.left,l=a.clientY-n.top,s=(o-r.x)/t,d=(l-r.y)/t;s>=0&&s<=Q&&d>=0&&d<=Q&&i(s,d,a.clientX,a.clientY)}l.current=null,o.current=!1}),[e,r,t]),k=(0,i.useCallback)((e=>{if(!e.target.closest(".tweet-card, .tweet-popup, .MuiIconButton-root, .MuiButton-root"))if(1===e.touches.length)s.current={x:e.touches[0].clientX,y:e.touches[0].clientY,offsetX:r.x,offsetY:r.y},o.current=!1;else if(2===e.touches.length){const t=e.touches[0],a=e.touches[1],i=t.clientX-a.clientX,r=t.clientY-a.clientY;d.current={distance:Math.sqrt(i*i+r*r),centerX:(t.clientX+a.clientX)/2,centerY:(t.clientY+a.clientY)/2,scale:c.current}}}),[r]),S=(0,i.useCallback)((0,Z.throttle)((e=>{if(s.current||d.current)if(1===e.touches.length&&s.current){const t=e.touches[0],a=t.clientX-s.current.x,i=t.clientY-s.current.y;!o.current&&(Math.abs(a)>5||Math.abs(i)>5)&&(o.current=!0),o.current&&n(h({x:s.current.offsetX+a,y:s.current.offsetY+i}))}else if(2===e.touches.length&&d.current){const t=e.touches[0],i=e.touches[1],r=t.clientX-i.clientX,o=t.clientY-i.clientY,l=Math.sqrt(r*r+o*o)/d.current.distance*d.current.scale,s=Math.min(2,Math.max(.3,l)),p=(t.clientX+i.clientX)/2,m=(t.clientY+i.clientY)/2;a(s),n(h({x:p-(p-u.current.x)/c.current*s,y:m-(m-u.current.y)/c.current*s}))}}),16),[h]),I=(0,i.useCallback)(((a,i)=>{if(!o.current&&s.current&&i&&e.current&&1===a.changedTouches.length){const n=e.current.getBoundingClientRect(),o=a.changedTouches[0],l=o.clientX-n.left,s=o.clientY-n.top,d=(l-r.x)/t,c=(s-r.y)/t;d>=0&&d<=Q&&c>=0&&c<=Q&&i(d,c,o.clientX,o.clientY)}s.current=null,d.current=null,o.current=!1}),[e,r,t]),T=(0,i.useCallback)((e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case"+":case"=":e.preventDefault(),w(G,p.current.width/2,p.current.height/2);break;case"-":e.preventDefault(),w(-.1,p.current.width/2,p.current.height/2);break;case"ArrowUp":e.preventDefault(),n((e=>h({...e,y:e.y+50})));break;case"ArrowDown":e.preventDefault(),n((e=>h({...e,y:e.y-50})));break;case"ArrowLeft":e.preventDefault(),n((e=>h({...e,x:e.x+50})));break;case"ArrowRight":e.preventDefault(),n((e=>h({...e,x:e.x-50})));break;case"z":if(e.ctrlKey&&b.current>0){e.preventDefault(),b.current-=1;const t=m.current[b.current];a(t.scale),n(t.offset)}break;case"y":if(e.ctrlKey&&b.current<m.current.length-1){e.preventDefault(),b.current+=1;const t=m.current[b.current];a(t.scale),n(t.offset)}}}),[w,h]),M=(0,i.useCallback)(((a,i)=>{if(a.target.closest(".tweet-card, .tweet-popup, .MuiIconButton-root, .MuiButton-root"))return;a.preventDefault();const n=e.current.getBoundingClientRect(),o=a.clientX-n.left,l=a.clientY-n.top,s=(o-r.x)/t,d=(l-r.y)/t;s>=0&&s<=Q&&d>=0&&d<=Q&&i(s,d,a.clientX,a.clientY)}),[e,r,t]);return(0,i.useEffect)((()=>{const t=e.current;return t&&(t.addEventListener("wheel",_,{passive:!1}),t.addEventListener("mousedown",C),t.addEventListener("touchstart",k,{passive:!1})),window.addEventListener("mousemove",A),window.addEventListener("mouseup",j),window.addEventListener("touchmove",S,{passive:!1}),window.addEventListener("touchend",I),window.addEventListener("keydown",T),()=>{t&&(t.removeEventListener("wheel",_),t.removeEventListener("mousedown",C),t.removeEventListener("touchstart",k)),window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",j),window.removeEventListener("touchmove",S),window.removeEventListener("touchend",I),window.removeEventListener("keydown",T)}}),[_,C,A,j,k,S,I,T,e]),{scale:t,offset:r,setOffset:n,dragging:o.current,centerBoard:g,handleZoomButton:f,handleWheel:_,handleMouseDown:C,handleMouseMove:A,handleMouseUp:j,handleTouchStart:k,handleTouchMove:S,handleTouchEnd:I,handleContextMenu:M,restoreBoardState:x,exportBoardState:v}})(te),at=ba(E,M),it=ba(E,M,null,je),rt=((e,t,a,r,n,o,l,s)=>{const d=(0,i.useRef)(null);return(0,i.useEffect)((()=>{if(!e||!t||null===a||void 0===a||!a.anonymous_id)return;const i=(0,J.Ay)(`${ee.A.REACT_APP_WS_URL}/tweets`,{query:{token:e,boardId:t},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return d.current=i,i.on("connect_error",(e=>{e.message.includes("Authentication")?(s("Session expired. Please log in again.","error"),o(),l("/login")):s("Failed to connect to real-time updates.","error")})),()=>{i.disconnect()}}),[e,t,null===a||void 0===a?void 0:a.anonymous_id,o,l,s]),d})(T,S,M,0,0,D,V,Y);(0,i.useEffect)((()=>{if(!rt.current||!S||null===M||void 0===M||!M.anonymous_id)return;const e=rt.current;return e.on("connect",(()=>{e.emit("joinBoard",{board_id:S,user_id:M.anonymous_id})})),e.on("onlineUsersUpdate",(e=>{xe(e)})),e.on("newTweet",(e=>{e.timestamp=e.timestamp||(new Date).toISOString(),Ie((t=>t.some((t=>t.tweet_id===e.tweet_id))?t:[...t,e]))})),e.on("tweetUpdated",(e=>{e.timestamp=e.timestamp||(new Date).toISOString(),Ie((t=>t.map((t=>t.tweet_id===e.tweet_id?{...t,...e}:t))))})),e.on("tweetDeleted",(e=>{let{tweet_id:t}=e;Ie((e=>e.filter((e=>e.tweet_id!==t))))})),e.on("likeTweet",(e=>{let{tweet_id:t,like_data:a}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,stats:{...e.stats,like_count:(e.stats.like_count||0)+1},liked_by:[...e.liked_by||[],a],timestamp:(new Date).toISOString()}:e))))})),e.on("dislikeTweet",(e=>{let{tweet_id:t,user_id:a}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,stats:{...e.stats,like_count:Math.max(0,(e.stats.like_count||0)-1)},liked_by:(e.liked_by||[]).filter((e=>e.anonymous_id!==a)),timestamp:(new Date).toISOString()}:e))))})),e.on("tweetStatusUpdated",(e=>{let{tweet_id:t,status:a}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,status:a,timestamp:(new Date).toISOString()}:e))))})),e.on("moveTweet",(e=>{let{tweet_id:t,new_board_id:a}=e;Ie(a!==S?e=>e.filter((e=>e.tweet_id!==t)):e=>(e.find((e=>e.tweet_id===t))||Re({page:1,limit:20}),e))})),e.on("pinTweet",(e=>{let{tweet_id:t}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,is_pinned:!0,timestamp:(new Date).toISOString()}:e))))})),e.on("unpinTweet",(e=>{let{tweet_id:t}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,is_pinned:!1,timestamp:(new Date).toISOString()}:e))))})),e.on("setReminder",(e=>{let{tweet_id:t,reminder:a}=e;Ie((e=>e.map((e=>e.tweet_id===t?{...e,reminder:a,timestamp:(new Date).toISOString()}:e))))})),e.on("tweetShared",(e=>{let{tweet_id:t,share_data:a}=e;Ie((e=>e.map((e=>{var i;return e.tweet_id===t?{...e,stats:{...e.stats,share_count:(e.stats.share_count||0)+1},analytics:{...e.analytics,shares:[...(null===(i=e.analytics)||void 0===i?void 0:i.shares)||[],a]},timestamp:(new Date).toISOString()}:e}))))})),e.on("shareTweet",(e=>{e.board_id===S&&Y("Board updated","success")})),e.on("boardDeleted",(e=>{let{board_id:t}=e;t===S&&(Y("This board has been deleted","error"),V("/boards"))})),()=>{}}),[rt,S,null===M||void 0===M?void 0:M.anonymous_id,Ie,Y,V,Re]);const nt=(0,i.useMemo)((()=>re()((async()=>{if(!ae.current){ae.current=!0;try{Ie([]),await new Promise(((e,t)=>{Re({page:1,limit:20},null,!1,((a,i)=>{a?t(a):e(i)}))})),le(1),He(),Y("Board refreshed successfully!","success")}catch(e){"AbortError"!==e.name&&Y(e.message||"Failed to refresh board","error")}finally{ae.current=!1}}}),1e3)),[Re,Y,He,Ie]);(0,i.useEffect)((()=>{if(!T||!S)return;const e=new AbortController;return(async()=>{if(!ae.current){ae.current=!0;try{await new Promise(((t,a)=>{Re({page:1,limit:20},e.signal,!1,((e,i)=>{e?a(e):t(i)}))})),le(1),He()}catch(t){"AbortError"!==t.name&&Y(t.message||"Failed to load tweets","error")}finally{ae.current=!1}}})(),()=>{e.abort(),nt.cancel()}}),[T,S,Re,Y,He,nt]),(0,i.useEffect)((()=>{if(!fe.tweet||se.length>0||!at.canMoveBoard)return;const e=new AbortController;return(async()=>{try{const t=await Xe({},e.signal),a=(null===t||void 0===t?void 0:t.boards.filter((e=>e.board_id)))||[];de(a)}catch(t){"AbortError"!==t.name&&Y("Failed to load boards","error")}})(),()=>e.abort()}),[fe.tweet,se,Xe,Y,at.canMoveBoard]),(0,i.useEffect)((()=>{const e=e=>{Ce&&e.preventDefault()};return window.addEventListener("wheel",e,{passive:!1}),()=>window.removeEventListener("wheel",e)}),[Ce]);const ot=(0,i.useCallback)((async function(e,t,a,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=e.tweet_id;try{Ie((e=>t(n,e))),await a()}catch(o){Ie((e=>i(n,e))),Y(o.message||(r?"Failed to create tweet":"Failed to update tweet"),"error")}}),[Y,Ie]),lt=(0,i.useCallback)((async(e,t,a,i,r,n)=>{var o,l,s;if(!at.canCreate)return void Y("You do not have permission to create tweets","error");if((null===e||void 0===e||null===(o=e.value)||void 0===o||!o.trim())&&(!r||0===r.length))return void Y("Tweet must have either content or files","error");if((null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.length)>la)return void Y("Tweet exceeds 1000 character limit","error");const d=`temp-${Date.now()}`,c={tweet_id:d,content:{type:"text",value:(null===e||void 0===e?void 0:e.value)||"",metadata:{files:r?r.map((e=>({fileKey:e.name,url:URL.createObjectURL(e),contentType:e.type}))):[]}},position:{x:t,y:a},parent_tweet_id:(null===(s=ye.replyTweet)||void 0===s?void 0:s.tweet_id)||null,status:"approved",created_at:(new Date).toISOString(),anonymous_id:M.anonymous_id,username:M.username,stats:{like_count:0,view_count:0,comment_count:0,share_count:0},is_pinned:!1,board_id:S,children:[]};await ot(c,((e,t)=>[...t,c]),(async()=>{var o,l;const s=await Pe(e,t,a,(null===(o=ye.replyTweet)||void 0===o?void 0:o.tweet_id)||null,!1,"approved",i||null,null,r||[],n);Ie((e=>e.map((e=>e.tweet_id===d?s:e)))),null===(l=rt.current)||void 0===l||l.emit("newTweet",s)}),((e,t)=>t.filter((t=>t.tweet_id!==e))),!0),we({type:"CLOSE_POPUP"})}),[at.canCreate,Pe,ye.replyTweet,Y,M,S,ot,Ie,rt]),dt=(0,i.useCallback)((e=>{if(!at.canReply)return void Y("You do not have permission to reply to tweets","error");const t=e.position.x*Ne+Ve.x,a=e.position.y*Ne+Ve.y;we({type:"OPEN_POPUP",x:e.position.x,y:e.position.y,clientX:t,clientY:a,replyTweet:e})}),[at.canReply,Ne,Ve,Y]),ct=(0,i.useMemo)((()=>oa()(((e,t,a,i)=>{at.canCreate?we({type:"OPEN_POPUP",x:e,y:t,clientX:a,clientY:i}):Y("You do not have permission to create tweets","error")}),300)),[at.canCreate,Y]),ut=(0,i.useCallback)((e=>{Ce?e.preventDefault():Ke(e)}),[Ce,Ke]),pt=(0,i.useCallback)((e=>{Ce||Qe(e)}),[Ce,Qe]),mt=(0,i.useCallback)((e=>{Ce||(e.target.closest(".tweet-card, .tweet-popup, .MuiIconButton-root, .MuiButton-root")?Ge(e):Ge(e,ct))}),[Ce,Ge,ct]),bt=(0,i.useCallback)((e=>{Ce||Je(e)}),[Ce,Je]),ht=(0,i.useCallback)((e=>{Ce?e.preventDefault():et(e)}),[Ce,et]),gt=(0,i.useCallback)((e=>{Ce||(e.target.closest(".tweet-card, .tweet-popup, .MuiIconButton-root, .MuiButton-root")?tt(e):tt(e,ct))}),[Ce,tt,ct]),xt=(0,i.useCallback)((e=>{const t=it.get(e.tweet_id);null!==t&&void 0!==t&&t.canEdit?_e({type:"SET_EDIT_MODAL",payload:{...e,availableBoards:se}}):Y("You do not have permission to edit this tweet","error")}),[it,se,Y]),vt=(0,i.useCallback)((async e=>{if(!at.canPin)return void Y("You do not have permission to pin tweets","error");const t=!e.is_pinned;await ot(e,((e,a)=>a.map((a=>a.tweet_id===e?{...a,is_pinned:t}:a))),(async()=>{var a;const i=t?Le:Fe;await i(e.tweet_id),null===(a=rt.current)||void 0===a||a.emit(t?"pinTweet":"unpinTweet",{tweet_id:e.tweet_id})}),((t,a)=>a.map((a=>a.tweet_id===t?{...a,is_pinned:e.is_pinned}:a))),!1),Y(`Tweet ${t?"pinned":"unpinned"} successfully!`,"success")}),[at.canPin,Le,Fe,Y,ot,rt]),yt=(0,i.useCallback)((async()=>{var e,t,a,i,r,n,o;if(!fe.tweet)return;const l=it.get(fe.tweet.tweet_id);if(null===l||void 0===l||!l.canEdit)return void Y("You do not have permission to edit this tweet","error");if(null===(e=fe.tweet.content)||void 0===e||null===(t=e.value)||void 0===t||!t.trim())return void Y("Tweet content cannot be empty","error");if((null===(a=fe.tweet.content)||void 0===a||null===(i=a.value)||void 0===i?void 0:i.length)>la)return void Y("Tweet exceeds 1000 character limit","error");pe(!0);const s={...fe.tweet,content:{type:(null===(r=fe.tweet.content)||void 0===r?void 0:r.type)||"text",value:(null===(n=fe.tweet.content)||void 0===n?void 0:n.value)||"",metadata:(null===(o=fe.tweet.content)||void 0===o?void 0:o.metadata)||{}},status:l.canChangeStatus?fe.newStatus:fe.tweet.status,board_id:l.canMoveBoard?fe.selectedBoardId:fe.tweet.board_id};await ot(s,((e,t)=>t.map((t=>t.tweet_id===e?s:t))),(async()=>{var e,t,a;(await Be(fe.tweet.tweet_id,{content:s.content,status:l.canChangeStatus?fe.newStatus:fe.tweet.status,position:fe.tweet.position}),l.canMoveBoard&&fe.tweet.board_id!==fe.selectedBoardId)&&(await $e(fe.tweet.tweet_id,fe.selectedBoardId),null===(t=rt.current)||void 0===t||t.emit("moveTweet",{tweet_id:fe.tweet.tweet_id,new_board_id:fe.selectedBoardId}));(null===(e=rt.current)||void 0===e||e.emit("tweetUpdated",s),l.canChangeStatus&&fe.newStatus!==fe.tweet.status)&&(null===(a=rt.current)||void 0===a||a.emit("tweetStatusUpdated",{tweet_id:fe.tweet.tweet_id,status:fe.newStatus}))}),((e,t)=>t),!1),pe(!1),_e({type:"CLEAR_EDIT_MODAL"})}),[fe,Be,$e,Y,it,ot,rt]),wt=(0,i.useCallback)((async(e,t)=>{if(!at.canLike)return void Y("You do not have permission to like tweets","error");const a={anonymous_id:M.anonymous_id,username:M.username,liked_at:new Date};await ot({tweet_id:e},((e,i)=>i.map((i=>i.tweet_id===e?{...i,stats:{...i.stats,like_count:t?Math.max(0,(i.stats.like_count||0)-1):(i.stats.like_count||0)+1},liked_by:t?(i.liked_by||[]).filter((e=>e.anonymous_id!==M.anonymous_id)):[...i.liked_by||[],a]}:i))),(async()=>{var i;await qe(e,t);null===(i=rt.current)||void 0===i||i.emit(t?"dislikeTweet":"likeTweet",{tweet_id:e,like_data:t?null:a,user_id:t?M.anonymous_id:null})}),((e,t)=>t),!1)}),[at.canLike,qe,Y,M,ot,rt]),ft=(0,i.useCallback)((async e=>{const t=it.get(e);null!==t&&void 0!==t&&t.canEdit?await ot({tweet_id:e},((e,t)=>t.filter((t=>t.tweet_id!==e))),(async()=>{var t;await ze(e),null===(t=rt.current)||void 0===t||t.emit("tweetDeleted",{tweet_id:e})}),((e,t)=>t),!1):Y("You do not have permission to delete this tweet","error")}),[ze,Y,it,ot,rt]),_t=(0,i.useCallback)((async(e,t)=>{const a=it.get(e);null!==a&&void 0!==a&&a.canEdit?await ot({tweet_id:e},((e,a)=>a.map((a=>a.tweet_id===e?{...a,reminder:t}:a))),(async()=>{var a;await Oe(e,t),null===(a=rt.current)||void 0===a||a.emit("setReminder",{tweet_id:e,reminder:t})}),((e,t)=>t),!1):Y("You do not have permission to set reminders","error")}),[Oe,Y,it,ot,rt]),Ct=(0,i.useCallback)((async(e,t)=>{if(!at.canReply)return void Y("You do not have permission to share tweets","error");const a={user_id:M.anonymous_id,shared_to:t,shared_at:new Date};await ot({tweet_id:e},((e,t)=>t.map((t=>{var i;return t.tweet_id===e?{...t,stats:{...t.stats,share_count:(t.stats.share_count||0)+1},analytics:{...t.analytics,shares:[...(null===(i=t.analytics)||void 0===i?void 0:i.shares)||[],a]}}:t}))),(async()=>{var i;await Ue(e,t),null===(i=rt.current)||void 0===i||i.emit("shareTweet",{tweet_id:e,share_data:a})}),((e,t)=>t),!1)}),[at.canReply,Ue,Y,M,ot,rt]),At=(0,i.useCallback)((async()=>{if(!ae.current&&Te.hasMore){ae.current=!0;try{await new Promise(((e,t)=>{Re({page:oe+1,limit:20},null,!0,((a,i)=>{a?t(a):e(i)}))})),le((e=>e+1))}catch(e){"AbortError"!==e.name&&Y(e.message||"Failed to load more tweets","error")}finally{ae.current=!1}}}),[Re,oe,Te.hasMore,Y]),jt=(0,i.useCallback)((async()=>{if(!(ae.current||oe<=1)){ae.current=!0;try{Ie([]),await new Promise(((e,t)=>{Re({page:oe-1,limit:20},null,!1,((a,i)=>{a?t(a):e(i)}))})),le((e=>e-1)),He()}catch(e){"AbortError"!==e.name&&Y(e.message||"Failed to load previous page","error")}finally{ae.current=!1}}}),[Re,oe,Y,He,Ie]),kt=(0,i.useCallback)((async()=>{if(!ae.current&&Te.hasMore){ae.current=!0;try{Ie([]),await new Promise(((e,t)=>{Re({page:oe+1,limit:20},null,!1,((a,i)=>{a?t(a):e(i)}))})),le((e=>e+1)),He()}catch(e){"AbortError"!==e.name&&Y(e.message||"Failed to load next page","error")}finally{ae.current=!1}}}),[Re,oe,Te.hasMore,Y,He,Ie]),St=(0,i.useCallback)((e=>{const t=new Set([e]),a=je.find((t=>t.tweet_id===e));var i;a&&(a.parent_tweet_id&&t.add(a.parent_tweet_id),null===(i=a.child_tweet_ids)||void 0===i||i.forEach((e=>t.add(e))));return Array.from(t)}),[je]),It=(0,i.useCallback)((()=>{ne((e=>(e&&He(),!e)))}),[He]),Tt=(0,i.useMemo)((()=>{const e=new Set;return je.filter((t=>{const a=t&&t.tweet_id&&"string"===typeof t.tweet_id&&t.tweet_id.trim()&&!e.has(t.tweet_id)&&t.position&&"number"===typeof t.position.x&&"number"===typeof t.position.y&&!isNaN(t.position.x)&&!isNaN(t.position.y)&&t.content&&"object"===typeof t.content&&t.content.type&&void 0!==t.content.value&&t.content.metadata;return e.add(t.tweet_id),a})).sort(((e,t)=>new Date(t.created_at)-new Date(e.created_at)))}),[je]),Mt=(0,i.useMemo)((()=>{var e;return{currentUser:M,userRole:E,onLike:wt,onDelete:ft,onReply:dt,onReplyHover:he,onEdit:xt,onPinToggle:vt,onSetReminder:_t,onShare:Ct,availableBoards:(null===(e=fe.tweet)||void 0===e?void 0:e.availableBoards)||se,boardId:S,isListView:ie,onModalStateChange:Ae}}),[M,E,wt,ft,dt,xt,vt,_t,Ct,fe.tweet,se,S,ie,Ae]),Et=(0,i.useCallback)((e=>{var t,a,i;const r=(null===(t=e.child_tweet_ids)||void 0===t?void 0:t.length)||0,n=be?St(be):[],o=(0,ue.jsx)(st,{tweet:e,...Mt,isParentHighlighted:n.includes(e.tweet_id),replyCount:r,parentTweet:e.parent_tweet_id&&(null===(a=je.find((t=>t.tweet_id===e.parent_tweet_id)))||void 0===a||null===(i=a.content)||void 0===i?void 0:i.value)||null,relatedTweetIds:n},`content-${e.tweet_id}`),l={initial:{opacity:0,x:50*Math.random()-25,y:50*Math.random()-25},animate:{opacity:1,x:0,y:0,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,x:100*Math.random()-50,y:100*Math.random()-50,transition:{duration:.3,ease:"easeIn"}}};return ie?(0,ue.jsx)(f.P.div,{variants:l,initial:"initial",animate:"animate",transition:{duration:.3},exit:"exit",sx:H.boardListViewTweet(e.parent_tweet_id),children:o},`tweet-${e.tweet_id}`):(0,ue.jsx)(me,{tweet:e,onStop:(t,a)=>{t.target.closest(".MuiIconButton-root, .MuiTypography-root, .MuiChip-root")||Be(e.tweet_id,{position:{x:a.x,y:a.y}}).then((()=>{var t;null===(t=rt.current)||void 0===t||t.emit("tweetUpdated",{tweet_id:e.tweet_id,position:{x:a.x,y:a.y},timestamp:(new Date).toISOString()})}))},currentUser:M,userRole:E,scale:Ne,children:(0,ue.jsx)(f.P.div,{variants:l,initial:"initial",animate:"animate",exit:"exit",children:o})},`tweet-${e.tweet_id}`)}),[be,St,je,Mt,Be,M,E,ie,Ne,rt]),Dt=(0,i.useMemo)((()=>Tt.length?(0,ue.jsx)(w.N,{children:Tt.map((e=>Et(e)))}):null),[Tt,Et]),Rt=(0,i.useCallback)((()=>(0,ue.jsxs)(l.A,{sx:H.boardErrorContainer,children:[(0,ue.jsx)(g.A,{sx:H.boardErrorText,children:De||"An error occurred"}),(0,ue.jsx)(y.A,{variant:"contained",onClick:nt,sx:H.boardErrorButton,"aria-label":"Retry fetching tweets",children:"Retry"})]})),[De,nt]);return Ee&&1===oe?(0,ue.jsx)(R.A,{}):(0,ue.jsx)(f.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},style:{...H.boardContainer,overflow:"hidden",height:"100vh",width:"100vw",position:"relative",zIndex:sa},children:(0,ue.jsxs)(l.A,{sx:{flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[Ce&&(0,ue.jsx)(l.A,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.1)",zIndex:ua,pointerEvents:"auto"},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.preventDefault(),onTouchStart:e=>e.preventDefault(),"aria-hidden":"true"}),(0,ue.jsx)(l.A,{sx:H.boardBackButtonContainer,children:(0,ue.jsx)(d.A,{title:"Go back",children:(0,ue.jsx)(c.A,{onClick:()=>V(-1),"aria-label":"Previous page",sx:H.boardBackButton,children:(0,ue.jsx)($.A,{})})})}),(0,ue.jsx)(l.A,{sx:{position:"absolute",top:4,right:12,zIndex:100,display:"flex",alignItems:"center",gap:1},children:(0,ue.jsx)(d.A,{title:"Online users",children:(0,ue.jsxs)(g.A,{variant:"caption",sx:{color:"text.secondary"},children:["Online: ",ge]})})}),(0,ue.jsxs)(l.A,{ref:te,sx:{...H.boardMain(ie,Ye),touchAction:Ce?"none":"auto",userSelect:"none",height:"100%",width:"100%",overflowY:ie&&!Ce?"auto":"hidden"},onMouseDown:ie?void 0:ut,onMouseMove:ie?void 0:pt,onMouseUp:ie?void 0:mt,onTouchStart:ie?void 0:bt,onTouchMove:ie?void 0:ht,onTouchEnd:ie?void 0:gt,role:"region","aria-label":ie?"Tweet list view":"Interactive board canvas","aria-live":"polite",tabIndex:0,children:[De&&Rt(),(0,ue.jsx)(f.P.div,{initial:{opacity:0,scale:ie?.95:1},animate:{opacity:1,scale:1},exit:{opacity:0,scale:ie?.95:1},transition:{duration:.3,ease:"easeInOut"},children:ie?(0,ue.jsx)(l.A,{sx:H.boardListViewContainer,children:0===Tt.length?(0,ue.jsx)(g.A,{sx:H.boardEmptyMessage,children:"No tweets yet. Create one to get started!"}):(0,ue.jsxs)(f.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[Dt,Ee&&(0,ue.jsx)(R.A,{}),je.length<Te.total&&(0,ue.jsx)(y.A,{variant:"outlined",onClick:At,sx:{mt:2,alignSelf:"center"},"aria-label":"Load more tweets",disabled:Ee||Ce,children:"Load More"})]})}):(0,ue.jsxs)(l.A,{sx:H.boardCanvas(Ne,Ve),children:[(0,ue.jsx)(l.A,{sx:H.boardTitleContainer(Ne),children:(0,ue.jsx)(g.A,{sx:H.boardTitle(I.length),children:I})}),0===Tt.length?(0,ue.jsx)(l.A,{sx:H.boardEmptyMessage,children:(0,ue.jsx)(g.A,{variant:"body1",color:"text.secondary",children:"No tweets yet. Tap or click anywhere to create one!"})}):Dt,ye.visible&&(0,ue.jsx)(Ft,{x:ye.x,y:ye.y,clientX:ye.clientX,clientY:ye.clientY,onSubmit:lt,onClose:()=>we({type:"CLOSE_POPUP"}),scale:Ne,offset:Ve,zIndex:da,parentTweet:ye.replyTweet})]})}),(0,ue.jsxs)(l.A,{sx:{...H.boardControlsContainer,position:"fixed",bottom:{xs:8,sm:16},right:{xs:8,sm:16},display:"flex",flexDirection:"column",gap:{xs:.5,sm:1},pointerEvents:Ce?"none":"auto"},children:[(0,ue.jsx)(d.A,{title:ie?"Switch to board view":"Switch to list view",children:(0,ue.jsx)(y.A,{variant:"contained",onClick:It,"aria-label":ie?"Show as board":"Show as list",sx:{...H.boardViewToggleButton,fontSize:{xs:"0.75rem",sm:"0.875rem"},padding:{xs:"4px 8px",sm:"6px 16px"},pointerEvents:"auto"},disabled:Ce,children:ie?"Board":"List"})}),(0,ue.jsx)(d.A,{title:"Refresh board",children:(0,ue.jsx)(c.A,{onClick:nt,size:"small","aria-label":"Refresh board",sx:{...H.boardZoomButton,pointerEvents:"auto"},disabled:Ee||Ce,children:(0,ue.jsx)(L.A,{fontSize:"small"})})}),(0,ue.jsx)(d.A,{title:"Previous page",children:(0,ue.jsx)(c.A,{onClick:jt,size:"small","aria-label":"Previous page of tweets",sx:{...H.boardViewToggleButton,fontSize:{xs:"0.75rem",sm:"0.875rem"},padding:{xs:"4px 8px",sm:"6px 16px"},pointerEvents:"auto"},disabled:Ee||Ce||oe<=1,children:(0,ue.jsx)(F.A,{fontSize:"small"})})}),(0,ue.jsx)(d.A,{title:"Next page",children:(0,ue.jsx)(c.A,{onClick:kt,size:"small","aria-label":"Next page of tweets",sx:{...H.boardViewToggleButton,fontSize:{xs:"0.75rem",sm:"0.875rem"},padding:{xs:"4px 8px",sm:"6px 16px"},pointerEvents:"auto"},disabled:Ee||Ce||!Te.hasMore,children:(0,ue.jsx)(O.A,{fontSize:"small"})})}),!ie&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(w.N,{children:Math.abs(Ne-1)>.01&&(0,ue.jsx)(f.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},children:(0,ue.jsx)(d.A,{title:"Reset zoom",children:(0,ue.jsx)(c.A,{onClick:()=>Ze("reset"),size:"small","aria-label":"Reset board zoom to 100%",sx:{...H.boardZoomButton,pointerEvents:"auto"},disabled:Ce,children:(0,ue.jsx)(U.A,{fontSize:"small"})})})})}),(0,ue.jsx)(d.A,{title:"Zoom out",children:(0,ue.jsx)(c.A,{onClick:()=>Ze("out"),size:"small","aria-label":"Zoom out board",sx:{...H.boardZoomButton,pointerEvents:"auto"},disabled:Ce,children:(0,ue.jsx)(W.A,{fontSize:"small"})})}),(0,ue.jsxs)(g.A,{sx:{...H.boardZoomText,fontSize:{xs:"0.75rem",sm:"0.875rem"}},children:[Math.round(100*Ne),"%"]}),(0,ue.jsx)(d.A,{title:"Zoom in",children:(0,ue.jsx)(c.A,{onClick:()=>Ze("in"),size:"small","aria-label":"Zoom in board",sx:{...H.boardZoomButton,pointerEvents:"auto"},disabled:Ce,children:(0,ue.jsx)(X.A,{fontSize:"small"})})})]})]})]}),fe.tweet&&(0,ue.jsxs)(m.A,{open:!0,onClose:()=>_e({type:"CLEAR_EDIT_MODAL"}),maxWidth:"sm",fullWidth:!0,sx:{...H.boardEditDialog,zIndex:ca},onKeyDown:e=>"Escape"===e.key&&!ce&&_e({type:"CLEAR_EDIT_MODAL"}),"aria-describedby":"edit-tweet-description",disableEscapeKeyDown:ce,children:[(0,ue.jsx)(b.A,{sx:H.boardEditDialogTitle,children:"Edit Tweet"}),(0,ue.jsxs)(h.A,{sx:H.boardEditDialogContent,children:[(0,ue.jsx)(g.A,{id:"edit-tweet-description",sx:{display:"none"},children:"Edit the content, status, or board of the tweet."}),(0,ue.jsx)(x.A,{multiline:!0,fullWidth:!0,label:"Tweet Content",value:(null===(t=fe.tweet.content)||void 0===t?void 0:t.value)||"",onChange:e=>_e({type:"UPDATE_EDIT_CONTENT",value:e.target.value}),minRows:3,inputProps:{maxLength:la},error:((null===(a=fe.tweet.content)||void 0===a||null===(n=a.value)||void 0===n?void 0:n.length)||0)>la,helperText:((null===(s=fe.tweet.content)||void 0===s||null===(u=s.value)||void 0===u?void 0:u.length)||0)>la?"Tweet exceeds 1000 characters":`${(null===(p=fe.tweet.content)||void 0===p||null===(_=p.value)||void 0===_?void 0:_.length)||0}/1000`,sx:H.boardEditTextField,"aria-label":"Tweet content",autoFocus:!0}),at.canChangeStatus&&(0,ue.jsxs)(P.A,{fullWidth:!0,sx:H.boardEditFormControl,children:[(0,ue.jsx)(B.A,{id:"status-label",children:"Tweet Status"}),(0,ue.jsx)(q.A,{labelId:"status-label",value:fe.newStatus,label:"Tweet Status",onChange:e=>_e({type:"SET_NEW_STATUS",status:e.target.value}),"aria-label":"Tweet status",children:["pending","approved","rejected","announcement","reminder","pinned","archived"].map((e=>(0,ue.jsx)(o.A,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),at.canMoveBoard&&se.length>0&&(0,ue.jsxs)(P.A,{fullWidth:!0,sx:H.boardEditFormControl,children:[(0,ue.jsx)(B.A,{id:"board-label",children:"Move to Board"}),(0,ue.jsx)(q.A,{labelId:"board-label",value:fe.selectedBoardId,label:"Move to Board",onChange:e=>_e({type:"SET_SELECTED_BOARD",boardId:e.target.value}),"aria-label":"Move to board",children:se.map((e=>(0,ue.jsx)(o.A,{value:e.board_id,children:e.title||e.name||"Untitled Board"},e.board_id)))})]})]}),(0,ue.jsxs)(v.A,{sx:{p:2,gap:1},children:[(0,ue.jsx)(y.A,{onClick:()=>_e({type:"CLEAR_EDIT_MODAL"}),sx:H.boardEditCancelButton,"aria-label":"Cancel edit tweet",disabled:ce,children:"Cancel"}),(0,ue.jsx)(y.A,{onClick:yt,variant:"contained",disabled:ce||!(null!==(C=fe.tweet.content)&&void 0!==C&&null!==(A=C.value)&&void 0!==A&&A.trim())||((null===(j=fe.tweet.content)||void 0===j||null===(k=j.value)||void 0===k?void 0:k.length)||0)>la,sx:H.boardEditSaveButton,"aria-label":"Save edited tweet",startIcon:ce?(0,ue.jsx)(z.A,{size:20}):null,children:ce?"Saving...":"Save"})]})]})]})})};ha.defaultProps={availableBoards:[]};const ga=(e,t)=>e.boardId===t.boardId&&e.boardTitle===t.boardTitle&&e.token===t.token&&e.currentUser.anonymous_id===t.currentUser.anonymous_id&&e.currentUser.username===t.currentUser.username&&e.userRole===t.userRole&&e.onLogout===t.onLogout&&e.availableBoards.length===t.availableBoards.length&&e.availableBoards.every(((e,a)=>{var i,r,n;return e.board_id===(null===(i=t.availableBoards[a])||void 0===i?void 0:i.board_id)&&e.title===(null===(r=t.availableBoards[a])||void 0===r?void 0:r.title)&&e.name===(null===(n=t.availableBoards[a])||void 0===n?void 0:n.name)})),xa=(0,i.memo)(ha,ga);var va=a(342),ya=a(7331),wa=a(633),fa=a(507),_a=a(6552),Ca=a(5988);const Aa=e=>{let{points:t}=e;const[a,r]=(0,i.useState)(t),[n,o]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{if(t!==a){o(!0),r(t);const e=setTimeout((()=>o(!1)),500);return()=>clearTimeout(e)}}),[t,a]),(0,ue.jsx)(f.P.div,{animate:n?{scale:[1,1.2,1]}:{},transition:{duration:.5},children:(0,ue.jsx)(g.A,{variant:"body2",children:(0,Ca.X)(t)})})},ja=e=>{let{}=e;return(0,ue.jsx)(f.P.div,{initial:{opacity:1,y:0,scale:1},animate:{opacity:0,y:-30,scale:1.5},transition:{duration:.7},style:{position:"absolute",top:0,right:0},children:(0,ue.jsx)(c.A,{size:"small","aria-label":"Points Deduction",children:(0,ue.jsx)(E.A,{sx:{color:"text.primary"}})})})},ka="Authentication required.",Sa="User ID is missing.",Ia="Points amount is missing.",Ta="Reason for points update is missing.",Ma="An error occurred.";const Ea=new class{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}has(e){return this.cache.has(e)}clear(){this.cache.clear()}}(10),Da=(e,t,a)=>{const[r,n]=(0,i.useState)(null),[o,l]=(0,i.useState)([]),[s,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(null),p=(0,i.useRef)(null),m=(0,i.useRef)(new Set),b=(0,i.useCallback)(((e,i)=>{if("AbortError"===e.name)return null;const r=e.status||500;return 401!==r&&403!==r||(t("Your session has expired. Please log in again."),a("/login")),u(i||e.message||Ma),null}),[t,a]),h=(0,i.useCallback)(((e,t)=>function(){for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return p.current&&clearTimeout(p.current),new Promise((a=>{p.current=setTimeout((async()=>{const t=await e(...i);a(t)}),t)}))}),[]),g=(0,i.useCallback)((function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>({member_id:e.member_id||e.anonymous_id||"",username:e.username||"Unknown",total_points:e.total_points||0,avatar:e.avatar||null,anonymous_id:e.anonymous_id||e.member_id||""})))}),[]),x=(0,i.useCallback)((()=>{n(null),l([]),u(null),Ea.clear()}),[]),v=(0,i.useCallback)((()=>{const e=new AbortController;return m.current.add(e),e}),[]),y=(0,i.useCallback)((()=>{m.current.forEach((e=>e.abort())),m.current.clear()}),[]),w=(0,i.useCallback)((async t=>{if(!e)return u(ka),null;const a="v1:points",i=Ea.get(a);if(i)return n(i),i;d(!0),u(null);try{const i=await(async(e,t)=>{try{return(await Ot.Ay.get("/api/v1/points",{headers:{Authorization:`Bearer ${e}`},signal:t})).data.content||{}}catch(a){return(0,Ot.hS)(a)}})(e,t);if(!i)throw new Error("No points data received");return n(i),Ea.set(a,i),i}catch(r){return b(r,Ma)}finally{d(!1)}}),[e,b]),f=(0,i.useMemo)((()=>h(w,300)),[w]),_=(0,i.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1?arguments[1]:void 0;if(!e)return u(ka),null;const i=`v1:topContributors:${t}`,r=Ea.get(i);if(r)return l(g(r)),r;d(!0),u(null);try{const r=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2?arguments[2]:void 0;try{return(await Ot.Ay.get("/api/v1/points/top",{headers:{Authorization:`Bearer ${e}`},params:{limit:t},signal:a})).data.content||[]}catch(i){return(0,Ot.hS)(i)}}(e,t,a);if(!r)throw new Error("No contributors data received");return l(g(r)),Ea.set(i,r),r}catch(n){return b(n,Ma)}finally{d(!1)}}),[e,b,g]),C=(0,i.useMemo)((()=>h(_,300)),[_]),A=(0,i.useCallback)((async(t,a)=>{if(!e||null===t||void 0===t||!t.trim()||!a)return u(e?t?Ia:Sa:ka),null;d(!0),u(null);try{const i=await(async(e,t,a)=>{if(!e||!t)throw new Error("Recipient ID and amount are required");try{return(await Ot.Ay.post("/api/v1/points/transfer",{recipientId:e,amount:t},{headers:{Authorization:`Bearer ${a}`}})).data.content||{}}catch(i){return(0,Ot.hS)(i)}})(t,a,e);if(!i)throw new Error("Failed to transfer points");return n((e=>({...e,total_points:i.sender_points,donated_points:((null===e||void 0===e?void 0:e.donated_points)||0)+a}))),Ea.clear(),i}catch(i){return b(i,Ma)}finally{d(!1)}}),[e,b]),j=(0,i.useCallback)((async(t,a,i)=>{if(!e||null===t||void 0===t||!t.trim()||!a||null===i||void 0===i||!i.trim())return u(e?t?a?Ta:Ia:Sa:ka),null;d(!0),u(null);try{const r=await(async(e,t,a,i)=>{if(!e||!t||!a)throw new Error("Target user ID, amount, and reason are required");try{return(await Ot.Ay.put("/api/v1/points/update",{targetUserId:e,amount:t,reason:a},{headers:{Authorization:`Bearer ${i}`}})).data.content||{}}catch(r){return(0,Ot.hS)(r)}})(t,a,i,e);if(!r)throw new Error("Failed to update points");return Ea.clear(),r}catch(r){return b(r,Ma)}finally{d(!1)}}),[e,b]);return(0,i.useEffect)((()=>{if(!e)return y(),void x();const t=v();return f(t.signal).catch((e=>{"AbortError"!==e.name&&console.error("Initial fetch points error:",e)})),()=>{y(),p.current&&clearTimeout(p.current)}}),[e,f,x,v,y]),(0,i.useMemo)((()=>({pointsData:r,topContributors:o,loading:s,error:c,fetchPointsData:f,fetchTopContributorsList:C,transferUserPoints:A,updatePointsData:j,resetState:x})),[r,o,s,c,f,C,A,j,x])};var Ra=a(4074),Pa=a(1067);const Ba={initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1,transition:{duration:.2}},exit:{opacity:0,scale:.8,transition:{duration:.2}}},qa=(0,i.memo)((()=>{var e;const t=(0,r.Zp)(),{showNotification:a}=(0,ra.h)(),P=(0,n.A)(),{board_id:B}=(0,r.g)(),{token:q,authData:z,handleLogout:$,isAuthenticated:L,loading:F}=(0,va.A)(t),O=(0,i.useRef)(null),[U,W]=(0,i.useState)(!1),[X,N]=(0,i.useState)(null),[V,Y]=(0,i.useState)(!1),[H,K]=(0,i.useState)(!1),[Q,G]=(0,i.useState)(!1),[J,ee]=(0,i.useState)(null),[te,ae]=(0,i.useState)(""),[ie,re]=(0,i.useState)(0),ne=(0,i.useRef)(!0),{boardItem:oe,members:le,loading:se,error:de,fetchBoard:ce,updateExistingBoard:pe,toggleFavoriteBoard:me,deleteExistingBoard:be,addMemberToBoard:he,removeMemberFromBoard:ge,updateMemberRole:xe,clearBoardTweets:ve}=(0,ia.b)(q,$,t),{pointsData:ye,loading:we,fetchPointsData:fe}=Da(q,$,t),{gates:_e,loading:Ce,fetchGatesList:Ae}=(0,Ra.c)(q,$,t),{classes:je,loading:ke,fetchClassesList:Se}=(0,Pa.g)(q,$,t),Ie=(0,i.useMemo)((()=>{var e;return oe&&z?oe.creator_id===(null===z||void 0===z?void 0:z.anonymous_id)?"owner":oe.is_public?"viewer":(null===(e=le.find((e=>e.anonymous_id===(null===z||void 0===z?void 0:z.anonymous_id))))||void 0===e?void 0:e.role)||"viewer":"viewer"}),[oe,z,le]),Te=(0,i.useMemo)((()=>{var e,t;return null!==(e=null===oe||void 0===oe||null===(t=oe.favorited_by)||void 0===t?void 0:t.some((e=>e.anonymous_id===(null===z||void 0===z?void 0:z.anonymous_id))))&&void 0!==e&&e}),[null===oe||void 0===oe?void 0:oe.favorited_by,null===z||void 0===z?void 0:z.anonymous_id]),Me=(0,i.useMemo)((()=>{var e;return null!==(e=null===oe||void 0===oe?void 0:oe.visibility)&&void 0!==e?e:null!==oe&&void 0!==oe&&oe.is_public?"public":"private"}),[null===oe||void 0===oe?void 0:oe.visibility,null===oe||void 0===oe?void 0:oe.is_public]),Ee=(0,i.useMemo)((()=>(0,Z.debounce)((async(e,t)=>{if(ne.current)try{await ce(e,t)}catch(i){"AbortError"!==i.name&&a(i.message||"Failed to fetch board","error")}}),300)),[ce,a]),De=(0,i.useMemo)((()=>(0,Z.debounce)((async e=>{if(ne.current)try{await fe(e)}catch(t){"AbortError"!==t.name&&a(t.message||"Failed to fetch points","error")}}),300)),[fe,a]);(0,i.useEffect)((()=>{if(!q||!B||!L)return;const e=new AbortController;return Ee(B,e.signal),()=>{e.abort(),Ee.cancel(),ne.current=!1}}),[q,B,L,Ee]),(0,i.useEffect)((()=>{if(!q||!L||!U)return;const e=new AbortController;return De(e.signal),()=>{e.abort(),De.cancel()}}),[q,L,U,De]),(0,i.useEffect)((()=>{if(!O.current)return;const e=new IntersectionObserver((e=>{let[t]=e;t.isIntersecting&&!U&&W(!0)}),{threshold:.1});return e.observe(O.current),()=>e.disconnect()}),[]),(0,i.useEffect)((()=>{if(!X||!q||!L||"owner"!==Ie&&"admin"!==Ie)return;const e=new AbortController;return Promise.all([Ae({visibility:"public"},e.signal),Se({},e.signal)]).catch((e=>{"AbortError"!==e.name&&a(e.message||"Failed to load gates or classes","error")})),()=>e.abort()}),[X,q,L,Ie,Ae,Se,a]),(0,i.useEffect)((()=>{de&&(a(de||"An error occurred","error"),null!==de&&void 0!==de&&de.includes("Board not found")&&setTimeout((()=>t("/boards")),2e3))}),[de,a,t]),(0,i.useEffect)((()=>{if(null===ye||void 0===ye||!ye.total_points)return;const e=ye.prev_points||ye.total_points;if(ye.total_points<e){re(e-ye.total_points);const t=setTimeout((()=>re(0)),700);return()=>clearTimeout(t)}}),[null===ye||void 0===ye?void 0:ye.total_points]);const Re=(0,i.useCallback)((async()=>{if(!X||"owner"!==Ie&&"admin"!==Ie)return;const e=We(X);if(e)a(e,"error");else try{await pe(X.board_id,{name:X.name,description:X.description,is_public:"public"===X.visibility,visibility:X.visibility,type:X.type,gate_id:X.gate_id||null,class_id:X.class_id||null,settings:X.settings,tags:X.tags}),a("Board updated","success"),N(null)}catch(t){a(t.message||"Failed to update board","error")}}),[X,Ie,pe,a,B]),Pe=(0,i.useCallback)((async()=>{if(oe)try{await me(B,Te),a("Board "+(Te?"unfavorited":"favorited"),"success")}catch(e){a("Failed to toggle favorite","error")}}),[oe,B,Te,me,a]),Be=(0,i.useCallback)((()=>{var e,t,a,i,r,n,o,l,s;"owner"!==Ie&&"admin"!==Ie||!oe||N({board_id:oe.board_id,name:oe.name||"",description:oe.description||"",is_public:oe.is_public||!1,visibility:oe.visibility||(oe.is_public?"public":"private"),type:oe.type||"personal",gate_id:oe.gate_id||"",class_id:oe.class_id||"",settings:{max_tweets:(null===(e=oe.settings)||void 0===e?void 0:e.max_tweets)||100,tweet_cost:(null===(t=oe.settings)||void 0===t?void 0:t.tweet_cost)||1,max_members:(null===(a=oe.settings)||void 0===a?void 0:a.max_members)||50,favorite_cost:(null===(i=oe.settings)||void 0===i?void 0:i.favorite_cost)||1,points_to_creator:(null===(r=oe.settings)||void 0===r?void 0:r.points_to_creator)||1,allow_invites:!1!==(null===(n=oe.settings)||void 0===n?void 0:n.allow_invites),require_approval:(null===(o=oe.settings)||void 0===o?void 0:o.require_approval)||!1,ai_moderation_enabled:!1!==(null===(l=oe.settings)||void 0===l?void 0:l.ai_moderation_enabled),auto_archive_after:(null===(s=oe.settings)||void 0===s?void 0:s.auto_archive_after)||30},tags:oe.tags||[],current_user:{anonymous_id:null===z||void 0===z?void 0:z.anonymous_id,role:Ie}})}),[oe,null===z||void 0===z?void 0:z.anonymous_id,Ie]),qe=(0,i.useCallback)((()=>{"owner"!==Ie&&"admin"!==Ie||Y(!0)}),[Ie]),ze=(0,i.useCallback)((()=>{ae(`${window.location.origin}/board/${B}`),K(!0)}),[B]),$e=(0,i.useCallback)((()=>{"owner"===Ie&&G(!0)}),[Ie]),Le=(0,i.useCallback)((async()=>{try{await be(B),a("Board deleted","success"),t("/boards")}catch(e){a("Failed to delete board","error")}finally{G(!1)}}),[B,be,t,a]),Fe=(0,i.useCallback)((async()=>{if(te)try{await navigator.clipboard.write(te),a("Link copied","success")}catch(e){a("Failed to copy link","error")}finally{K(!1)}else a("Invalid share link","error")}),[te,a]),Oe=(0,i.useCallback)((e=>ee(e.currentTarget)),[]),Ue=(0,i.useCallback)((()=>ee(null)),[]),We=(0,i.useCallback)((e=>{var t;if(null===e||void 0===e||null===(t=e.name)||void 0===t||!t.trim())return"Board name is required";const a=e.settings||{};return a.max_tweets<1||a.max_tweets>1e4?"Max tweets must be 1-10000":a.tweet_cost<0?"Tweet cost must be non-negative":a.favorite_cost<0?"Favorite cost must be non-negative":a.points_to_creator<0||a.points_to_creator>100?"Points to creator must be 0-100":a.max_members<1||a.max_members>1e4?"Max members must be 1-10000":"public"===e.visibility&&!e.gate_id&&!e.class_id&&(null===_e||void 0===_e?void 0:_e.length)>0?"Public boards require a gate or class":""}),[_e]),Xe=(0,i.useMemo)((()=>{var e;return[...new Set((null===oe||void 0===oe||null===(e=oe.child_board_ids)||void 0===e?void 0:e.filter((e=>e)))||[])].map((e=>(0,ue.jsxs)(o.A,{onClick:()=>{t(`/board/${e}`),Ue()},"aria-label":`Go to child board ${e.slice(0,8)}`,children:["Go to Child Board ",e.slice(0,8)]},e)))}),[null===oe||void 0===oe?void 0:oe.child_board_ids,t,Ue]);return F?(0,ue.jsx)(R.A,{}):(0,ue.jsxs)(l.A,{sx:{position:"relative",width:"100%",height:"100vh"},children:[(0,ue.jsxs)(l.A,{sx:{position:"absolute",top:16,right:0,display:"flex",gap:.3,flexWrap:"wrap",justifyContent:"flex-end",zIndex:100,"@media (max-width: 600px)":{transform:"scale(0.8)"}},children:[(0,ue.jsx)(w.N,{children:se?(0,ue.jsx)(ue.Fragment,{children:(0,ue.jsx)(s.A,{variant:"circular",width:40,height:40})}):(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:`Board visibility: ${Me}`,children:(0,ue.jsx)(c.A,{"aria-label":`Board visibility: ${Me}`,children:"public"===Me?(0,ue.jsx)(_.A,{}):(0,ue.jsx)(C.A,{})})})}),(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:Te?"Unfavorite Board":"Favorite Board",children:(0,ue.jsx)(c.A,{onClick:Pe,"aria-label":Te?"Unfavorite board":"Favorite board",children:Te?(0,ue.jsx)(A.A,{color:"error"}):(0,ue.jsx)(j.A,{})})})}),(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:"Share Board",children:(0,ue.jsx)(c.A,{onClick:ze,"aria-label":"Share board",children:(0,ue.jsx)(k.A,{})})})}),("owner"===Ie||"admin"===Ie)&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:"Manage Members",children:(0,ue.jsx)(c.A,{onClick:qe,"aria-label":`Manage members (current count: ${(null===le||void 0===le?void 0:le.length)||0})`,children:(0,ue.jsx)(u.A,{badgeContent:(null===le||void 0===le?void 0:le.length)||0,color:"default",children:(0,ue.jsx)(S.A,{})})})})}),(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:"Edit Board",children:(0,ue.jsx)(c.A,{onClick:Be,"aria-label":"Edit board",children:(0,ue.jsx)(I.A,{})})})})]}),"owner"===Ie&&(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:"Delete Board",children:(0,ue.jsx)(c.A,{onClick:$e,"aria-label":"Delete board",children:(0,ue.jsx)(T.A,{color:"error"})})})}),(null===oe||void 0===oe||null===(e=oe.child_board_ids)||void 0===e?void 0:e.length)>0&&(0,ue.jsx)(f.P.div,{variants:Ba,initial:"initial",animate:"animate",exit:"exit",children:(0,ue.jsx)(d.A,{title:"Child Boards",children:(0,ue.jsx)(c.A,{"aria-controls":"board-menu","aria-haspopup":"true",onClick:Oe,sx:{bgcolor:"background.paper","&:hover":{bgcolor:"action.hover"}},"aria-label":"Open child boards menu",children:(0,ue.jsx)(M.A,{})})})})]})}),(0,ue.jsx)(p.A,{id:"board-menu",anchorEl:J,open:Boolean(J),onClose:Ue,slotProps:{paper:{sx:{borderRadius:P.shape.borderRadiusMedium}}},children:Xe})]}),(0,ue.jsx)(l.A,{ref:O,sx:{position:"absolute",bottom:16,left:16,zIndex:100,display:"flex",alignItems:"center",gap:1,"@media (max-width: 600px)":{transform:"scale(0.8)"}},children:(0,ue.jsx)(w.N,{children:(0,ue.jsxs)(f.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},children:[(0,ue.jsx)(d.A,{title:"Available points",children:(0,ue.jsx)(c.A,{size:"small","aria-label":`Available points: ${(null===ye||void 0===ye?void 0:ye.total_points)||0}`,children:(0,ue.jsx)(E.A,{})})}),(0,ue.jsx)(Aa,{points:(null===ye||void 0===ye?void 0:ye.total_points)||0}),ie>0&&(0,ue.jsx)(ja,{pointsSpent:ie})]},"points")})}),(0,ue.jsx)(xa,{boardId:B,boardTitle:(null===oe||void 0===oe?void 0:oe.name)||"",token:q,currentUser:z,userRole:Ie,onLogout:$,availableBoards:[]}),X&&(0,ue.jsx)(ya.A,{open:!0,title:"Edit Board",board:X,setBoard:N,onSave:Re,onCancel:()=>N(null),disabled:se||Ce||ke,gates:_e||[],classes:je||[],token:q,userRole:Ie}),V&&(0,ue.jsx)(wa.A,{open:V,title:"Manage Board Members",boardId:B,token:q,onSave:()=>{Ee(B),Y(!1)},onCancel:()=>Y(!1),disabled:"owner"!==Ie&&"admin"!==Ie,members:le||[],addMember:he,removeMember:ge,updateMemberRole:xe}),(0,ue.jsxs)(m.A,{open:H,onClose:()=>K(!1),maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:P.shape.borderRadiusMedium}},"aria-labelledby":"share-dialog-title",children:[(0,ue.jsx)(b.A,{id:"share-dialog-title",children:"Share Board"}),(0,ue.jsxs)(h.A,{children:[(0,ue.jsx)(g.A,{variant:"body2",sx:{mb:2},children:"Copy the link below to share this board:"}),(0,ue.jsx)(x.A,{fullWidth:!0,value:te,InputProps:{readOnly:!0},"aria-label":"Board share link"})]}),(0,ue.jsxs)(v.A,{children:[(0,ue.jsx)(y.A,{onClick:()=>K(!1),sx:_a.Km,"aria-label":"Close share dialog",children:"Close"}),(0,ue.jsx)(y.A,{onClick:Fe,sx:_a.nT,startIcon:(0,ue.jsx)(D.A,{}),"aria-label":"Copy share link",children:"Copy Link"})]})]}),(0,ue.jsx)(fa.A,{open:Q,onClose:()=>G(!1),onConfirm:Le,message:"Are you sure you want to delete this board? This action cannot be undone.",disabled:se})]})}))}}]);
//# sourceMappingURL=95.8ceb835d.chunk.js.map