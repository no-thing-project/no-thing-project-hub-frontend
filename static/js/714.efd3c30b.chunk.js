"use strict";(self.webpackChunkgate_from_nothingproject_front_end=self.webpackChunkgate_from_nothingproject_front_end||[]).push([[714],{507:(e,r,t)=>{t.d(r,{A:()=>b});var i=t(5043),a=t(6240),n=t(35),s=t(6600),l=t(5316),o=t(8533),d=t(9347),c=t(1906),u=t(6552),m=t(579);const h=e=>{let{open:r,onClose:t,onConfirm:i,message:h,disabled:b}=e;const g=(0,a.A)();return(0,m.jsxs)(n.A,{open:r,onClose:t,maxWidth:"xs",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:g.shape.borderRadiusMedium,p:{xs:1,md:2}}},children:[(0,m.jsx)(s.A,{sx:{fontSize:{xs:"1.25rem",md:"1.5rem"}},children:"Confirm Deletion"}),(0,m.jsx)(l.A,{children:(0,m.jsx)(o.A,{sx:{color:"text.primary",fontSize:{xs:"0.875rem",md:"1rem"}},children:h})}),(0,m.jsxs)(d.A,{children:[(0,m.jsx)(c.A,{onClick:t,sx:{...u.Km,minWidth:{xs:"100%",sm:120},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:b,"aria-label":"Cancel deletion",children:"Cancel"}),(0,m.jsx)(c.A,{onClick:i,sx:{...u.nT,backgroundColor:"error.main","&:hover":{backgroundColor:"error.dark"},minWidth:{xs:"100%",sm:120},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:b,"aria-label":"Confirm deletion",children:"Delete"})]})]})},b=i.memo(h)},633:(e,r,t)=>{t.d(r,{A:()=>R});var i=t(5043),a=t(6240),n=t(35),s=t(6600),l=t(5316),o=t(7353),d=t(2357),c=t(7784),u=t(1637),m=t(3193),h=t(9190),b=t(2221),g=t(2143),v=t(1673),p=t(1906),f=t(4496),x=t(9650),w=t(1596),y=t(1806),_=t(4882),A=t(8076),j=t(39),C=t(3460),E=t(3845),S=t(7392),$=t(9347),k=t(1387),I=t(6552),M=t(4834),q=t(3536),z=t(1654),L=t(9406),P=t(579);const D=e=>{let{open:r,title:t,gateId:D,classId:R,boardId:B,token:F,onSave:G,onCancel:T,disabled:N,members:U,addMember:W,removeMember:V,updateMemberRole:O}=e;const J=(0,a.A)(),{showNotification:H}=(0,z.hN)(),{searchUsersByUsername:X,loading:K}=(0,L.F)(F,(()=>{}),(()=>{})),[Y,Z]=(0,i.useState)(""),[Q,ee]=(0,i.useState)("viewer"),[re,te]=(0,i.useState)({}),[ie,ae]=(0,i.useState)([]),ne=["viewer","moderator","admin","owner"],se=(0,i.useMemo)((()=>D?{type:"gate",id:D,name:"Gate"}:R?{type:"class",id:R,name:"Class"}:B?{type:"board",id:B,name:"Board"}:{type:null,id:null,name:"Unknown"}),[D,R,B]),le=(0,i.useMemo)((()=>({username:{value:Y,rules:{required:!0,minLength:3,maxLength:50}},role:{value:Q,rules:{required:!0,validRoles:ne}}})),[Y,Q]),oe=(0,i.useMemo)((()=>(0,q.debounce)((async e=>{if(!e||e.length<3)ae([]);else try{const r=(await X(e,{limit:10})).map((e=>({username:e.username||e.anonymous_id||"Unknown",anonymous_id:e.anonymous_id})));ae(r),r.length||H(`No users found for this ${se.name.toLowerCase()}`,"info")}catch(r){console.error("Search users error:",r),H("Failed to fetch user suggestions","error"),ae([])}}),300)),[X,H,se.name]),de=(0,i.useCallback)(((e,r)=>{const t=r||"";Z(t);const i=(0,M.j)("username",t,le.username.rules);te((e=>({...e,username:i[0]||null}))),t.length>=3?oe(t):ae([])}),[oe,le]),ce=(0,i.useCallback)((e=>{const{value:r}=e.target;ee(r);const t=(0,M.j)("role",r,le.role.rules);te((e=>({...e,role:t[0]||null})))}),[le]),ue=(0,i.useCallback)((async()=>{const e=(0,M.l)(le);if(Object.keys(e).length>0)return void te(e);const r=ie.find((e=>e.username===Y));if(!r)return H("Please select a valid user from the suggestions","error"),void te((e=>({...e,username:"Invalid user selected"})));if(se.id)try{await W(se.id,{username:r.username,role:Q}),Z(""),ee("viewer"),te({}),ae([]),H(`Member added to ${se.name.toLowerCase()} successfully!`,"success"),G()}catch(t){console.error(`Add ${se.name.toLowerCase()} member error:`,t),H(t.message||`Failed to add member to ${se.name.toLowerCase()}`,"error")}else H(`No valid ${se.name.toLowerCase()} ID provided`,"error")}),[se,Y,Q,ie,W,H,le,G]),me=(0,i.useCallback)((async e=>{if(se.id)try{await V(se.id,e),H(`Member removed from ${se.name.toLowerCase()} successfully!`,"success")}catch(r){console.error(`Remove ${se.name.toLowerCase()} member error:`,r),H(r.message||`Failed to remove member from ${se.name.toLowerCase()}`,"error")}else H(`No valid ${se.name.toLowerCase()} ID provided`,"error")}),[se,V,H]),he=(0,i.useCallback)((async(e,r)=>{if(se.id)try{await O(se.id,e,r),H(`Member role updated in ${se.name.toLowerCase()} successfully!`,"success")}catch(t){console.error(`Update ${se.name.toLowerCase()} role error:`,t),H(t.message||`Failed to update member role in ${se.name.toLowerCase()}`,"error")}else H(`No valid ${se.name.toLowerCase()} ID provided`,"error")}),[se,O,H]);return(0,i.useEffect)((()=>{r||(Z(""),ee("viewer"),ae([]),te({}))}),[r]),(0,P.jsxs)(n.A,{open:r,onClose:T,maxWidth:"md",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:J.shape.borderRadiusMedium,p:{xs:1,md:2}}},children:[(0,P.jsx)(s.A,{sx:{fontSize:{xs:"1.25rem",md:"1.5rem"}},children:t||`Manage ${se.name} Members`}),(0,P.jsxs)(l.A,{children:[(0,P.jsxs)(o.A,{sx:{display:"flex",gap:{xs:1,md:2},mb:{xs:2,md:3},alignItems:"center",flexDirection:{xs:"column",sm:"row"}},children:[(0,P.jsx)(d.A,{freeSolo:!1,options:ie,getOptionLabel:e=>e.username||"",inputValue:Y,onInputChange:de,loading:K,sx:{flex:1,width:{xs:"100%",sm:"auto"}},renderInput:e=>(0,P.jsx)(c.A,{...e,autoFocus:!0,label:"Username",type:"text",variant:"outlined",sx:{...I.z9,mt:0},required:!0,disabled:N,error:!!re.username,helperText:re.username||`Search for a user to add to the ${se.name.toLowerCase()}`,InputProps:{...e.InputProps,endAdornment:(0,P.jsxs)(P.Fragment,{children:[K?(0,P.jsx)(u.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})}}),"aria-label":`Search for a user to add to ${se.name.toLowerCase()}`}),(0,P.jsxs)(m.A,{sx:{minWidth:{xs:"100%",sm:150},mt:0,...I.p5},error:!!re.role,children:[(0,P.jsx)(h.A,{children:"Role"}),(0,P.jsxs)(b.A,{value:Q,onChange:ce,label:"Role",disabled:N,children:[(0,P.jsx)(g.A,{value:"viewer",children:"Viewer"}),(0,P.jsx)(g.A,{value:"moderator",children:"Moderator"}),(0,P.jsx)(g.A,{value:"admin",children:"Admin"})]}),re.role&&(0,P.jsx)(v.A,{children:re.role})]}),(0,P.jsx)(p.A,{variant:"contained",onClick:ue,sx:{...I.nT,minWidth:{xs:"100%",sm:120},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:N||Object.keys(re).some((e=>re[e])),"aria-label":`Add member to ${se.name.toLowerCase()}`,children:"Add"})]}),(0,P.jsxs)(f.A,{variant:"h6",sx:{mb:2,fontSize:{xs:"1.25rem",md:"1.5rem"}},children:["Current ",se.name," Members"]}),(null===U||void 0===U?void 0:U.length)>0?(0,P.jsx)(x.A,{component:w.A,sx:{borderRadius:J.shape.borderRadiusSmall},children:(0,P.jsxs)(y.A,{children:[(0,P.jsx)(_.A,{children:(0,P.jsxs)(A.A,{children:[(0,P.jsx)(j.A,{sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:"Username"}),(0,P.jsx)(j.A,{sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:"Role"}),(0,P.jsx)(j.A,{sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:"Joined At"}),(0,P.jsx)(j.A,{sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:"Actions"})]})}),(0,P.jsx)(C.A,{children:U.map((e=>(0,P.jsxs)(A.A,{children:[(0,P.jsx)(j.A,{children:(0,P.jsx)(E.A,{label:e.username||"Unknown",size:"small",sx:{bgcolor:"background.paper",fontSize:{xs:"0.75rem",md:"0.875rem"}}})}),(0,P.jsx)(j.A,{children:(0,P.jsxs)(m.A,{sx:{minWidth:{xs:100,sm:120},...I.p5},children:[(0,P.jsx)(h.A,{children:"Role"}),(0,P.jsxs)(b.A,{value:e.role,onChange:r=>he(e.username,r.target.value),label:"Role",disabled:N||"owner"===e.role,size:"small",children:[(0,P.jsx)(g.A,{value:"viewer",children:"Viewer"}),(0,P.jsx)(g.A,{value:"moderator",children:"Moderator"}),(0,P.jsx)(g.A,{value:"admin",children:"Admin"}),"owner"===e.role&&(0,P.jsx)(g.A,{value:"owner",disabled:!0,children:"Owner"})]})]})}),(0,P.jsx)(j.A,{sx:{fontSize:{xs:"0.75rem",md:"0.875rem"}},children:e.joined_at?new Date(e.joined_at).toLocaleDateString():"Unknown"}),(0,P.jsx)(j.A,{children:"owner"!==e.role&&(0,P.jsx)(S.A,{onClick:()=>me(e.username),disabled:N,"aria-label":`Remove member ${e.username||"Unknown"} from ${se.name.toLowerCase()}`,children:(0,P.jsx)(k.A,{fontSize:"small",color:"error"})})})]},e.anonymous_id||e._id)))})]})}):(0,P.jsxs)(f.A,{variant:"body2",color:"text.secondary",children:["No members in this ",se.name.toLowerCase()," yet."]})]}),(0,P.jsx)($.A,{children:(0,P.jsx)(p.A,{variant:"contained",onClick:T,sx:{...I.Km,minWidth:{xs:"100%",sm:150},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:N,"aria-label":"Close",children:"Close"})})]})},R=i.memo(D)},4074:(e,r,t)=>{t.d(r,{c:()=>f});var i=t(5043),a=t(3950),n=t.n(a),s=t(9472);const l="/api/v1/gates",o="Authentication required.",d="Gate ID is missing.",c="Gate name is missing.",u="Gate not found.",m="Status data is missing.",h="Username is missing.",b="Role is missing.",g="An error occurred.",v={MAX_CACHE_SIZE:10,CACHE_EXPIRY_MS:18e5,DEBOUNCE_MS:300,DEFAULT_LIMIT:50,CACHE_VERSION:"v1"};const p=new class{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return null;const{value:r,timestamp:t}=this.cache.get(e);return Date.now()-t>v.CACHE_EXPIRY_MS?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,{value:r,timestamp:t}),r)}set(e,r){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{value:r,timestamp:Date.now()})}clear(){this.cache.clear()}}(v.MAX_CACHE_SIZE),f=(e,r,t)=>{const[a,f]=(0,i.useState)([]),[x,w]=(0,i.useState)(null),[y,_]=(0,i.useState)([]),[A,j]=(0,i.useState)(null),[C,E]=(0,i.useState)({page:1,limit:v.DEFAULT_LIMIT,total:0,hasMore:!0}),[S,$]=(0,i.useState)(!1),[k,I]=(0,i.useState)(null),M=(0,i.useCallback)(((e,i)=>{if("AbortError"===e.name)return Promise.resolve(null);const a=e.status||500;401!==a&&403!==a||(r("Session expired. Please log in again."),t("/login"));const n=i||e.message||g;return I(n),Promise.reject(new Error(n))}),[r,t]),q=(0,i.useCallback)((function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{var r,t,i,a,n;return{member_id:(null===(r=e.user)||void 0===r?void 0:r.anonymous_id)||e.anonymous_id||"",username:(null===(t=e.user)||void 0===t?void 0:t.username)||"Unknown",role:e.role||"viewer",joined_at:e.joined_at||null,avatar:(null===(i=e.user)||void 0===i?void 0:i.avatar)||null,total_points:(null===(a=e.user)||void 0===a?void 0:a.total_points)||0,anonymous_id:(null===(n=e.user)||void 0===n?void 0:n.anonymous_id)||e.anonymous_id||""}}))}),[]),z=(0,i.useCallback)((function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{var r;return{class_id:e.class_id||"",name:e.name||"Untitled Class",description:e.description||"",gate_id:e.gate_id||"",creator_id:e.creator_id||"",visibility:e.visibility||"private",access:e.access||{is_public:!1},settings:e.settings||{},stats:{board_count:e.board_count||0,tweet_count:e.tweet_count||0,member_count:(null===(r=e.members)||void 0===r?void 0:r.length)||0},members:e.members||[],favorited_by:e.favorited_by||[],is_favorited:e.is_favorited||!1,tags:e.tags||[],status:e.status||"active",created_at:e.created_at||null,updated_at:e.updated_at||null}}))}),[]),L=(0,i.useCallback)((()=>{f([]),w(null),_([]),j(null),E({page:1,limit:v.DEFAULT_LIMIT,total:0,hasMore:!0}),I(null),p.clear()}),[]),P=(0,i.useCallback)((async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return M(new Error,o);const{page:a=1,limit:n=v.DEFAULT_LIMIT}=r,d=`${v.CACHE_VERSION}:gates:${JSON.stringify({...r,page:a,limit:n})}`,c=p.get(d);if(c&&!i)return f(c.gates||[]),E(c.pagination||{page:a,limit:n,total:0,hasMore:!0}),Promise.resolve(c);$(!0),I(null);try{var u,m,h;const o=await async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;if(!e)throw new Error("Token is required");try{return(await(0,s.Jt)(l,{headers:{Authorization:`Bearer ${e}`},params:r,signal:t instanceof AbortSignal?t:void 0})).data.content}catch(k){throw(0,s.hS)(k)}}(e,{...r,page:a,limit:n},t);if(!o)throw new Error("No data received");const c=o.gates||[];return f((e=>i?[...e,...c]:c)),E({page:(null===(u=o.pagination)||void 0===u?void 0:u.page)||a,limit:(null===(m=o.pagination)||void 0===m?void 0:m.limit)||n,total:(null===(h=o.pagination)||void 0===h?void 0:h.total)||0,hasMore:c.length===n}),p.set(d,o),Promise.resolve(o)}catch(b){return"AbortError"===b.name?Promise.resolve(null):M(b,g)}finally{$(!1)}}),[e,M]),D=(0,i.useMemo)((()=>n()(((e,r,t,i)=>{P(e,r,t).then((e=>i(null,e))).catch((e=>i(e,null)))}),v.DEBOUNCE_MS)),[P]),R=(0,i.useCallback)((async(r,t)=>{if(!e||null===r||void 0===r||!r.trim())return M(new Error,e?d:o);const i=`${v.CACHE_VERSION}:gate:${r}`,a=p.get(i);if(a)return w(a),_(q(a.members)),j(a.stats||null),Promise.resolve(a);$(!0),I(null);try{const a=await(async(e,r,t)=>{if(!e||!r)throw new Error("Gate ID and token are required");try{return(await(0,s.Jt)(`${l}/${e}`,{headers:{Authorization:`Bearer ${r}`},signal:t instanceof AbortSignal?t:void 0})).data.content}catch(k){throw(0,s.hS)(k)}})(r,e,t);if(!a)throw new Error("No gate data received");const n={...a,members:q(a.members||[]),classes:z(a.classes||[])};return w(n),_(n.members),j(a.stats||null),p.set(i,n),Promise.resolve(n)}catch(n){return"AbortError"===n.name?Promise.resolve(null):M(n,u)}finally{$(!1)}}),[e,M,q,z]),B=(0,i.useCallback)((async r=>{var t;if(!e||null===r||void 0===r||null===(t=r.name)||void 0===t||!t.trim())return M(new Error,e?c:o);$(!0),I(null);try{var i,a,n,d,u,m;const t=await(async(e,r)=>{if(!e||!r)throw new Error("Gate data and token are required");try{return(await(0,s.bE)(l,e,{headers:{Authorization:`Bearer ${r}`}})).data.content}catch(k){throw(0,s.hS)(k)}})({...r,is_public:null===(i=r.is_public)||void 0===i||i,visibility:r.visibility||(r.is_public?"public":"private"),settings:{class_creation_cost:(null===(a=r.settings)||void 0===a?void 0:a.class_creation_cost)||100,board_creation_cost:(null===(n=r.settings)||void 0===n?void 0:n.board_creation_cost)||50,max_members:(null===(d=r.settings)||void 0===d?void 0:d.max_members)||1e3,ai_moderation_enabled:null===(u=null===(m=r.settings)||void 0===m?void 0:m.ai_moderation_enabled)||void 0===u||u,...r.settings}},e);if(!t)throw new Error("Failed to create gate");return f((e=>[...e,t])),p.clear(),Promise.resolve(t)}catch(h){return M(h,g)}finally{$(!1)}}),[e,M]),F=(0,i.useCallback)((async(r,t)=>{var i;if(!e||null===r||void 0===r||!r.trim()||null===t||void 0===t||null===(i=t.name)||void 0===i||!i.trim())return M(new Error,e?r?c:d:o);$(!0),I(null);try{const{gate_id:i,...a}=t,n=await(async(e,r,t)=>{if(!e||!r||!t)throw new Error("Gate ID, data, and token are required");try{return(await(0,s.yJ)(`${l}/${e}`,r,{headers:{Authorization:`Bearer ${t}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,a,e);if(!n)throw new Error("Failed to update gate");return f((e=>e.map((e=>e.gate_id===r?n:e)))),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?n:e)),p.clear(),Promise.resolve(n)}catch(a){return M(a,g)}finally{$(!1)}}),[e,M]),G=(0,i.useCallback)((async(r,t)=>{if(!e||null===r||void 0===r||!r.trim()||!t)return M(new Error,e?r?m:d:o);$(!0),I(null);try{const i=await(async(e,r,t)=>{if(!e||!r||!t)throw new Error("Gate ID, status data, and token are required");try{return(await(0,s.yJ)(`${l}/${e}/status`,r,{headers:{Authorization:`Bearer ${t}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,t,e);if(!i)throw new Error("Failed to update gate status");return f((e=>e.map((e=>e.gate_id===r?i:e)))),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?i:e)),p.clear(),Promise.resolve(i)}catch(i){return M(i,g)}finally{$(!1)}}),[e,M]),T=(0,i.useCallback)((async r=>{if(!e||null===r||void 0===r||!r.trim())return M(new Error,e?d:o);$(!0),I(null);try{return await(async(e,r)=>{if(!e||!r)throw new Error("Gate ID and token are required");try{return(await(0,s.yH)(`${l}/${e}`,{headers:{Authorization:`Bearer ${r}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,e),f((e=>e.filter((e=>e.gate_id!==r)))),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?null:e)),p.clear(),Promise.resolve(!0)}catch(t){return M(t,g)}finally{$(!1)}}),[e,M]),N=(0,i.useCallback)((async(r,t)=>{let{username:i,role:a="viewer"}=t;if(!e||null===r||void 0===r||!r.trim()||null===i||void 0===i||!i.trim())return M(new Error,e?r?h:d:o);$(!0),I(null);try{const t=await(async(e,r,t)=>{if(!e||!r||!t)throw new Error("Gate ID, member data, and token are required");try{return(await(0,s.bE)(`${l}/${e}/members`,r,{headers:{Authorization:`Bearer ${t}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,{username:i,role:a},e);if(!t)throw new Error("Failed to add member");return _(q(t.members)),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?t:e)),f((e=>e.map((e=>e.gate_id===r?t:e)))),p.clear(),Promise.resolve(t)}catch(n){return M(n,g)}finally{$(!1)}}),[e,M,q]),U=(0,i.useCallback)((async(r,t)=>{if(!e||null===r||void 0===r||!r.trim()||null===t||void 0===t||!t.trim())return M(new Error,e?r?h:d:o);$(!0),I(null);try{const i=await(async(e,r,t)=>{if(!e||!r||!t)throw new Error("Gate ID, username, and token are required");try{return(await(0,s.yH)(`${l}/${e}/members/${encodeURIComponent(r)}`,{headers:{Authorization:`Bearer ${t}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,t,e);if(!i)throw new Error("Failed to remove member");return _(q(i.members)),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?i:e)),f((e=>e.map((e=>e.gate_id===r?i:e)))),p.clear(),Promise.resolve(i)}catch(i){return M(i,g)}finally{$(!1)}}),[e,M,q]),W=(0,i.useCallback)((async(r,t,i)=>{if(!e||null===r||void 0===r||!r.trim()||null===t||void 0===t||!t.trim()||null===i||void 0===i||!i.trim())return M(new Error,e?r?t?b:h:d:o);$(!0),I(null);try{const a=await(async(e,r,t,i)=>{if(!e||!r||!t||!i)throw new Error("Gate ID, username, data, and token are required");try{return(await(0,s.yJ)(`${l}/${e}/members/${encodeURIComponent(r)}`,t,{headers:{Authorization:`Bearer ${i}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,t,{role:i},e);if(!a)throw new Error("Failed to update member role");return _(q(a.members)),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?a:e)),f((e=>e.map((e=>e.gate_id===r?a:e)))),p.clear(),Promise.resolve(a)}catch(a){return M(a,g)}finally{$(!1)}}),[e,M,q]),V=(0,i.useCallback)((async(r,t)=>{if(!e||null===r||void 0===r||!r.trim())return M(new Error,e?d:o);$(!0),I(null);try{const i=await(async(e,r,t)=>{if(!e||!r)throw new Error("Gate ID and token are required");try{return(await(0,s.Jt)(`${l}/${e}/members`,{headers:{Authorization:`Bearer ${r}`},signal:t instanceof AbortSignal?t:void 0})).data.content}catch(k){throw(0,s.hS)(k)}})(r,e,t);if(!i)throw new Error("No members data received");return _(q(i.members)),Promise.resolve(i)}catch(i){return"AbortError"===i.name?Promise.resolve(null):M(i,g)}finally{$(!1)}}),[e,M,q]),O=(0,i.useCallback)((async(r,t)=>{if(!e||null===r||void 0===r||!r.trim())return M(new Error,e?d:o);$(!0),I(null);try{const i=t?await(async(e,r)=>{if(!e||!r)throw new Error("Gate ID and token are required");try{return(await(0,s.bE)(`${l}/${e}/unfavorite`,{},{headers:{Authorization:`Bearer ${r}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,e):await(async(e,r)=>{if(!e||!r)throw new Error("Gate ID and token are required");try{return(await(0,s.bE)(`${l}/${e}/favorite`,{},{headers:{Authorization:`Bearer ${r}`}})).data.content}catch(k){throw(0,s.hS)(k)}})(r,e);if(!i)throw new Error("Failed to toggle favorite status");return f((e=>e.map((e=>e.gate_id===r?i:e)))),w((e=>(null===e||void 0===e?void 0:e.gate_id)===r?i:e)),p.clear(),Promise.resolve(i)}catch(i){return M(i,g)}finally{$(!1)}}),[e,M]);return(0,i.useEffect)((()=>{if(!e)return void L();const r=new AbortController;return D({},r.signal,!1,((e,r)=>{e&&"AbortError"!==e.name&&I(e.message||g)})),()=>{r.abort(),D.cancel()}}),[e,L,D]),(0,i.useMemo)((()=>({gates:a,gate:x,members:y,stats:A,pagination:C,loading:S,error:k,fetchGatesList:D,fetchGate:R,createNewGate:B,updateExistingGate:F,updateGateStatusById:G,deleteExistingGate:T,addMemberToGate:N,removeMemberFromGate:U,updateMemberRole:W,fetchGateMembersList:V,toggleFavoriteGate:O,resetState:L})),[a,x,y,A,C,S,k,D,R,B,F,G,T,N,U,W,V,O,L])}},4834:(e,r,t)=>{t.d(r,{j:()=>i,l:()=>a});const i=(e,r,t)=>{const i=[];return!t.required||null!==r&&void 0!==r&&r.toString().trim()||i.push(`${e} is required.`),t.minLength&&r.length<t.minLength&&i.push(`${e} must be at least ${t.minLength} characters long.`),t.maxLength&&r.length>t.maxLength&&i.push(`${e} cannot exceed ${t.maxLength} characters.`),t.minValue&&Number(r)<t.minValue&&i.push(`${e} must be at least ${t.minValue}.`),t.maxValue&&Number(r)>t.maxValue&&i.push(`${e} cannot exceed ${t.maxValue}.`),t.validRoles&&!t.validRoles.includes(r)&&i.push(`${e} must be one of: ${t.validRoles.join(", ")}.`),i},a=e=>{const r={};return Object.entries(e).forEach((e=>{let[t,{value:a,rules:n}]=e;const s=i(t,a,n);s.length>0&&(r[t]=s[0])})),r}},7331:(e,r,t)=>{t.d(r,{A:()=>j});var i=t(5043),a=t(6240),n=t(35),s=t(6600),l=t(5316),o=t(7353),d=t(9392),c=t(7784),u=t(3193),m=t(9190),h=t(2221),b=t(2143),g=t(1673),v=t(4605),p=t(7843),f=t(9347),x=t(1906),w=t(4834),y=t(6552),_=t(579);const A=e=>{var r,t,A,j;let{open:C,title:E,board:S,setBoard:$,onSave:k,onCancel:I,disabled:M,gates:q=[],classes:z=[],currentClass:L,initialClassId:P,fixedClassId:D,fixedGateId:R}=e;const B=(0,a.A)(),[F,G]=(0,i.useState)({}),T=(0,i.useRef)(null);(0,i.useEffect)((()=>{C&&T.current&&T.current.focus()}),[C]),(0,i.useEffect)((()=>{C&&$((e=>{const r={...e};return D?r.class_id=D:!L||e.class_id||e.gate_id||(r.class_id=P||L.class_id||null),void 0!==R?r.gate_id=R:!L||e.gate_id||D||(r.gate_id=e.class_id===L.class_id?L.gate_id:null),r}))}),[C,L,P,D,R,$]);const N=(0,i.useMemo)((()=>{if(D)return z.filter((e=>e.class_id===D));if(!S.gate_id&&!R)return z;const e=void 0!==R?R:S.gate_id;return z.filter((r=>r.gate_id===e||!r.gate_id))}),[S.gate_id,z,D,R]),U=(0,i.useMemo)((()=>{if(void 0!==R)return!0;if(!S.class_id)return!1;return!!z.find((e=>e.class_id===S.class_id))}),[S.class_id,z,R]),W=(0,i.useMemo)((()=>!!D||!(!S.gate_id&&void 0===R)&&0===N.length),[S.gate_id,N,D,R]),V=(0,i.useMemo)((()=>{var e,r,t,i;return{name:{value:S.name||"",rules:{required:!0,minLength:3,maxLength:100}},description:{value:S.description||"",rules:{maxLength:1e3}},visibility:{value:S.visibility||"private",rules:{required:!0,enum:["public","private"]}},type:{value:S.type||"personal",rules:{required:!0,enum:["personal","group"]}},class_id:{value:S.class_id||"",rules:{required:"public"===S.visibility&&!S.gate_id&&z.length>0&&!D}},gate_id:{value:S.gate_id||"",rules:{required:"public"===S.visibility&&!S.class_id&&q.length>0&&void 0===R}},"settings.max_tweets":{value:(null===(e=S.settings)||void 0===e?void 0:e.max_tweets)||100,rules:{required:!0,minValue:1,maxValue:1e4}},"settings.tweet_cost":{value:(null===(r=S.settings)||void 0===r?void 0:r.tweet_cost)||1,rules:{required:!0,minValue:0}},"settings.max_members":{value:(null===(t=S.settings)||void 0===t?void 0:t.max_members)||50,rules:{required:!0,minValue:1,maxValue:1e4}},"settings.ai_moderation_enabled":{value:(null===(i=S.settings)||void 0===i?void 0:i.ai_moderation_enabled)||!1,rules:{}}}}),[S,q,z,D,R]),O=(0,i.useCallback)((e=>{var r;const{name:t,value:i,type:a,checked:n}=e.target;let s="checkbox"===a?n:i;if("class_id"===t&&D||"gate_id"===t&&void 0!==R)return;if("gate_id"!==t&&"class_id"!==t||(s=i||null),t.startsWith("settings.")){const e=t.split(".")[1];s="ai_moderation_enabled"===e?s:Number(s)||0,$((r=>({...r,settings:{...r.settings,[e]:s}})))}else $((e=>{const r={...e,[t]:s,is_public:"visibility"===t?"public"===i:e.is_public};if("class_id"===t&&z.length>0&&!R){const e=z.find((e=>e.class_id===s));r.gate_id=(null===e||void 0===e?void 0:e.gate_id)||null}if("gate_id"===t&&s&&!D){if(0===z.filter((e=>e.gate_id===s||!e.gate_id)).length)r.class_id=null;else if(e.class_id){const t=z.find((r=>r.class_id===e.class_id));null!==t&&void 0!==t&&t.gate_id&&t.gate_id!==s&&(r.class_id=null)}}return r}));const l=(null===(r=V[t])||void 0===r?void 0:r.rules)||{},o=(0,w.j)(t,s,l,{visibility:"visibility"===t?i:S.visibility,class_id:"class_id"===t?s:S.class_id,gate_id:"gate_id"===t?s:S.gate_id});G((e=>({...e,[t]:o[0]||null,gate_id:(0,w.j)("gate_id","gate_id"===t?s:S.gate_id,V.gate_id.rules,{visibility:"visibility"===t?i:S.visibility,class_id:"class_id"===t?s:S.class_id})[0]||null,class_id:(0,w.j)("class_id","class_id"===t?s:S.class_id,V.class_id.rules,{visibility:"visibility"===t?i:S.visibility,gate_id:"gate_id"===t?s:S.gate_id})[0]||null})))}),[$,S,V,z,D,R]),J=(0,i.useCallback)((()=>{const e=(0,w.l)(V);Object.keys(e).length>0?G(e):k()}),[k,V]);return(0,_.jsxs)(n.A,{open:C,onClose:I,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:B.shape.borderRadiusMedium,p:{xs:2,md:3}}},"aria-labelledby":"board-form-dialog-title","aria-describedby":"board-form-dialog-description",children:[(0,_.jsx)(s.A,{id:"board-form-dialog-title",sx:{fontSize:{xs:"1.25rem",md:"1.5rem"}},children:E}),(0,_.jsx)(l.A,{children:(0,_.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",gap:{xs:2,md:3},mt:2},children:[(0,_.jsx)(d.A,{title:"Enter a unique name for the board",placement:"right",children:(0,_.jsx)(c.A,{label:"Board Name",name:"name",value:S.name||"",onChange:O,fullWidth:!0,required:!0,error:!!F.name,helperText:F.name,sx:{...y.z9,mt:0},disabled:M,inputProps:{maxLength:100},inputRef:T,"aria-label":"Board name","aria-describedby":"name-tooltip"})}),(0,_.jsx)(d.A,{title:"Provide a description of the board's purpose",placement:"right",children:(0,_.jsx)(c.A,{label:"Description",name:"description",value:S.description||"",onChange:O,fullWidth:!0,multiline:!0,rows:4,error:!!F.description,helperText:F.description,sx:{...y.z9,mt:0},disabled:M,inputProps:{maxLength:1e3},"aria-label":"Board description","aria-describedby":"description-tooltip"})}),(0,_.jsx)(d.A,{title:"Public boards are visible to everyone; private boards are restricted to members",placement:"right",children:(0,_.jsxs)(u.A,{fullWidth:!0,error:!!F.visibility,disabled:M,sx:{...y.p5,mt:0},children:[(0,_.jsx)(m.A,{id:"visibility-label",children:"Visibility"}),(0,_.jsxs)(h.A,{labelId:"visibility-label",name:"visibility",value:S.visibility||"private",onChange:O,label:"Visibility","aria-label":"Board visibility","aria-describedby":"visibility-tooltip",children:[(0,_.jsx)(b.A,{value:"public",children:"Public"}),(0,_.jsx)(b.A,{value:"private",children:"Private"})]}),F.visibility&&(0,_.jsx)(g.A,{children:F.visibility})]})}),(0,_.jsx)(d.A,{title:"Personal boards are managed by individuals; group boards allow collaboration",placement:"right",children:(0,_.jsxs)(u.A,{fullWidth:!0,error:!!F.type,disabled:M,sx:{...y.p5,mt:0},children:[(0,_.jsx)(m.A,{id:"type-label",children:"Type"}),(0,_.jsxs)(h.A,{labelId:"type-label",name:"type",value:S.type||"personal",onChange:O,label:"Type","aria-label":"Board type","aria-describedby":"type-tooltip",children:[(0,_.jsx)(b.A,{value:"personal",children:"Personal"}),(0,_.jsx)(b.A,{value:"group",children:"Group"})]}),F.type&&(0,_.jsx)(g.A,{children:F.type})]})}),"public"===S.visibility&&(0,_.jsxs)(_.Fragment,{children:[z.length>0&&(0,_.jsx)(d.A,{title:D?"Class is fixed for this board":"Select a class to associate the board; required if no gate is selected",placement:"right",children:(0,_.jsxs)(u.A,{fullWidth:!0,error:!!F.class_id,disabled:M||W,sx:{...y.p5,mt:0},children:[(0,_.jsx)(m.A,{id:"class-label",children:"Class"}),(0,_.jsxs)(h.A,{labelId:"class-label",name:"class_id",value:S.class_id||"",onChange:O,label:"Class","aria-label":"Select class for public board","aria-describedby":"class-tooltip",children:[(0,_.jsx)(b.A,{value:"",children:"None"}),N.map((e=>(0,_.jsx)(b.A,{value:e.class_id,children:e.name},e.class_id)))]}),F.class_id&&(0,_.jsx)(g.A,{children:F.class_id})]})}),q.length>0&&(0,_.jsx)(d.A,{title:void 0!==R?"Gate is fixed for this board":"Select a gate to restrict access; disabled if a class is selected",placement:"right",children:(0,_.jsxs)(u.A,{fullWidth:!0,error:!!F.gate_id,disabled:M||U,sx:{...y.p5,mt:0},children:[(0,_.jsx)(m.A,{id:"gate-label",children:"Gate"}),(0,_.jsxs)(h.A,{labelId:"gate-label",name:"gate_id",value:S.gate_id||"",onChange:O,label:"Gate","aria-label":"Select gate for public board","aria-describedby":"gate-tooltip",children:[(0,_.jsx)(b.A,{value:"",children:"None"}),q.map((e=>(0,_.jsx)(b.A,{value:e.gate_id,children:e.name},e.gate_id)))]}),F.gate_id&&(0,_.jsx)(g.A,{children:F.gate_id})]})})]}),(0,_.jsx)(d.A,{title:"Maximum number of tweets allowed on the board",placement:"right",children:(0,_.jsx)(c.A,{label:"Max Tweets",name:"settings.max_tweets",type:"number",value:(null===(r=S.settings)||void 0===r?void 0:r.max_tweets)||100,onChange:O,fullWidth:!0,required:!0,error:!!F["settings.max_tweets"],helperText:F["settings.max_tweets"],sx:{...y.z9,mt:0},disabled:M,inputProps:{min:1,max:1e4},"aria-label":"Maximum tweets","aria-describedby":"max-tweets-tooltip"})}),(0,_.jsx)(d.A,{title:"Points required to post a tweet on the board",placement:"right",children:(0,_.jsx)(c.A,{label:"Tweet Cost",name:"settings.tweet_cost",type:"number",value:(null===(t=S.settings)||void 0===t?void 0:t.tweet_cost)||1,onChange:O,fullWidth:!0,required:!0,error:!!F["settings.tweet_cost"],helperText:F["settings.tweet_cost"],sx:{...y.z9,mt:0},disabled:M,inputProps:{min:0},"aria-label":"Tweet creation cost","aria-describedby":"tweet-cost-tooltip"})}),(0,_.jsx)(d.A,{title:"Maximum number of members allowed on the board",placement:"right",children:(0,_.jsx)(c.A,{label:"Max Members",name:"settings.max_members",type:"number",value:(null===(A=S.settings)||void 0===A?void 0:A.max_members)||50,onChange:O,fullWidth:!0,required:!0,error:!!F["settings.max_members"],helperText:F["settings.max_members"],sx:{...y.z9,mt:0},disabled:M,inputProps:{min:1,max:1e4},"aria-label":"Maximum members","aria-describedby":"max-members-tooltip"})}),(0,_.jsx)(d.A,{title:"Enable AI to automatically moderate content on the board",placement:"right",children:(0,_.jsx)(v.A,{control:(0,_.jsx)(p.A,{checked:(null===(j=S.settings)||void 0===j?void 0:j.ai_moderation_enabled)||!1,onChange:O,name:"settings.ai_moderation_enabled",disabled:M,"aria-label":"Enable AI moderation","aria-describedby":"ai-moderation-tooltip"}),label:"Enable AI Moderation",sx:{color:"text.primary"}})})]})}),(0,_.jsxs)(f.A,{children:[(0,_.jsx)(x.A,{onClick:I,sx:{...y.Km,minWidth:{xs:"100%",sm:150},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:M,"aria-label":"Cancel board form",children:"Cancel"}),(0,_.jsx)(x.A,{onClick:J,sx:{...y.nT,minWidth:{xs:"100%",sm:150},fontSize:{xs:"0.75rem",sm:"0.875rem"}},disabled:M,"aria-label":"Save board form",children:"Save"})]})]})};A.defaultProps={gates:[],classes:[],currentClass:null,fixedClassId:null,fixedGateId:void 0};const j=i.memo(A)},9406:(e,r,t)=>{t.d(r,{F:()=>s});var i=t(5043),a=t(9472);const n="/api/v1/social/friends",s=(e,r,t)=>{const[s,l]=(0,i.useState)([]),[o,d]=(0,i.useState)([]),[c,u]=(0,i.useState)({}),[m,h]=(0,i.useState)({}),[b,g]=(0,i.useState)(!1),[v,p]=(0,i.useState)(null),f=(0,i.useCallback)((e=>{401!==e.status&&403!==e.status||(r("Session expired. Please log in again."),t("/login")),p(e.message||"Authentication error")}),[r,t]),x=(0,i.useCallback)((async function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:10};if(!e||!r.trim())return p("Authentication or username missing"),[];g(!0),p(null);try{const i=await async function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{page:1,limit:10};if(!e||"string"!==typeof e||!e.trim())throw new Error("Username is required");if(!r||"string"!==typeof r||!r.trim())throw new Error("Token is required");try{const{page:i,limit:n}=t;return(await(0,a.Jt)("/api/v1/social/users/search",{headers:{Authorization:`Bearer ${r}`},params:{username:e,page:i,limit:n}})).data.content||{users:[],pagination:{}}}catch(v){throw(0,a.hS)(v)}}(r,e,t);return i.users||[]}catch(i){return f(i),[]}finally{g(!1)}}),[e,f]),w=(0,i.useCallback)((async r=>{if(!e||!r)return p("Authentication or friend ID missing"),null;g(!0),p(null);try{const t=await(async(e,r)=>{if(!e||"string"!==typeof e||!e.trim())throw new Error("Friend ID is required");if(!r||"string"!==typeof r||!r.trim())throw new Error("Token is required");try{return(await(0,a.bE)(`${n}/add`,{friendId:e},{headers:{Authorization:`Bearer ${r}`}})).data.content||{}}catch(v){throw(0,a.hS)(v)}})(r,e);return t}catch(t){throw f(t),t}finally{g(!1)}}),[e,f]),y=(0,i.useCallback)((async r=>{if(!e||!r)return p("Authentication or friend ID missing"),null;g(!0),p(null);try{const t=await(async(e,r)=>{if(!e||"string"!==typeof e||!e.trim())throw new Error("Friend ID is required");if(!r||"string"!==typeof r||!r.trim())throw new Error("Token is required");try{return(await(0,a.bE)(`${n}/accept`,{friendId:e},{headers:{Authorization:`Bearer ${r}`}})).data.content||{}}catch(v){throw(0,a.hS)(v)}})(r,e);return t}catch(t){throw f(t),t}finally{g(!1)}}),[e,f]),_=(0,i.useCallback)((async r=>{if(!e||!r)return p("Authentication or friend ID missing"),null;g(!0),p(null);try{const t=await(async(e,r)=>{if(!e||"string"!==typeof e||!e.trim())throw new Error("Friend ID is required");if(!r||"string"!==typeof r||!r.trim())throw new Error("Token is required");try{return(await(0,a.bE)(`${n}/reject`,{friendId:e},{headers:{Authorization:`Bearer ${r}`}})).data.content||{}}catch(v){throw(0,a.hS)(v)}})(r,e);return t}catch(t){throw f(t),t}finally{g(!1)}}),[e,f]),A=(0,i.useCallback)((async r=>{if(!e||!r)return p("Authentication or friend ID missing"),null;g(!0),p(null);try{const t=await(async(e,r)=>{if(!e||"string"!==typeof e||!e.trim())throw new Error("Friend ID is required");if(!r||"string"!==typeof r||!r.trim())throw new Error("Token is required");try{return(await(0,a.bE)(`${n}/remove`,{friendId:e},{headers:{Authorization:`Bearer ${r}`}})).data.content||{}}catch(v){throw(0,a.hS)(v)}})(r,e);return t}catch(t){throw f(t),t}finally{g(!1)}}),[e,f]),j=(0,i.useCallback)((async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1,limit:20},t=arguments.length>1?arguments[1]:void 0;if(!e)return p("Authentication required"),[];g(!0),p(null);try{const i=await async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{page:1,limit:20},t=arguments.length>2?arguments[2]:void 0;if(!e||"string"!==typeof e||!e.trim())throw new Error("Token is required");try{const{page:i,limit:s}=r;return(await(0,a.Jt)(n,{headers:{Authorization:`Bearer ${e}`},params:{page:i,limit:s},signal:t instanceof AbortSignal?t:void 0})).data.content||{friends:[],pagination:{}}}catch(v){throw(0,a.hS)(v)}}(e,r,t);return l((e=>{const r=i.friends||[];return JSON.stringify(r)===JSON.stringify(e)?e:r})),u(i.pagination||{}),i.friends}catch(i){return"AbortError"!==i.name&&f(i),[]}finally{g(!1)}}),[e,f]),C=(0,i.useCallback)((async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1,limit:20},t=arguments.length>1?arguments[1]:void 0;if(!e)return p("Authentication required"),[];g(!0),p(null);try{const i=await async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{page:1,limit:20},t=arguments.length>2?arguments[2]:void 0;if(!e||"string"!==typeof e||!e.trim())throw new Error("Token is required");try{const{page:i,limit:s}=r;return(await(0,a.Jt)(`${n}/pending`,{headers:{Authorization:`Bearer ${e}`},params:{page:i,limit:s},signal:t instanceof AbortSignal?t:void 0})).data.content||{pendingRequests:[],pagination:{}}}catch(v){throw(0,a.hS)(v)}}(e,r,t);return d(i.pendingRequests||[]),h(i.pagination||{}),i.pendingRequests}catch(i){return"AbortError"!==i.name&&f(i),[]}finally{g(!1)}}),[e,f]);return{friends:s,pendingRequests:o,friendsPagination:c,pendingPagination:m,loading:b,error:v,addNewFriend:w,acceptFriend:y,rejectFriend:_,removeExistingFriend:A,getFriends:j,getPendingRequests:C,searchUsersByUsername:x}}}}]);
//# sourceMappingURL=714.efd3c30b.chunk.js.map