"use strict";(self.webpackChunkgate_from_nothingproject_front_end=self.webpackChunkgate_from_nothingproject_front_end||[]).push([[133],{133:(e,a,t)=>{t.r(a),t.d(a,{default:()=>E});var l=t(5043),s=t(1675),i=t(3637),o=t(1007),r=t(5155),n=t(1407),d=t(9320),c=t(141),u=t(3536),m=t(8738),v=t(3769),g=t(9020),b=t(5701),f=t(8800),p=t(3807),h=t(342),C=t(4074),y=t(1067),M=t(3835),_=t(1654),k=t(4205),x=t(6411),F=t(2334),w=t(579);const A=e=>{let{children:a}=e;const[t,s]=(0,l.useState)(!1);(0,l.useCallback)(((e,a)=>{console.error("ErrorBoundary caught:",e,a),s(!0)}),[]);return t?(0,w.jsx)("div",{children:"Something went wrong. Please try again later."}):a},I=()=>{var e,a;const t=(0,s.Zp)(),I=(0,s.zy)(),{gate_id:E}=(0,s.g)(),{showNotification:S}=(0,_.h)(),{token:j,authData:G,handleLogout:D,isAuthenticated:L,loading:O}=(0,h.A)(),{gate:R,members:T,stats:$,gates:Q,fetchGate:U,fetchGateMembersList:P,updateExistingGate:q,deleteExistingGate:N,addMemberToGate:Z,removeMemberFromGate:B,updateMemberRole:K,toggleFavoriteGate:H,loading:W,error:z}=(0,C.c)(j,D,t,!0),{classes:J,pagination:V,fetchClassesByGate:X,createNewClass:Y,updateExistingClass:ee,deleteExistingClass:ae,toggleFavoriteClass:te,addMemberToClass:le,removeMemberFromClass:se,updateMemberRole:ie,loading:oe,error:re}=(0,y.g)(j,D,t,!0),[ne,de]=(0,l.useState)(!1),[ce,ue]=(0,l.useState)(!1),[me,ve]=(0,l.useState)(!1),[ge,be]=(0,l.useState)(!1),[fe,pe]=(0,l.useState)(!1),[he,Ce]=(0,l.useState)(!1),[ye,Me]=(0,l.useState)(!1),[_e,ke]=(0,l.useState)(null),[xe,Fe]=(0,l.useState)(null),[we,Ae]=(0,l.useState)(null),[Ie,Ee]=(0,l.useState)(null),[Se,je]=(0,l.useState)({...x.Z6,gate_id:E}),[Ge,De]=(0,l.useState)("all"),[Le,Oe]=(0,l.useState)(""),Re=(0,l.useRef)(),Te=(0,l.useCallback)((e=>{!oe&&V.hasMore&&(Re.current&&Re.current.disconnect(),Re.current=new IntersectionObserver((e=>{if(e[0].isIntersecting&&V.hasMore){const e=new AbortController;return X(E,{visibility:"all"===Ge?void 0:Ge,page:V.page+1},e.signal,!0,(e=>{e&&"AbortError"!==e.name&&S(e.message||"Failed to load more classes","error")})),()=>e.abort()}})),e&&Re.current.observe(e))}),[oe,V.hasMore,V.page,Ge,E,X,S]),$e=(0,l.useMemo)((()=>(0,u.debounce)((e=>Oe(e)),300)),[]),Qe=(0,l.useMemo)((()=>[e=>U(E,e,(e=>{e&&"AbortError"!==e.name&&S(e.message||"Failed to fetch gate","error")})),e=>P(E,e,(e=>{e&&"AbortError"!==e.name&&S(e.message||"Failed to fetch gate members","error")})),e=>X(E,{page:1,limit:V.limit},e,!1,(e=>{e&&"AbortError"!==e.name&&S(e.message||"Failed to fetch classes","error")}))]),[U,P,X,E,V.limit,S]),{isLoading:Ue,actionLoading:Pe,setActionLoading:qe}=(0,M.t)(Qe,j,D,t,"gate");(0,l.useEffect)((()=>{null!==E&&void 0!==E&&E.trim()||(S("Invalid gate ID","error"),t("/gates"))}),[E,t,S]),(0,l.useEffect)((()=>{[z,re].filter(Boolean).forEach((e=>{e&&"canceled"!==e&&S(e,"error")}))}),[z,re,S]),(0,l.useEffect)((()=>{!Ie&&fe&&pe(!1),!_e&&ce&&ue(!1)}),[Ie,fe,_e,ce]);const Ne=(0,l.useMemo)((()=>(0,k.w)(J||[],"classes",Ge,Le,Q||[],[{gate_id:E}])),[J,Q,Ge,Le,E]),Ze=(0,l.useMemo)((()=>{var e;return(null===T||void 0===T||null===(e=T.find((e=>e.anonymous_id===(null===G||void 0===G?void 0:G.anonymous_id))))||void 0===e?void 0:e.role)||"none"}),[T,G]),Be=(null===R||void 0===R?void 0:R.creator_id)===(null===G||void 0===G?void 0:G.anonymous_id),Ke=Be||"admin"===Ze,He=Be,We=(null===R||void 0===R||null===(e=R.access)||void 0===e?void 0:e.is_public)||"viewer"!==Ze,ze=(0,l.useCallback)((()=>de(!0)),[]),Je=(0,l.useCallback)((()=>{de(!1),je({...x.Z6,gate_id:E})}),[E]),Ve=(0,l.useCallback)((async()=>{var e;if(null!==(e=Se.name)&&void 0!==e&&e.trim()){qe(!0);try{const e=await Y({...Se,gate_id:E});de(!1),je({...x.Z6,gate_id:E}),S("Class created successfully!","success"),t(`/class/${e.class_id}`)}catch(a){S(a.message||"Failed to create class","error")}finally{qe(!1)}}else S("Class name is required!","error")}),[Se,Y,E,t,S,qe]),Xe=(0,l.useCallback)((async()=>{var e;if(null!==_e&&void 0!==_e&&null!==(e=_e.name)&&void 0!==e&&e.trim()){qe(!0);try{await ee(_e.class_id,_e),ue(!1),ke(null),S("Class updated successfully!","success")}catch(a){S(a.message||"Failed to update class","error")}finally{qe(!1)}}else S("Class name is required!","error")}),[_e,ee,S,qe]),Ye=(0,l.useCallback)((async()=>{if(xe){qe(!0);try{await ae(xe),ve(!1),Fe(null),S("Class deleted successfully!","success")}catch(e){S(e.message||"Failed to delete class","error")}finally{qe(!1)}}}),[xe,ae,S,qe]),ea=(0,l.useCallback)((async()=>{var e;if(null!==Ie&&void 0!==Ie&&null!==(e=Ie.name)&&void 0!==e&&e.trim()){qe(!0);try{await q(Ie.gate_id,Ie),pe(!1),Ee(null),S("Gate updated successfully!","success")}catch(a){S(a.message||"Failed to update gate","error")}finally{qe(!1)}}else S("Gate name is required!","error")}),[Ie,q,S,qe]),aa=(0,l.useCallback)((async()=>{qe(!0);try{await N(E),Ce(!1),S("Gate deleted successfully!","success"),t("/gates")}catch(e){S(e.message||"Failed to delete gate","error")}finally{qe(!1)}}),[E,N,t,S,qe]),ta=(0,l.useCallback)((async()=>{qe(!0);try{await H(E,null===R||void 0===R?void 0:R.is_favorited),S(null!==R&&void 0!==R&&R.is_favorited?"Gate removed from favorites!":"Gate added to favorites!","success")}catch(e){S(e.message||"Failed to toggle favorite","error")}finally{qe(!1)}}),[E,R,H,S,qe]),la=(0,l.useCallback)((async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];qe(!0);try{var l,s;const i=t?J.find((a=>a.class_id===e)):{members:T,settings:null===R||void 0===R?void 0:R.settings};if((null===i||void 0===i||null===(l=i.members)||void 0===l?void 0:l.length)>=(null===i||void 0===i||null===(s=i.settings)||void 0===s?void 0:s.max_members))return void S("Maximum member limit reached!","error");await(t?le:Z)(e,a),S("Member added successfully!","success")}catch(i){S(i.message||"Failed to add member","error")}finally{qe(!1)}}),[le,Z,J,T,R,S,qe]),sa=(0,l.useCallback)((async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];qe(!0);try{await(t?se:B)(e,a),S("Member removed successfully!","success")}catch(l){S(l.message||"Failed to remove member","error")}finally{qe(!1)}}),[se,B,S,qe]),ia=(0,l.useCallback)((async function(e,a,t){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];qe(!0);try{await(l?ie:K)(e,a,t),S("Member role updated successfully!","success")}catch(s){S(s.message||"Failed to update member role","error")}finally{qe(!1)}}),[ie,K,S,qe]),oa=(0,l.useCallback)((e=>{Ae(e),be(!0)}),[]),ra=(0,l.useCallback)((()=>{Me(!0)}),[]),na=(0,l.useCallback)((function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(be(!1),Ae(null)):Me(!1),S("Members updated successfully!","success")}),[S]),da=(0,l.useCallback)((()=>{be(!1),Ae(null)}),[]),ca=(0,l.useCallback)((()=>{Me(!1)}),[]),ua=(0,l.useCallback)((()=>{De("all"),Oe(""),$e.cancel();const e=new AbortController;return X(E,{page:1,reset:{visibility:!0}},e.signal,!1,(e=>{e&&"AbortError"!==e.name&&S(e.message||"Failed to reset filters","error")})),()=>e.abort()}),[$e,X,E,S]),ma=(0,l.useMemo)((()=>{var e,a,t,l,s,u;return{type:"gate",title:(null===R||void 0===R?void 0:R.name)||"Untitled Gate",titleAriaLabel:`Gate name: ${(null===R||void 0===R?void 0:R.name)||"Untitled Gate"}`,description:(null===R||void 0===R?void 0:R.description)||"No description provided",descriptionAriaLabel:null!==R&&void 0!==R&&R.description?`Gate description: ${R.description}`:void 0,chips:[{label:null!==R&&void 0!==R&&null!==(e=R.access)&&void 0!==e&&e.is_public?"Public":"Private",icon:null!==R&&void 0!==R&&null!==(a=R.access)&&void 0!==a&&a.is_public?(0,w.jsx)(i.A,{}):(0,w.jsx)(o.A,{}),color:null!==R&&void 0!==R&&null!==(t=R.access)&&void 0!==t&&t.is_public?"success":"default",ariaLabel:null!==R&&void 0!==R&&null!==(l=R.access)&&void 0!==l&&l.is_public?"Public gate":"Private gate"},{label:`Members: ${(null===$||void 0===$?void 0:$.member_count)||(null===T||void 0===T?void 0:T.length)||0}`,icon:(0,w.jsx)(r.A,{}),color:"primary",ariaLabel:`Members: ${(null===$||void 0===$?void 0:$.member_count)||(null===T||void 0===T?void 0:T.length)||0}`},{label:`Classes: ${(null===Ne||void 0===Ne?void 0:Ne.length)||0}`,icon:(0,w.jsx)(n.A,{}),color:"info",ariaLabel:`Classes: ${(null===Ne||void 0===Ne?void 0:Ne.length)||0}`},{label:`Favorites: ${(null===$||void 0===$?void 0:$.favorite_count)||0}`,icon:(0,w.jsx)(d.A,{}),color:"warning",ariaLabel:`Favorites: ${(null===$||void 0===$?void 0:$.favorite_count)||0}`},{label:`Owner: ${(null===R||void 0===R||null===(s=R.creator)||void 0===s?void 0:s.username)||"Unknown"}`,ariaLabel:`Owner: ${(null===R||void 0===R||null===(u=R.creator)||void 0===u?void 0:u.username)||"Unknown"}`}],actions:[{label:"Create Class",icon:(0,w.jsx)(c.A,{}),onClick:ze,tooltip:"Create a new class within this gate",disabled:Pe||W||oe||!We,ariaLabel:"Create a new class"},{label:"Edit Gate",onClick:()=>{var e,a;Ee({gate_id:null===R||void 0===R?void 0:R.gate_id,name:(null===R||void 0===R?void 0:R.name)||"",description:(null===R||void 0===R?void 0:R.description)||"",is_public:(null===R||void 0===R||null===(e=R.access)||void 0===e?void 0:e.is_public)||!1,visibility:null!==R&&void 0!==R&&null!==(a=R.access)&&void 0!==a&&a.is_public?"public":"private",settings:(null===R||void 0===R?void 0:R.settings)||{class_creation_cost:100,board_creation_cost:50,max_members:1e3,ai_moderation_enabled:!0}}),pe(!0)},tooltip:"Edit gate details and settings",disabled:Pe||!Ke,ariaLabel:"Edit gate",isMenuItem:!0},{label:"Manage Members",onClick:ra,tooltip:"Manage gate members",disabled:Pe||!Ke,ariaLabel:"Manage gate members",isMenuItem:!0},{label:"Delete Gate",onClick:()=>Ce(!0),tooltip:"Permanently delete this gate",disabled:Pe||!He,ariaLabel:"Delete gate",variant:"delete",isMenuItem:!0}].filter((e=>"Create Class"!==e.label||We)),isFavorited:(null===R||void 0===R?void 0:R.is_favorited)||!1,onFavoriteToggle:ta,actionLoading:Pe}}),[R,$,T,Ne,Ke,He,We,Pe,W,oe,ze,ra,ta]);return O||Ue?(0,w.jsx)(m.A,{currentUser:G,onLogout:D,token:j,children:(0,w.jsx)(f.A,{})}):L?!R&&z&&"canceled"!==z?(S("Gate not found or failed to load","error"),t("/gates"),null):(0,w.jsx)(A,{children:(0,w.jsxs)(m.A,{currentUser:G,onLogout:D,token:j,children:[(0,w.jsx)(v.A,{user:G,isOwnProfile:!0,headerData:ma,userRole:Ze}),(0,w.jsx)(g.A,{type:"classes",items:Ne,cardComponent:p.A,itemKey:"class_id",quickFilter:Ge,setQuickFilter:De,searchQuery:Le,setSearchQuery:$e,filterOptions:F.jW,onResetFilters:ua,handleFavorite:te,setEditingItem:e=>{ke(e),ue(!0)},setItemToDelete:Fe,setDeleteDialogOpen:ve,handleManageMembers:oa,navigate:t,currentUser:G,token:j,onCreateNew:We?ze:null,lastItemRef:Te,hasMore:V.hasMore,loading:oe,disabled:Pe||W||oe}),(0,w.jsx)(b.A,{type:"classes",createOpen:ne,editOpen:ce,deleteOpen:me,memberOpen:ge,item:Se,setItem:je,editingItem:_e,setEditingItem:ke,itemToDelete:xe,setItemToDelete:Fe,onSaveCreate:Ve,onSaveEdit:Xe,onCancelCreate:Je,onCancelEdit:()=>{ue(!1),ke(null)},onConfirmDelete:Ye,onCloseDelete:()=>{ve(!1),Fe(null)},selectedId:we,members:(null===(a=J.find((e=>e.class_id===we)))||void 0===a?void 0:a.members)||[],addMember:(e,a)=>la(e,a,!0),removeMember:(e,a)=>sa(e,a,!0),updateMemberRole:(e,a,t)=>ia(e,a,t,!0),onSaveMembers:()=>na(!0),onCancelMembers:da,disabled:Pe||W||oe,loading:Pe,token:j,gates:Q,classes:J,currentGate:R,fixedGateId:E,initialGateId:E}),(0,w.jsx)(b.A,{type:"gates",createOpen:!1,editOpen:fe,deleteOpen:he,memberOpen:ye,item:Ie,setItem:Ee,editingItem:Ie,setEditingItem:Ee,itemToDelete:E,setItemToDelete:()=>{},onSaveCreate:()=>{},onSaveEdit:ea,onCancelCreate:()=>{},onCancelEdit:()=>{pe(!1),Ee(null)},onConfirmDelete:aa,onCloseDelete:()=>Ce(!1),selectedId:E,members:T||[],addMember:(e,a)=>la(e,a,!1),removeMember:(e,a)=>sa(e,a,!1),updateMemberRole:(e,a,t)=>ia(e,a,t,!1),onSaveMembers:()=>na(!1),onCancelMembers:ca,disabled:Pe||W,loading:Pe,token:j,gates:Q,classes:J})]})}):(t("/login",{state:{from:I.pathname}}),null)},E=l.memo(I)},9020:(e,a,t)=>{t.d(a,{A:()=>u});var l=t(5043),s=t(7353),i=t(1637),o=t(1922),r=t(1318),n=t(6552),d=t(579);const c=e=>{let{type:a,items:t,cardComponent:l,itemKey:c,quickFilter:u,setQuickFilter:m,searchQuery:v,setSearchQuery:g,filterOptions:b,onResetFilters:f,handleFavorite:p,setEditingItem:h,setItemToDelete:C,setDeleteDialogOpen:y,handleManageMembers:M,navigate:_,currentUser:k,token:x,onCreateNew:F,disabled:w,profileHeader:A,lastItemRef:I,hasMore:E,loading:S}=e;return(0,d.jsxs)(s.A,{sx:{...n.iH,maxWidth:"1500px",mx:"auto"},children:[A,(0,d.jsx)(o.A,{type:a,quickFilter:u,setQuickFilter:m,searchQuery:v,setSearchQuery:g,filterOptions:b,onReset:f}),(0,d.jsx)(r.A,{items:t,cardComponent:l,itemKey:c,gridType:a,handleFavorite:p,setEditingItem:h,setItemToDelete:C,setDeleteDialogOpen:y,handleManageMembers:M,navigate:_,currentUser:k,token:x,onCreateNew:F,disabled:w,lastItemRef:I,hasMore:E}),S&&E&&(0,d.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,d.jsx)(i.A,{"aria-label":"Loading more items"})})]})},u=l.memo(c)}}]);
//# sourceMappingURL=133.9083f3a5.chunk.js.map