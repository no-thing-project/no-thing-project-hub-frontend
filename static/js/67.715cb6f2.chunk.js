"use strict";(self.webpackChunkgate_from_nothingproject_front_end=self.webpackChunkgate_from_nothingproject_front_end||[]).push([[67],{1067:(e,t,a)=>{a.d(t,{g:()=>p});var r=a(5043),n=a(3950),i=a.n(n),l=a(9472);const s="/api/v1/classes",o={TOKEN_REQUIRED:"Token is required",CLASS_ID_REQUIRED:"Class ID is required",GATE_ID_REQUIRED:"Gate ID is required",USERNAME_REQUIRED:"Username is required",DATA_REQUIRED:"Data is required",STATUS_REQUIRED:"Status is required"},c=(e,t)=>{if(!e||"string"!==typeof e||!e.trim())throw new Error(o[`${t.toUpperCase()}_REQUIRED`])},u=(e,t)=>{if(!e||"object"!==typeof e||0===Object.keys(e).length)throw new Error(o[`${t.toUpperCase()}_REQUIRED`])},d="Authentication required.",h="Class ID is missing.",m="Class name is missing.",v="Class not found.",g="Status data is missing.",f="Username is missing.",w="Role is missing.",E="Gate ID is required for public class.",y="An error occurred.",_={MAX_CACHE_SIZE:10,CACHE_EXPIRY_MS:18e5,DEBOUNCE_MS:300,DEFAULT_LIMIT:50,CACHE_VERSION:"v1"};const b=new class{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return null;const{value:t,timestamp:a}=this.cache.get(e);return Date.now()-a>_.CACHE_EXPIRY_MS?(this.cache.delete(e),null):(this.cache.delete(e),this.cache.set(e,{value:t,timestamp:a}),t)}set(e,t){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,{value:t,timestamp:Date.now()})}clear(){this.cache.clear()}}(_.MAX_CACHE_SIZE),p=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[o,p]=(0,r.useState)([]),[C,I]=(0,r.useState)(null),[A,S]=(0,r.useState)([]),[$,k]=(0,r.useState)(null),[M,D]=(0,r.useState)({page:1,limit:_.DEFAULT_LIMIT,total:0,hasMore:!0}),[U,R]=(0,r.useState)(!1),[P,B]=(0,r.useState)(null),T=(0,r.useCallback)(((e,r)=>{if("AbortError"===e.name)return Promise.reject(e);const n=e.status||500;401!==n&&403!==n||(t("Session expired. Please log in again."),a("/login"));const i=r||e.message||y;return B(i),Promise.reject(new Error(i))}),[t,a]),F=(0,r.useCallback)((function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>({member_id:e.member_id||e.anonymous_id||"",username:e.username||"Unknown",role:e.role||"viewer",joined_at:e.joined_at||null,avatar:e.avatar||null,total_points:e.total_points||0,anonymous_id:e.anonymous_id||e.member_id||""})))}),[]),L=(0,r.useCallback)((()=>{p([]),I(null),S([]),k(null),D({page:1,limit:_.DEFAULT_LIMIT,total:0,hasMore:!0}),B(null),b.clear()}),[]),N=(0,r.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};if(!e){const e=new Error(d);return n(e),T(e,d)}const{page:i=1,limit:o=_.DEFAULT_LIMIT}=t,u=`${_.CACHE_VERSION}:classes:${JSON.stringify({...t,page:i,limit:o})}`,h=b.get(u);if(h&&!r)return p(h.classes||[]),D(h.pagination||{page:i,limit:o,total:0,hasMore:!0}),n(null,h),Promise.resolve(h);R(!0),B(null);try{var m,v,g;const d=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;c(e,"token");try{return(await(0,l.Jt)(s,{headers:{Authorization:`Bearer ${e}`},params:t,signal:a instanceof AbortSignal?a:void 0})).data.content||{classes:[],pagination:{}}}catch(P){throw(0,l.hS)(P)}}(e,{...t,page:i,limit:o},a);if(!d)throw new Error("No data received");const h=d.classes||[];return p((e=>r?[...e,...h]:h)),D({page:(null===(m=d.pagination)||void 0===m?void 0:m.page)||i,limit:(null===(v=d.pagination)||void 0===v?void 0:v.limit)||o,total:(null===(g=d.pagination)||void 0===g?void 0:g.total)||0,hasMore:h.length===o}),b.set(u,d),n(null,d),Promise.resolve(d)}catch(f){return"AbortError"===f.name?(n(f),Promise.resolve(null)):(n(f),T(f,y))}finally{R(!1)}}),[e,T]),z=(0,r.useMemo)((()=>i()(((e,t,a,r)=>{"function"!==typeof r&&(console.error("debouncedFetchClassesList: callback is not a function, providing default callback"),r=()=>{}),N(e,t,a,r)}),_.DEBOUNCE_MS)),[N]),O=(0,r.useCallback)((async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};if(!e||null===t||void 0===t||!t.trim()){const t=new Error(e?E:d);return i(t),T(t,e?E:d)}const o=`${_.CACHE_VERSION}:gate:${t}:${JSON.stringify(a)}`,u=b.get(o);if(u&&!n)return p(u.classes||[]),D(u.pagination||{page:1,limit:_.DEFAULT_LIMIT,total:0,hasMore:!0}),i(null,u),Promise.resolve(u);R(!0),B(null);try{var h,m,v;const u=await async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;c(e,"gateId"),c(t,"token");try{return(await(0,l.Jt)(`${s}/gate/${e}`,{headers:{Authorization:`Bearer ${t}`},params:a,signal:r instanceof AbortSignal?r:void 0})).data.content||{classes:[],pagination:{}}}catch(P){throw(0,l.hS)(P)}}(t,e,a,r);if(!u)throw new Error("No data received");const d=u.classes||[];return p((e=>n?[...e,...d]:d)),D({page:(null===(h=u.pagination)||void 0===h?void 0:h.page)||1,limit:(null===(m=u.pagination)||void 0===m?void 0:m.limit)||_.DEFAULT_LIMIT,total:(null===(v=u.pagination)||void 0===v?void 0:v.total)||0,hasMore:d.length===_.DEFAULT_LIMIT}),b.set(o,u),i(null,u),Promise.resolve(u)}catch(g){return"AbortError"===g.name?(i(g),Promise.resolve(null)):(i(g),T(g,y))}finally{R(!1)}}),[e,T]),H=(0,r.useMemo)((()=>i()(((e,t,a,r,n)=>{"function"!==typeof n&&(console.error("debouncedFetchClassesByGate: callback is not a function, providing default callback"),n=()=>{}),O(e,t,a,r,n)}),_.DEBOUNCE_MS)),[O]),J=(0,r.useCallback)((async function(t,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};if(!e||null===t||void 0===t||!t.trim()){const t=new Error(e?h:d);return r(t),T(t,e?h:d)}const n=`${_.CACHE_VERSION}:class:${t}`,i=b.get(n);if(i)return I(i),S(F(i.members)),k(i.stats||null),r(null,i),Promise.resolve(i);R(!0),B(null);try{const i=await(async(e,t,a)=>{c(e,"classId"),c(t,"token");try{return(await(0,l.Jt)(`${s}/${e}`,{headers:{Authorization:`Bearer ${t}`},signal:a instanceof AbortSignal?a:void 0})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,e,a);if(!i)throw new Error("No class data received");return I(i),S(F(i.members||[])),k(i.stats||null),b.set(n,i),r(null,i),Promise.resolve(i)}catch(o){return"AbortError"===o.name?(r(o),Promise.resolve(null)):(r(o),T(o,v))}finally{R(!1)}}),[e,T,F]),j=(0,r.useCallback)((async function(t,a){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};if(!e||null===t||void 0===t||!t.trim()){const t=new Error(e?h:d);return r(t),T(t,e?h:d)}R(!0),B(null);try{const n=await(async(e,t,a)=>{c(e,"classId"),c(t,"token");try{return(await(0,l.Jt)(`${s}/${e}/members`,{headers:{Authorization:`Bearer ${t}`},signal:a instanceof AbortSignal?a:void 0})).data.content||{members:[]}}catch(P){throw(0,l.hS)(P)}})(t,e,a);if(!n)throw new Error("No members data received");return S(F(n.members)),r(null,n),Promise.resolve(n)}catch(n){return"AbortError"===n.name?(r(n),Promise.resolve(null)):(r(n),T(n,y))}finally{R(!1)}}),[e,T,F]),q=(0,r.useMemo)((()=>i()(((e,t,a)=>{"function"!==typeof a&&(console.error("debouncedFetchClassMembersList: callback is not a function, providing default callback"),a=()=>{}),j(e,t,a)}),_.DEBOUNCE_MS)),[j]),Q=(0,r.useCallback)((async t=>{var a,r;if(!e||null===t||void 0===t||null===(a=t.name)||void 0===a||!a.trim())return T(new Error,e?m:d);if(t.is_public&&(null===(r=t.gate_id)||void 0===r||!r.trim()))return T(new Error,E);R(!0),B(null);try{let a;if(t.is_public&&t.gate_id){const{gate_id:r,...n}=t;a=await(async(e,t,a)=>{c(e,"gateId"),u(t,"data"),c(a,"token");try{return(await(0,l.bE)(`${s}/gate/${e}`,t,{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(r,n,e)}else{var n,i,o,h,v;a=await(async(e,t)=>{u(e,"data"),c(t,"token");try{return(await(0,l.bE)(s,e,{headers:{Authorization:`Bearer ${t}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})({...t,visibility:t.visibility||"private",settings:{max_members:(null===(n=t.settings)||void 0===n?void 0:n.max_members)||100,board_creation_cost:(null===(i=t.settings)||void 0===i?void 0:i.board_creation_cost)||50,ai_moderation_enabled:null===(o=null===(h=t.settings)||void 0===h?void 0:h.ai_moderation_enabled)||void 0===o||o,auto_archive_after:(null===(v=t.settings)||void 0===v?void 0:v.auto_archive_after)||30,...t.settings}},e)}if(!a)throw new Error("Failed to create class");return p((e=>[...e,a])),b.clear(),Promise.resolve(a)}catch(g){return T(g,y)}finally{R(!1)}}),[e,T]),x=(0,r.useCallback)((async(t,a)=>{var r;if(!e||null===t||void 0===t||!t.trim()||null===a||void 0===a||null===(r=a.name)||void 0===r||!r.trim())return T(new Error,e?t?m:h:d);R(!0),B(null);try{const{class_id:r,...n}=a,i=await(async(e,t,a)=>{c(e,"classId"),u(t,"data"),c(a,"token");try{return(await(0,l.yJ)(`${s}/${e}`,t,{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,n,e);if(!i)throw new Error("Failed to update class");return p((e=>e.map((e=>e.class_id===t?i:e)))),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?i:e)),b.clear(),Promise.resolve(i)}catch(n){return T(n,y)}finally{R(!1)}}),[e,T]),G=(0,r.useCallback)((async(t,a)=>{if(!e||null===t||void 0===t||!t.trim()||!a)return T(new Error,e?t?g:h:d);R(!0),B(null);try{const r=await(async(e,t,a)=>{c(e,"classId"),u(t,"status"),c(a,"token");try{return(await(0,l.yJ)(`${s}/${e}/status`,t,{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,a,e);if(!r)throw new Error("Failed to update class status");return p((e=>e.map((e=>e.class_id===t?r:e)))),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?r:e)),b.clear(),Promise.resolve(r)}catch(r){return T(r,y)}finally{R(!1)}}),[e,T]),V=(0,r.useCallback)((async t=>{if(!e||null===t||void 0===t||!t.trim())return T(new Error,e?h:d);R(!0),B(null);try{return await(async(e,t)=>{c(e,"classId"),c(t,"token");try{return(await(0,l.yH)(`${s}/${e}`,{headers:{Authorization:`Bearer ${t}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,e),p((e=>e.filter((e=>e.class_id!==t)))),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?null:e)),b.clear(),Promise.resolve(!0)}catch(a){return T(a,y)}finally{R(!1)}}),[e,T]),X=(0,r.useCallback)((async(t,a)=>{let{username:r,role:n="viewer"}=a;if(!e||null===t||void 0===t||!t.trim()||null===r||void 0===r||!r.trim())return T(new Error,e?t?f:h:d);R(!0),B(null);try{const a=await(async(e,t,a)=>{c(e,"classId"),u(t,"data"),c(a,"token");try{return(await(0,l.bE)(`${s}/${e}/members`,t,{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,{username:r,role:n},e);if(!a)throw new Error("Failed to add member");return S(F(a.members)),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?a:e)),p((e=>e.map((e=>e.class_id===t?a:e)))),b.clear(),Promise.resolve(a)}catch(i){return T(i,y)}finally{R(!1)}}),[e,T,F]),Y=(0,r.useCallback)((async(t,a)=>{if(!e||null===t||void 0===t||!t.trim()||null===a||void 0===a||!a.trim())return T(new Error,e?t?f:h:d);R(!0),B(null);try{const r=await(async(e,t,a)=>{c(e,"classId"),c(t,"username"),c(a,"token");try{return(await(0,l.yH)(`${s}/${e}/members/${encodeURIComponent(t)}`,{headers:{Authorization:`Bearer ${a}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,a,e);if(!r)throw new Error("Failed to remove member");return S(F(r.members)),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?r:e)),p((e=>e.map((e=>e.class_id===t?r:e)))),b.clear(),Promise.resolve(r)}catch(r){return T(r,y)}finally{R(!1)}}),[e,T,F]),Z=(0,r.useCallback)((async(t,a,r)=>{if(!e||null===t||void 0===t||!t.trim()||null===a||void 0===a||!a.trim()||null===r||void 0===r||!r.trim())return T(new Error,e?t?a?w:f:h:d);R(!0),B(null);try{const n=await(async(e,t,a,r)=>{c(e,"classId"),c(t,"username"),u(a,"data"),c(r,"token");try{return(await(0,l.yJ)(`${s}/${e}/members/${encodeURIComponent(t)}`,a,{headers:{Authorization:`Bearer ${r}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,a,{role:r},e);if(!n)throw new Error("Failed to update member role");return S(F(n.members)),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?n:e)),p((e=>e.map((e=>e.class_id===t?n:e)))),b.clear(),Promise.resolve(n)}catch(n){return T(n,y)}finally{R(!1)}}),[e,T,F]),K=(0,r.useCallback)((async(t,a)=>{if(!e||null===t||void 0===t||!t.trim())return T(new Error,e?h:d);R(!0),B(null);try{const r=a?await(async(e,t)=>{c(e,"classId"),c(t,"token");try{return(await(0,l.bE)(`${s}/${e}/unfavorite`,{},{headers:{Authorization:`Bearer ${t}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,e):await(async(e,t)=>{c(e,"classId"),c(t,"token");try{return(await(0,l.bE)(`${s}/${e}/favorite`,{},{headers:{Authorization:`Bearer ${t}`}})).data.content||null}catch(P){throw(0,l.hS)(P)}})(t,e);if(!r)throw new Error("Failed to toggle favorite status");return p((e=>e.map((e=>e.class_id===t?r:e)))),I((e=>(null===e||void 0===e?void 0:e.class_id)===t?r:e)),b.clear(),Promise.resolve(r)}catch(r){return T(r,y)}finally{R(!1)}}),[e,T]);return(0,r.useEffect)((()=>{if(!e||n)return void L();const t=new AbortController;return z({},t.signal,!1,((e,t)=>{e&&"AbortError"!==e.name&&B(e.message||y)})),()=>{t.abort(),z.cancel(),H.cancel(),q.cancel()}}),[e,n,L,z,H,q]),(0,r.useMemo)((()=>({classes:o,classItem:C,members:A,stats:$,pagination:M,loading:U,error:P,fetchClassesList:N,fetchClassesByGate:O,fetchClass:J,createNewClass:Q,updateExistingClass:x,updateClassStatusById:G,deleteExistingClass:V,addMemberToClass:X,removeMemberFromClass:Y,updateMemberRole:Z,fetchClassMembersList:j,toggleFavoriteClass:K,resetState:L})),[o,C,A,$,M,U,P,N,O,J,Q,x,G,V,X,Y,Z,j,K,L])}}}]);
//# sourceMappingURL=67.715cb6f2.chunk.js.map